<basis core="tracking" name="tracking" source="Monitoring" collectionname="activity" dbname="tracking"
    addcookie="true" />
<basis core="cookie" name="trackingid" value="[##tracking.inserted.id|(0)##]" />
<basis core="dbsource" source="trust_login8" mid="24" name="db" lid="1" rkey="[##cms.cookie.rkey##]">
    <member name="userid" type="scalar" request="userid" />
</basis>
<basis core="group" name="Delay_1">
    <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
        <member name="get_price" method="insurance" query='{
            "name": "db",
            "mid": "20",
            "schemabase": "[##cms.query.schemabase|(true)##]",
            "schema": {
                "boxinfo": {
                    "action": "create",
                    "childs": [
                        {
                            "first": {
                                "action": "create",
                                "childs": [
                                    {
                                        "provider": {
                                            "action": "find",
                                            "map": "provider.provider_id"
                                        }
                                    },
                                    {
                                        "mainprovider": {
                                            "action": "find",
                                            "map": "provider"
                                        }
                                    },
                                    {
                                        "duration": {
                                            "action": "find",
                                            "map": "duration"
                                        }
                                    },
                                    {
                                        "adult": {
                                            "action": "find",
                                            "map": "adult"
                                        }
                                    },
                                    {
                                        "child": {
                                            "action": "find",
                                            "map": "child"
                                        }
                                    },
                                    {
                                        "infant": {
                                            "action": "find",
                                            "map": "infant"
                                        }
                                    },
                                    {
                                        "zone": {
                                            "action": "find",
                                            "map": "zone"
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "second": {
                                "action": "create",
                                "childs": [
                                    {
                                        "total": {
                                            "action": "find",
                                            "map": "total"
                                        }
                                    },
                                    {
                                        "commissioncost": {
                                            "action": "find",
                                            "map": "commissioncost"
                                        }
                                    },
                                    {
                                        "totalcom": {
                                            "action": "find",
                                            "map": "totalCom"
                                        }
                                    },
                                    {
                                        "commissionn": {
                                            "action": "find",
                                            "map": "commissionn"
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "third": {
                                "action": "create",
                                "childs": [
                                    {
                                        "persons": {
                                            "action": "find",
                                            "map": "persons",
                                            "options": {
                                                "price": {
                                                    "action": "find",
                                                    "map": "price"
                                                },
                                                "tax": {
                                                    "action": "find",
                                                    "map": "tax"
                                                },
                                                "markups": {
                                                    "action": "find",
                                                    "map": "markups.totalprovider"
                                                },
                                                "markups2": {
                                                    "action": "find",
                                                    "map": "markups.totalmarkup"
                                                },
                                                "markupsupplier": {
                                                    "action": "find",
                                                    "map": "markupsupplier.totalmain"
                                                },
                                                "markupsupplier2": {
                                                    "action": "find",
                                                    "map": "markupsupplier.totalsupplier"
                                                },
                                                "commissioncostPerson": {
                                                    "action": "find",
                                                    "map": "commissioncost"
                                                },
                                                "base_price": {
                                                    "action": "find",
                                                    "map": "base_price"
                                                },
                                                "price_com": {
                                                    "action": "find",
                                                    "map": "price_com"
                                                }
                                            }
                                        }
                                    },
                                    {
                                        "obligationp": {
                                            "action": "create",
                                            "childs": [
                                                {
                                                    "obligation": {
                                                        "action": "find",
                                                        "map": "obligation",
                                                        "options": {
                                                            "title": {
                                                                "action": "find",
                                                                "map": "title"
                                                            },
                                                            "limit": {
                                                                "action": "find",
                                                                "map": "limit"
                                                            }
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        "cancelrule": {
                                            "action": "find",
                                            "map": "cancelrule"
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
             "member":[{
             "type":"list",
             "name": "q",
             "request": "get_price",
             "IP": "[##cms.request.clientip##]",
             "countryid" : "[##cms.form.countryid##]",
             "fromdate":"[##cms.form.fdate##]",
             "todate":"[##cms.form.tdate##]",
             "birthday":[[##cms.form.birthday##]],
             "userid":"[##db.userid.userid##]",
             "trackingNo":"[##tracking.inserted.id|(0)##]",
             }]}' postsql="select replace(result,'\x',' ') as 'result' from [db.get_price]" preview="" />
    </basis>
    <basis core="group" name="Delay_2">
        <basis core="inlinesource" name="db">
            <member name="list-insurance" format="json"
                postsql="select  Id , ParentId , case when trim(Field) is null  then  (select field from [db.list-insurance] where id = a.parentid ) else field end as field, value , type , path  from [db.list-insurance] as a"
                preview="">{"root":[##db.get_price.result##]}</member>
        </basis>
        <basis core="group" name="Delay_3">
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>بیمه tripcenter</title>
    <meta name="author" content="BasisCore">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!---------------------------------CSS MAIN--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/tripcenter_main_style.css" />
    <link rel="stylesheet" type="text/css" href="/css/tripcenter-reservation.css" />
    <!---------------------------------CSS CALENDARE--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/Basis_Calendar.css" />
    <!---------------------------------CSS DATEPICKER--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/DatePicker_New.css" />
    <!---------------------------------JS LIBRARY--------------------------------->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
</head>

<body class="rightLogoOnFix" onload="onloadFunc();">
    <div class="loginRegister"></div>
    <div id="bg-popup-timeout" style="display:none"></div>
    <div class="boxalert" style="display:none">
        <div class="imgdiv"><img src="images/time-out.png" alt="time-out" /></div>
        <div class="firstdiv"><span class="firstalert">مدت زمان اعتبار جستجوی شما به پایان رسید</span></div>
        <div class="seconddiv"> <span class="secondalert">لطفا جستجوی خود را از ابتدا انجام دهید.</span>
        </div>
        <div class="optionsnodata">
            <input class="researchnodata" value="جستجوی مجدد" onclick="location.reload()" type="button" />
            <input class="homepage" value="صفحه اصلی" onClick="window.location='/'" type="button">
        </div>
    </div>
    <div class="bgLoading">
        <div class="bg-searching insurance">
            <div class="text-searching">
                <div class="loading-progress"></div><span>در حال جستجوی بهترین بیمه , لطفا کمی صبر
                    کنید...</span>
            </div>
        </div>
    </div>
    <div class="boxContainer pages">
        <basis core="call" file="header.inc" />
        <div id="container">
            <div id="tabs-filter-resize">
                <div id="tabs-filter">
                    <div class="wrapper_box">

                        <div class="wraper_top_info">
                            <div class="research">
                                <div class="research_box">
                                    <div id="r-insurance">
                                        <div class="return frm-box content-Flight">

                                            <form id="insuranceSearch" class="frm changedate" method="post"
                                                action="/insurance_search.bc">
                                                <input type="hidden" value="[##cms.form.persiancurrent##]"
                                                    class="persiancurrent" name="persiancurrent" />
                                                <input value='[##cms.form.birthday##]' name="birthday" class="birthday"
                                                    type="hidden" />
                                                <div class="Wrapper-DesDep">
                                                    <div class="city">

                                                        <input type="text" value="[##cms.form.insurancecountry##]"
                                                            name="insurancecountry" oninput="city_search(this)"
                                                            data-type='5' class="country" autocomplete="off"
                                                            onClick="empty(this)" required />
                                                        <span class="mini-loading"><img src="/images/load.gif"
                                                                width="20" height="20" /></span>
                                                        <input value="[##cms.form.countryid##]" class="co-id"
                                                            name="countryid" type="hidden" />
                                                        <div class="countryFlight"></div>
                                                        <div class="clr"></div>

                                                    </div>


                                                </div>

                                                <div class="Basis_Date_Box">
                                                    <div class="frm-other date" id="Fdate">
                                                        <div class="custom-select">
                                                            <input class="first cal Basis_Date start_date departuredate"
                                                                onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                data-active="0" data-cache="0" id="inp1" name="fdate"
                                                                type="text" placeholder="رفت"
                                                                value="[##cms.form.fdate##]" readonly="true"
                                                                autocomplete="off">
                                                            <input value="[##cms.form.mstring_fdate##]"
                                                                class="mstring_date departureMdate" type="hidden"
                                                                name="mstring_fdate" />

                                                        </div>
                                                    </div>
                                                    <div class="frm-other date z-margin" id="Tdate">
                                                        <div class="custom-select">
                                                            <input
                                                                class="second cal Basis_Date end_date returndate nextCalOpening"
                                                                onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                data-active="0" data-cache="0" id="inp2" name="tdate"
                                                                type="text" placeholder="برگشت"
                                                                value="[##cms.form.tdate##]" readonly="true"
                                                                autocomplete="off" />
                                                            <input value="[##cms.form.mstring_tdate##]"
                                                                class="mstring_date returnMdate" type="hidden"
                                                                name="mstring_tdate" />

                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="frm-other passinfo-field">
                                                    <div class="custom-select">
                                                        <input type="text" placeholder="" readonly class="hotel-input">
                                                        <div class="Wrapper-CountPassenger">
                                                            <span class="count-passenger">مسافر :
                                                                [##cms.form.passengercount##]</span>


                                                        </div>
                                                        <div class="HotelPassengers">

                                                            <div class="ad-ch">
                                                                <div class="itemlable2">
                                                                    <label> <span class="notshow">مسافر</span>
                                                                    </label>
                                                                    <ul class="button-click">
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">+</span></a>
                                                                        </li>
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">-</span></a>
                                                                        </li>
                                                                    </ul>
                                                                    <input type="text" class="cat_textbox"
                                                                        name="passengercount" maxlength="4000"
                                                                        value="[##cms.form.passengercount##]" />
                                                                    <div class="clr"></div>
                                                                </div>
                                                            </div>

                                                            <div class="Wrapper-BirthdatePassenger">

                                                            </div>
                                                            <div class="CloseHotelPassengers">تایید</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <section class="frm-submit-btn">
                                                    <div class="searchagain"><button type="submit"
                                                            class="search-flight hvr-shutter-in-horizontal">جستجو</button>
                                                    </div>
                                                </section>
                                                <div class="clr"></div>
                                            </form>
                                            <div class="clr"></div>
                                        </div>
                                    </div>
                                    </basis>
                                </div>
                                <div class="clr"></div>
                            </div>

                            <div class="clr"></div>
                        </div>
                        <div class="changeDate_box">
                            <div class="prevdate"><span class="inner-next">روز قبل<i class="fa fa-angle-right"
                                        aria-hidden="true"></i></span></div>
                            <div class="nextdate"><span class="inner-next">روز بعد<i class="fa fa-angle-left"
                                        aria-hidden="true"></i></span></div>
                        </div>
                        <div class="inner-box-ticket">

                            <div id="main-box-fliter">
                                <div class="left-side">
                                </div>

                                <div class="inner-box-filter">
                                    <div class="rightPart">
                                        <div class="boxes responsive-boxes">
                                            <div class="">
                                                <div class="countHotel">تعداد <span
                                                            class="dataLen"></span>
                                                     بیمه یافت شد .</div>
                                                <div class="counterbox no-border-bottom">
                                                    <div class="ttcounter">مدت زمان باقی مانده فرآیند رزرو</div>
                                                    <span id="count"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="main-box-ticket">
                                <div class="info-loading">
                                    <div class="inner-box-ticket">

                                        <basis core="tree" datamembername="db.list-insurance" idcol="id"
                                            parentidcol="parentid" nullvalue="null">
                                            <face filter="value = '[]' and field='root'">
                                                <div class="nodata">
                                                    <div class="imgnodata"><img src="/images/no-result.png"
                                                            alt="no-result" width="" height="" /></div>
                                                    <div class="tltnodata">برای جستجوی شما نتیجه ای یافت نشد!</div>
                                                    <div class="textnodata">شما می توانید با انجام مجدد عملیات
                                                        جستجو,نتیجه مورد نظر خود
                                                        را بیابید</div>
                                                    <div class="optionsnodata"><button class="researchnodata"
                                                            onclick="location.reload()" type="submit">جستجوی مجدد
                                                        </button><input class="homepage" value="صفحه اصلی"
                                                            onclick="window.location='/'" type="button" /></div>
                                                </div>
                                            </face>
                                            <face filter="field='boxinfo'">
                                                <div class="info-insurance">
                                                    <form method="post" action="" class="getInsurance">
                                                        <input type="hidden" value="[##cms.form.countryid##]"
                                                            name="countryid" />
                                                        <input type="hidden" value="[##cms.form.fdate##]"
                                                            name="fdate" />
                                                        <input type="hidden" value="[##cms.form.tdate##]"
                                                            name="tdate" />
                                                        <input type="hidden" value='[##cms.form.birthday##]'
                                                            name="birthday" class="birthday" />
                                                        <input type="hidden" value="[##cms.form.insurancecountry##]"
                                                            name="insurancecountry" />
                                                        <input type="hidden" value="[##cms.form.passengercount##]"
                                                            name="passengercount" />
                                                        <div class="headingIns">
                                                            <div class="eachheadinglist2"><span>نوع بیمه</span></div>
                                                            <div class="eachheadinglist1"><span>شرکت بیمه کننده</span>
                                                            </div>
                                                            <div class="eachheadinglist3"><span>قیمت کل</span></div>
                                                            <div class="clr"></div>
                                                        </div>
                                                        <div class="eachdetail">@child<div class="clr"></div>
                                                        </div>
                          
                                                    </form>
                                                    <div class="clr"></div>
                                                </div>
                                            </face>

                                            <face filter="field='provider' and value='20'">
                                                <div class="eachheadinglist2">
                                                    <img src="/images/Pasargad-Ins.png" width="40" height="40"
                                                        alt="pasargad" />
                                                    <input type="hidden" value="@value" name="provider" />
                                                </div>
                                            </face>
                                            <face filter="field='provider' and value='21'">
                                                <div class="eachheadinglist2">
                                                    <img src="/images/Saman-Ins.png" width="80" height="27"
                                                        alt="saman" />
                                                    <input type="hidden" value="@value" name="provider" />
                                                </div>
                                            </face>
                                            <face filter="field='provider' and value='19'">
                                                <div class="eachheadinglist2">
                                                    <img src="/images/Saman-Ins.png" width="80" height="27"
                                                        alt="samanb2c" />
                                                    <input type="hidden" value="@value" name="provider" />
                                                </div>
                                            </face>
                                            <face filter="field='mainprovider'">
                                                <input type="hidden" value='@value' name="insmainprovider" />
                                            </face>
                                            <face filter="field='duration'">
                                                <input type="hidden" value='@value' name="duration" class="duration" />
                                            </face>
                                            <face filter="field='adult'">
                                                <input type="hidden" value='@value' name="adult" />
                                            </face>
                                            <face filter="field='child'">
                                                <input type="hidden" value='@value' name="child" />
                                            </face>
                                            <face filter="field='infant'">
                                                <input type="hidden" value='@value' name="infant" />
                                            </face>
                                            <face filter="field='zone'">
                                                <div class="eachheadinglist1">
                                                    <input type="hidden" value='@value' name="zone" />
                                                    @child
                                                </div>
                                            </face>
                                            <face filter="field='en_name'">
                                                <input type="hidden" value="@value" name="en_name" />
                                                <span>@value - </span>
                                            </face>
                                            <face filter="field='fa_name'">
                                                <input type="hidden" value="@value" name="fa_name" />
                                                <span>@value</span>
                                            </face>
                                            <face filter="field='zone_code'">
                                                <input type="hidden" value="@value" name="zone_code" />
                                            </face>
                                            <face filter="field='second'">
                                                <div class="eachheadinglist3 has_border">
                                                    @child
                                                    <div class="reserve-insurance">
                                                        <div class="inner-search"><input type="button" class="dflbtn not-active-form"
                                                                value="صدور بیمه">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="more-insurance">
                                                    <div class="informations">
                                                        <div class="info-box">
                                                            <div class="Details-box tablePrice" data-index="0">
                                                                <span>جدول
                                                                    قیمت</span><i
                                                                    class="icon icon-arrow-down-16 downarrow"></i>
                                                            </div>

                                                        </div>
                                                        <div class="info-box">
                                                            <div class="Details-box tablerulls2" data-index="0">
                                                                <span>تعهدات
                                                                    بیمه گر</span><i
                                                                    class="icon icon-arrow-down-16 downarrow"></i>
                                                            </div>


                                                        </div>
                                                        <div class="info-box">
                                                            <div class="Details-box tablerulls" data-index="0">
                                                                <span>قوانین
                                                                    ابطال</span><i
                                                                    class="icon icon-arrow-down-16 downarrow"></i>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="clr"></div>
                                                </div>

                                            </face>

                                            <face filter="field='total'">
                                                <div class="cost-ticket"> <span>مبلغ کل : </span><span
                                                        class="cost1 seprator">@value</span><span
                                                        class="moneytype">ريال</span><input type="hidden" value="@value"
                                                        name="Maintotal" /></div>


                                            </face>
                                            <face filter="field='commissioncost' and value <> 0">
                                                <div class="cost-ticket"><span>کمیسیون : </span><span
                                                        class="cost1 seprator">@value</span><span
                                                        class="moneytype">ريال</span></div>


                                            </face>
                                            <face filter="field='commissioncost'">
                                                <input type="hidden" value="@value" class="commissioncost"
                                                    name="Mailcommissioncost">
                                            </face>
                                            <face filter="field='totalcom'">
                                                <div class="cost-ticket totalComIns"> <span>مبلغ نهایی : </span><span
                                                        class="cost1 seprator">@value</span><span
                                                        class="moneytype">ريال</span><input type="hidden" value="@value"
                                                        name="Maintotalcom" /></div>
                                            </face>
                                            <face filter="field='commissionn'">
                                                <input type="hidden" value='@value' name="commissionn" />
                                            </face>
                                            <face filter="field='persons' and type='array'">
                                                <div class="clr"></div>
                                                <div  class="box-price section_information unvisible">
                                                    <div class="close"><span class="fa-times"></span></div>
                                                        <table class="price-tbl" cellpadding="0" cellspacing="0">
                                                            <tr class="first-row">
                                                                <td class="numberTravelers"><span>مسافران</span></td>
                                                                <td class="travelers"><span>تاریخ تولد مسافران</span>
                                                                </td>
                                                                <td class="total-cost"><span>قیمت کل</span></td>
                                                                <td class="numberTravelers"><span>کمیسیون</span></td>
                                                                <td class="numberTravelers"><span> قیمت با کسر
                                                                        کمیسیون</span></td>
                                                            </tr>
                                                          
                                                                @child
                                                            
                                                        </table>
                                                </div>
                                            </face>
                                            <face filter="field='persons' and type='object'">
                                                <tr class="other-rows">
                                                    <td class="numberTravelers count"><span></span></td>
                                                    <td class="travelers"><span></span></td>
                                                    @child
                                                </tr>
                                            </face>
                                            <face filter="field='price' ">
                                                <td class="numberTravelers"><span
                                                        class="totalprice seprator">@value</span>
                                                    <span>ریال</span>
                                                    <input type="hidden" value="@value" class="price" />
                                                </td>
                                            </face>
                                            <face filter="field='base_price' ">
                                                <input type="hidden" value="@value" class="base_price" />
                                            </face>
                                            <face filter="field='price_com' ">
                                                <td class="numberTravelers"><span
                                                        class="totalprice seprator">@value</span>
                                                    <span>ریال</span>

                                                </td>
                                                <input type="hidden" value="@value" class="price_com" />
                                            </face>
                                            <face filter="field='tax' ">

                                                <input type="hidden" value="@value" class="tax" />

                                            </face>
                                            <face filter="field='markups' ">
                                                <input type="hidden" value="@value" class="mtotalprovider" />
                                            </face>
                                            <face filter="field='markups2' ">
                                                <input type="hidden" value="@value" class="mtotalmarkup" />
                                            </face>
                                            <face filter="field='markupsupplier' ">
                                                <input type="hidden" value="@value" class="mtotalmain" />
                                            </face>
                                            <face filter="field='markupsupplier2' ">
                                                <input type="hidden" value="@value" class="mtotalsupplier" />
                                            </face>
                                            <face filter="field='commissioncostPerson'">
                                                <td class="numberTravelers"><span
                                                        class="totalprice seprator">@value</span>
                                                    <span>ریال</span>
                                                    <input type="hidden" value="@value" class="commission" />
                                                    <input type="hidden" value="@value" class="commissioncost" />
                                                </td>
                                            </face>
                                            <face filter="field='obligationp'">
                                                <div class="clr"></div>
                                                <div class="rulls-box section_information unvisible obligation">
                                                    <div class="close"><span class="fa fa-times"></span></div>
                                                    <div class="max-height">@child</div>
                                                </div>
                                            </face>
                                            <face filter="field='obligation'">
                                                <div class="obligationInsurance">@child</div>
                                            </face>
                                            <face filter="field='title'">
                                                <span>@value :</span>
                                            </face>
                                            <face filter="field='limit'">
                                                <span>@value</span><br>
                                            </face>
                                            <face filter="field='cancelrule'">
                                                <div class="clr"></div>
                                                <div class="rulls-box section_information unvisible cancelrule">
                                                    <div class="close"><span class="fa fa-times"></span></div>
                                                    <div class="max-height"> @value </div>
                                                </div>
                                            </face>
                                            <face filter="type in ('array','object')">@child</face>
                                        </basis>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="clr"></div>
                    </div>
                    <div class="clr"></div>
                </div>
                <div class="clr"></div>
            </div>
            <div class="clr"></div>
        </div>
        <basis core="call" file="footer.inc" />
    </div>
    <basis core="call" file="Client_Basis_Calendar.inc" />
    <!---------------------------------JS DATEPICKER--------------------------------->
    <script type="text/javascript" src="/js/NewDatePickerUi.js"></script>
    <script type="text/javascript" src="/js/NewDatePicker.js"></script>
    <script type="text/javascript" src="/js/MainDatePicker.js"></script>
    <!---------------------------------JS PROGRESS--------------------------------->
    <script type="text/javascript" src="/js/Progress-Bar.js"></script>
    <!---------------------------------JS RESEARCH--------------------------------->
    <script type="text/javascript" src="/js/ChangeDate-Scripts.js"></script>
  <script type="text/javascript">
    <basis core = "call" file = "Client_Basis_Calendar_js.inc"/>
  </script>
    <!---------------------------------JS MENU--------------------------------->
    <script type='text/javascript' src="/js/jquery.navgoco.js"></script>
    <script type='text/javascript' src="/js/off-canvas.js"></script>

    <script type="text/javascript">
        var progress = $(".loading-progress").progressTimer({
            timeLimit: 10,
            onFinish: function () {
                $('.bgLoading').hide()
                $('.boxContainer').show()
            }
        });
        $.ajax({
            url: "/"
        });

        function onloadFunc() {
            var counter = 180;
            setInterval(function () {
                counter--;
                var m = parseInt(counter / 60);
                var s = counter % 60;
                if (counter >= 0) {
                    span = document.getElementById("count");
                    if (s < 10) {
                        s = "0" + s;
                    }
                    if (m < 10) {
                        m = "0" + m;
                    }
                    if (m < 2) {
                        document.getElementById("count").classList.add("blink_me")
                    }
                    span.innerHTML = "00:" + m + ":" + s;
                }
                if (counter === 0) {
                    $(".boxalert,#bg-popup-timeout").fadeIn();
                    $(".boxalert").css("top", "200px")
                    clearInterval(counter);
                }
            }, 1000);

        };

       $(".seprator").each(function () {
            $(this).text(function (index, value) {
                return value
                    .replace(/\D/g, "")
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
            })
        })
        $(".tablePrice").click(function () {
            var i = 0;
            i = $(this).attr("data-index")
            if (i == 0) {
                $(this).attr("data-index", "1")
                $(this).find(".icon").removeClass("downarrow");
            } else {
                $(this).attr("data-index", "0")
                $(this).find(".icon").addClass("downarrow");
            }

            $(this).closest(".info-insurance").find(".box-price").slideToggle("slow");
        });
        $(".tablerulls").click(function () {
            var i = 0;
            i = $(this).attr("data-index")
            if (i == 0) {
                $(this).attr("data-index", "1")
                $(this).find(".icon").removeClass("downarrow");
            } else {
                $(this).attr("data-index", "0")
                $(this).find(".icon").addClass("downarrow");
            }

            $(this).closest(".info-insurance").find(".cancelrule").slideToggle("slow");
        });
        $(".tablerulls2").click(function () {
            var i = 0;
            i = $(this).attr("data-index")
            if (i == 0) {
                $(this).attr("data-index", "1")
                $(this).find(".icon").removeClass("downarrow");
            } else {
                $(this).attr("data-index", "0")
                $(this).find(".icon").addClass("downarrow");
            }
            $(this).closest(".info-insurance").find(".obligation").slideToggle("slow");
        });
        $(".close").click(function () {
            $(this).closest(".section_information").slideUp("slow");
        })

        $(".info-insurance").each(function (index, element) {
            var brth = $('.birthday').val()
            var sp = brth.split(",")
            for (var i = 0; i < sp.length; i++) {
                var j = i + 2
                $(this).find(".other-rows:nth-child(" + j + ")").find(".travelers span")
                    .text(sp[i])
            }
            $(this).find(".other-rows").each(function (index, element) {
               $(this).find(".count span").text($(this).index())
                $(this).find(".travelers").each(function (index, element) {
                    $(this).text($(this).text().replace('"', ' '));
                    $(this).text($(this).text().replace('"', ' '));
                });
            });
        });
        $(".obligationInsurance").each(function (index, element) {
            var obligationInsurance = $(this).text()
            if (obligationInsurance == '') {
                $(this).text('در حال حاضر قوانینی ذکر نشده است.')
            }
        })
        $(".other-rows").each(function (index, element) {
            var index = $(this).index()
            $(this).find(".base_price").attr("name", "_root.person__" + index + ".base_price")
            $(this).find(".price").attr("name", "_root.person__" + index + ".price")
            $(this).find(".price_com").attr("name", "_root.person__" + index + ".price_com")
            $(this).find(".tax").attr("name", "_root.person__" + index + ".tax")
            $(this).find(".commission").attr("name", "_root.person__" + index + ".commission")
            $(this).find(".commissioncost").attr("name", "_root.person__" + index + ".commissioncost")
            $(this).find(".mtotalprovider").attr("name", "_root.person__" + index +
                ".markups.totalprovider")
            $(this).find(".mtotalmarkup").attr("name", "_root.person__" + index + ".markups.totalmarkup")
            $(this).find(".mtotalmain").attr("name", "_root.person__" + index + ".markupsupplier.totalmain")
            $(this).find(".mtotalsupplier").attr("name", "_root.person__" + index +
                ".markupsupplier.totalsupplier")
        });
        $(".info-insurance").each(function (index, element) {
            var s = $(this).find(".commissioncost").val()
            if (s == '0') {
                $(this).find(".totalComIns").hide()
            } else {
                $(this).find(".totalComIns").show()
            }
        });
        //<!---------------------------------JS RESEARCH---------------------------------> 

        $(".frm").submit(function (event) {
            $(this).find("input[name=fdate],input[name=tdate]").each(function () {
                if ($(this).val() == '' && !$(this).is(':disabled')) {
                    event.preventDefault();
                    $(this).css('border', '1px solid red')
                }
            })
        })


        $('.count-passenger').click(function (e) {
            $(this).parents('.passinfo-field').find('.HotelPassengers').slideToggle();
            e.preventDefault();
            return false;
        });
        $('.CloseHotelPassengers').click(function (e) {
            $(this).parents('.passinfo-field').find('.HotelPassengers').slideUp();
            e.preventDefault();
            return false;
        });



        //<!-----------JS CALENDARE----------->
        function openNextCal(e) {
            let returnDate = $('#insuranceSearch').find('.nextCalOpening').val();
            if (returnDate == '') {
                $('#insuranceSearch').find('.nextCalOpening').trigger("onclick");
            }

        };

        $(document).ready(function () {
            if ($(window).width() <= 750) {
              $(".frm").attr('action', '/M_Insurance_Search.bc')
            }
            $(".dataLen").text($(".info-insurance").length)
            if ($(".departuredate").val() == $(".persiancurrent").val()) {
                $(".prevdate").hide()
                $('.nextdate').click(NextDate);
            } else {
                $('.prevdate').click(PrevDate);
                $('.nextdate').click(NextDate);
            }
        });


        //<!-----------JS DESTINATIO/DEPARTURE----------->
        $('.country').each(function () {
            $(this).on('keyup', function (e) {
                $(this).closest(".city").find(".outer-searchList").slideUp()
                $(this).closest(".city").find(".searchList").slideUp()
            });
            $(this).on('blur', function () {
                if ($(this).closest(".city").find(".countryFlight").text().length > 0) {
                    if (hoverelse == 0) {
                        var defresult = $(this).closest(".city").find(".countryFlight")
                            .children(".selectCountry:first").find(".txtcountry")
                            .text();
                        var spl = defresult.split(" ");
                        var defresultid = $(this).closest(".city").find(
                            ".countryFlight").children(".selectCountry:first").find(
                            ".countryid").val();
                        $(this).closest(".city").find(".country").val(defresult);
                        $(this).closest(".city").find(".co-id").val(defresultid);
                        $(this).closest(".city").find(".countryFlight").empty();
                    }



                } else {

                    $(this).closest(".city").find(".mini-loading").css("display",
                        "none")
                    $(this).closest(".city").find(".country").val('');
                    $(this).closest(".city").find(".co-id").val('');
                }
            });

        });


        function city_search(a) {
            if (a.which !== 0 && !a.ctrlKey && !a.metaKey && !a.altKey) {
                upper_case = $(a).val().substr(0, 1).toUpperCase() + $(a).val().substr(1).toLowerCase();
                $(a).val(upper_case)

                if ($(a).val().length > 2) {
                    $(a).closest(".city").find(".mini-loading").show();

                    $.ajax({
                        url: '/Client_City_Search.bc',
                        type: 'get',
                        data: {
                            term: $(a).val(),
                            type: $(a).attr('data-type')
                        },
                        success: function (result) {
                            $(a).closest(".city").find(".mini-loading").hide();
                            $(a).closest(".city").find(".countryFlight").empty().html(result)
                        }
                    });
                } else
                    $(a).closest(".city").find(".countryFlight").empty()
            }
        }




        function empty(a) {
            $(a).val('')
            $(a).closest(".city").find(".co-id").val('')

        }
        //<!-----------JS PASSENGERS----------->

        $("#insuranceSearch").submit(function (event) {
            $(this).find(".datepicker").each(function () {
                var birthval = $(this).val().length;
                if (birthval < 1) {
                    $(this).css("border-color", "red")
                    $(this).closest("form").find(".CountPassenger").slideDown()
                    event.preventDefault();
                }
            })
            var passenger_birthday = "";
            $(this).find(".BirthdatePassenger").each(function (index, element) {
                passenger_birthday = passenger_birthday + '"' + $(this).find(".datepicker").val() +
                    '"' + ',';
            });
            $(this).find(".birthday").val(passenger_birthday)
            var val_1 = $(this).find(".birthday").val()
            var val_2 = val_1.replace(/,(?=[^,]*$)/, '')
            $(this).find(".birthday").val(val_2)

        })

        $(".button-click a").on("click", function () {
            var button = $(this);
            var oldVal = parseInt(button.closest(".HotelPassengers").find('.cat_textbox').val());
            console.log(oldVal)
            var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
            if (newVal >= 10) return;
            if (newVal < 1) return;
            button.closest("form").find('.count-passenger').text('مسافر : ' + newVal)
            button.closest("form").find('.cat_textbox').val(newVal)
            if (oldVal < newVal) {
                button.closest(".HotelPassengers").find('.Wrapper-BirthdatePassenger').empty()
                for (var i = 1; i <= newVal; i++) {
                    button.closest(".HotelPassengers").find('.Wrapper-BirthdatePassenger').append(
                        '<div class="BirthdatePassenger"><label>تاریخ تولد مسافر ' +
                        i +
                        '</label><input class="datepicker BithdatePassenger" placeholder="تاریخ میلادی" type="text" autocomplete="off" readonly="true" required><div class="clr"></div></div>'
                    );
                }
            } else if (oldVal > newVal) {
                destroyInsurancePassenger(button.closest(".HotelPassengers").find(
                    '.Wrapper-BirthdatePassenger'), newVal);
            }
            $('.datepicker').focus(function (e) {
                FDatepicker(this, {
                    single: true,
                    isJalali: isJalali,
                    changeMonth: true,
                    changeYear: true,
                    minDate: "-100y",
                    maxDate: $("#AdaultMaxDate").val(),
                    yearRangeJalali: "1250:1500",
                    yearRangeGregorian: "1900:2030",
                    numberOfMonths: 1,
                });
            });
        });
        var destroyInsurancePassenger = function ($el, i) {
            $el.find('div.BirthdatePassenger').get(i).remove();
        };


        $(document).ready(function () {
            if ($("#insuranceSearch").find(".birthday").val() != undefined) {
                $("#insuranceSearch").find(".birthday").val($("#insuranceSearch").find(".birthday").val()
                    .replace(/"/g, ''))
                var birthdate = $("#insuranceSearch").find(".birthday").val()
                var splitBirthdate = birthdate.split(",")
                $("#insuranceSearch").find(".Wrapper-BirthdatePassenger").empty();
                for (var i = 0; i < splitBirthdate.length; i++) {
                    var x = i + 1
                    $("#insuranceSearch").find(".Wrapper-BirthdatePassenger").append(
                        '<div class="BirthdatePassenger"><label>تاریخ تولد مسافر ' + x +
                        '</label><input class="datepicker BithdatePassenger" value="' + splitBirthdate[
                            i] +
                        '" placeholder="تاریخ میلادی" type="text" autocomplete="off" readonly="true" required/><div class="clr"></div></div>'
                    )
                    $('.datepicker').focus(function (e) {
                        FDatepicker(this, {
                            single: true,
                            isJalali: isJalali,
                            changeMonth: true,
                            changeYear: true,
                            minDate: "-100y",
                            maxDate: $("#AdaultMaxDate").val(),
                            yearRangeJalali: "1250:1500",
                            yearRangeGregorian: "1900:2030",
                            numberOfMonths: 1,
                        });
                    });
                }
            }
        })

        ////////<!----- JS  DATEPICKER ---->////////
        function getPassportExpiryDate() {
            return new Date();
        }
        var regional = "",
            isJalali = false;
        if (regional == "fa") {
            isJalali = true;
        }
        $('.datepicker').focus(function (e) {
            FDatepicker(this, {
                single: true,
                isJalali: isJalali,
                changeMonth: true,
                changeYear: true,
                minDate: "-100y",
                maxDate: $("#AdaultMaxDate").val(),
                yearRangeJalali: "1250:1500",
                yearRangeGregorian: "1900:2030",
                numberOfMonths: 1,
            });
        });
        PersianDate = {
            g_days_in_month: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
            j_days_in_month: [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29]
        };
        PersianDate.PersianToGregorian = function (j_y, j_m, j_d) {
            j_y = parseInt(j_y);
            j_m = parseInt(j_m);
            j_d = parseInt(j_d);
            var jy = j_y - 979;
            var jm = j_m - 1;
            var jd = j_d - 1;

            var j_day_no = 365 * jy + parseInt(jy / 33) * 8 + parseInt((jy % 33 + 3) / 4);
            for (var i = 0; i < jm; ++i) j_day_no += PersianDate.j_days_in_month[i];
            j_day_no += jd;
            var g_day_no = j_day_no + 79;
            var gy = 1600 + 400 * parseInt(g_day_no /
                146097); /* 146097 = 365*400 + 400/4 - 400/100 + 400/400 */
            g_day_no = g_day_no % 146097;
            var leap = true;
            if (g_day_no >= 36525) /* 36525 = 365*100 + 100/4 */ {
                g_day_no--;
                gy += 100 * parseInt(g_day_no / 36524); /* 36524 = 365*100 + 100/4 - 100/100 */
                g_day_no = g_day_no % 36524;

                if (g_day_no >= 365) g_day_no++;
                else leap = false;
            }

            gy += 4 * parseInt(g_day_no / 1461); /* 1461 = 365*4 + 4/4 */
            g_day_no %= 1461;
            if (g_day_no >= 366) {
                leap = false;
                g_day_no--;
                gy += parseInt(g_day_no / 365);
                g_day_no = g_day_no % 365;
            }
            for (var i = 0; g_day_no >= PersianDate.g_days_in_month[i] + (i == 1 && leap); i++)
                g_day_no -= PersianDate.g_days_in_month[i] + (i == 1 && leap);
            var gm = i + 1;
            var gd = g_day_no + 1;
            gm = gm < 10 ? "0" + gm : gm;
            gd = gd < 10 ? "0" + gd : gd;
            return [gy, gm, gd];
        }
    </script>
</body>

</html>