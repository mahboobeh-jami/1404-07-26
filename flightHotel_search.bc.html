<basis core="tracking" name="tracking" source="Monitoring" collectionname="activity" dbname="tracking"
    addcookie="true" />
<basis core="cookie" name="trackingid" value="[##tracking.inserted.id|(0)##]" />
<basis core="dbsource" source="trust_login8" mid="24" name="db" lid="1" rkey="[##cms.cookie.rkey##]">
    <member name="userid" type="scalar" request="userid" />
</basis>
<basis core="external.fly.ws" source="cmsDbService2" name="db" procedurename="dbsource">
    <member method="cms" name="Panel_Invoice" query='{
        "name": "db",
        "mid": "20",
        "member": [
            {
                "type": "scalar",
                "name": "q",
                "request": "agencycatid"
            }
        ]
    } ' />
</basis>
<basis core="group" name="Delay_1">
    <basis core="dbsource" source="trust_login" lid="1" name="db" catid="[##db.Panel_Invoice.result##]"
        userid="[##db.userid.userid##]" ownerid="[##cms.cms.ownerid##]">
        <member name="checkuser" type="scalar" request="checkagencyuser" />
    </basis>
    <basis core="group" name="Delay_2">
        <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
            <member method="cms" name="chagencyuser" query='{
            "name": "db",
            "mid": "20",
            "member": [
                {
                    "type": "scalar",
                    "name": "q",
                    "request": "checkagencyuser",
                    "counter": "[##db.checkuser.Column1##]",
                    "userid": "[##db.userid.userid##]"
                }
            ]
        }' />
        </basis>
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>پرواز+هتل tripcenter</title>
    <meta name="author" content="BasisCore">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!---------------------------------CSS MAIN--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/tripcenter_main_style.css" />
    <link rel="stylesheet" type="text/css" href="/css/tripcenter-reservation.css" />
    <!---------------------------------CSS CALENDARE--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/Basis_Calendar.css" />
    <!---------------------------------JS LIBRARY--------------------------------->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
</head>

<body class="rightLogoOnFix" onload="onloadFunc();">
    <div class="loginRegister"></div>
    <div id="bg-popup-timeout" style="display:none"></div>
    <div class="boxalert" style="display:none">
        <div class="imgdiv"><img src="/images/time-out.png" alt="time-out" width="" height="" /></div>
        <div class="firstdiv"><span class="firstalert">مدت زمان اعتبار جستجوی شما به پایان رسید</span></div>
        <div class="seconddiv"> <span class="secondalert">لطفا جستجوی خود را از ابتدا انجام دهید.</span></div>
        <div class="optionsnodata">
            <input class="researchnodata" value="جستجوی مجدد" onclick="location.reload()" type="button" />
            <input class="homepage" value="صفحه اصلی" onclick="window.location='/'" type="button">
        </div>
    </div>
    <div class="bgLoading">
        <div class="bg-searching flight_hotel">
            <div class="text-searching">
                <div class="loading-progress"></div><span>در حال جستجوی بهترین پرواز و هتل , لطفا کمی صبر
                    کنید...</span>
            </div>
        </div>
    </div>
  <div class="boxContainer pages">
        <basis core="call" file="header.inc" />
        <div id="container">
            <input type="hidden" value="[##db.chagencyuser.result##]" id="chagencyuser" />
            <div id="tabs-filter-resize">
                <div id="tabs-filter">
                    <div class="wrapper_box">
                        <div class="wraper_top_info">
                            <div class="research">
                                <div class="research_box">
                                    <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
                                        <member method="cms" name="depcity"
                                            query='{ "name": "db", "mid": "20", "member":[ { "type":"list", "name": "q", "request": "citySearch",  "functype": "0", "title": "[##cms.form.from##]", "status": "city"}]}'
                                            preview="" />
                                    </basis>
                                    <basis core="external.fly.ws" source="cmsDbService2" procedurename="dbsource" name="db">
                                        <member method="cms" name="descity"
                                            query='{ "name": "db", "mid": "20", "member":[ { "type":"list", "name": "q", "request": "citySearch", "functype": "0", "title": "[##cms.form.to##]",   "status": "city"}]}'
                                            preview="" />
                                    </basis>
                                    <basis core="group" name="search">
                                        <basis core="inlinesource" name="db">
                                            <member name="from" format="json" preview="">
                                                {"root":[##db.depcity.result##]}</member>
                                            <member name="to" format="json" preview="">
                                                {"root":[##db.descity.result##]}
                                            </member>
                                        </basis>
                                        <div id="r-flighthotel" style="display: block">
                                            <div class="content-HotelTour" style="display:block">
                                                <form action="/flightHotel_search.bc" method="post" class="frm changedate">
                                                    <input type="hidden" value="[##cms.form.persiancurrent##]"
                                                        class="persiancurrent" name="persiancurrent" />
                                                    <div class="Wrapper-DesDep">
                                                        <div class="city">
                                                            <basis core="tree" datamembername="db.from" idcol="id"
                                                                parentidcol="parentid" nullvalue="null">
                                                                <face filter="Field='title'">
                                                                    <input type="text" value="@value" name=""
                                                                        oninput="city_search(this)" data-type='1'
                                                                        class="country FCD1" autocomplete="off"
                                                                        onClick="empty(this)" required />
                                                                </face>
                                                                <face filter="type in ('array','object')">@child
                                                                </face>
                                                            </basis>
            
                                                            <span class="mini-loading"><img src="/images/load.gif" width="20"
                                                                    height="20" /></span>
                                                            <input value="[##cms.form.from##]" class="co-id FCDid1" type="hidden"
                                                                name="from" />
                                                            <div class="countryFlight"></div>
                                                            <div class="clr"></div>
                                                            <div class="searchList">
                                                                <div>
                                                                    <ul>
                                                                        <li class="category-title"><span>مسیرهای
                                                                                پرتردد</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1203548"><span
                                                                                class="icon-map"></span><span>تهران
                                                                                - Tehran - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1177676"><span
                                                                                class="icon-map"></span><span>استانبول
                                                                                - Istanbul - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211083"><span
                                                                                class="icon-map"></span><span>مشهد -
                                                                                Mashhad - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211110"><span
                                                                                class="icon-map"></span><span>کیش -
                                                                                Kish - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1173505"><span
                                                                                class="icon-map"></span><span>دبی -
                                                                                Dubai - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1168092"><span
                                                                                class="icon-map"></span><span>آنتالیا
                                                                                - Antalya - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1189731"><span
                                                                                class="icon-map"></span><span>تفلیس
                                                                                - Tbilisi - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211086"><span
                                                                                class="icon-map"></span><span>شیراز
                                                                                - Shiraz - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211084"><span
                                                                                class="icon-map"></span><span>اصفهان
                                                                                - Isfahan - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1178542"><span
                                                                                class="icon-map"></span><span>کوالالامپور
                                                                                - Kuala Lumpur - همه فرودگاه
                                                                                ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196609"><span
                                                                                class="icon-map"></span><span>اهواز
                                                                                - Ahvaz - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211091"><span
                                                                                class="icon-map"></span><span>کرمان
                                                                                - Kerman - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196620"><span
                                                                                class="icon-map"></span><span>کرمانشاه
                                                                                - Kermanshah - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1184034"><span
                                                                                class="icon-map"></span><span>پاریس
                                                                                - Paris - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196639"><span
                                                                                class="icon-map"></span><span>قشم -
                                                                                Qeshm - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211085"><span
                                                                                class="icon-map"></span><span>تبریز
                                                                                - Tabriz - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196659"><span
                                                                                class="icon-map"></span><span>چابهار
                                                                                - Chabahar - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211090"><span
                                                                                class="icon-map"></span><span>یزد -
                                                                                Yazd - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196635"><span
                                                                                class="icon-map"></span><span>بندرعباس
                                                                                - Bandar Abbas - همه فرودگاه
                                                                                ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211104"><span
                                                                                class="icon-map"></span><span>رامسر
                                                                                - Ramsar - همه فرودگاه ها</span>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="fa-exchange" data-index="0"><i
                                                                class="fas fa-exchange-alt customized-icon-searchbox-exchange"
                                                                data-index="0"></i></div>
                                                        <div class="city second-city">
                                                            <basis core="tree" datamembername="db.to" idcol="id"
                                                                parentidcol="parentid" nullvalue="null">
                                                                <face filter="Field='title'">
                                                                    <input type="text" value="@value" name=""
                                                                        oninput="city_search(this)" data-type='1'
                                                                        class="country FCD2" autocomplete="off"
                                                                        onClick="empty(this)" required />
                                                                </face>
                                                                <face filter="type in ('array','object')">@child
                                                                </face>
                                                            </basis>
            
                                                            <span class="mini-loading"><img src="/images/load.gif" width="20"
                                                                    height="20" /></span>
                                                            <input value="[##cms.form.to##]" class="co-id FCDid2" type="hidden"
                                                                name="to" />
                                                            <div class="countryFlight"></div>
                                                            <div class="clr"></div>
                                                            <div class="searchList">
                                                                <div>
                                                                    <ul>
                                                                        <li class="category-title"><span>مسیرهای
                                                                                پرتردد</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1203548"><span
                                                                                class="icon-map"></span><span>تهران
                                                                                - Tehran - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1177676"><span
                                                                                class="icon-map"></span><span>استانبول
                                                                                - Istanbul - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211083"><span
                                                                                class="icon-map"></span><span>مشهد -
                                                                                Mashhad - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211110"><span
                                                                                class="icon-map"></span><span>کیش -
                                                                                Kish - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1173505"><span
                                                                                class="icon-map"></span><span>دبی -
                                                                                Dubai - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1168092"><span
                                                                                class="icon-map"></span><span>آنتالیا
                                                                                - Antalya - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1189731"><span
                                                                                class="icon-map"></span><span>تفلیس
                                                                                - Tbilisi - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211086"><span
                                                                                class="icon-map"></span><span>شیراز
                                                                                - Shiraz - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211084"><span
                                                                                class="icon-map"></span><span>اصفهان
                                                                                - Isfahan - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1178542"><span
                                                                                class="icon-map"></span><span>کوالالامپور
                                                                                - Kuala Lumpur - همه فرودگاه
                                                                                ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196609"><span
                                                                                class="icon-map"></span><span>اهواز
                                                                                - Ahvaz - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211091"><span
                                                                                class="icon-map"></span><span>کرمان
                                                                                - Kerman - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196620"><span
                                                                                class="icon-map"></span><span>کرمانشاه
                                                                                - Kermanshah - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1184034"><span
                                                                                class="icon-map"></span><span>پاریس
                                                                                - Paris - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196639"><span
                                                                                class="icon-map"></span><span>قشم -
                                                                                Qeshm - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211085"><span
                                                                                class="icon-map"></span><span>تبریز
                                                                                - Tabriz - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196659"><span
                                                                                class="icon-map"></span><span>چابهار
                                                                                - Chabahar - همه فرودگاه ها</span>
                                                                        </li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211090"><span
                                                                                class="icon-map"></span><span>یزد -
                                                                                Yazd - همه فرودگاه ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1196635"><span
                                                                                class="icon-map"></span><span>بندرعباس
                                                                                - Bandar Abbas - همه فرودگاه
                                                                                ها</span></li>
                                                                        <li onClick="SelectPlace(this)" data-id="1211104"><span
                                                                                class="icon-map"></span><span>رامسر
                                                                                - Ramsar - همه فرودگاه ها</span>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="Basis_Date_Box">
                                                        <div class="frm-other date" id="Fdate">
                                                            <div class="custom-select">
                                                                <input class="first cal Basis_Date start_date departuredate"
                                                                    onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                    data-active="0" data-cache="0" id="inp1" name="fdate"
                                                                    type="text" placeholder="رفت" value="[##cms.form.fdate##]"
                                                                    readonly="true" autocomplete="off">
                                                                <input value="[##cms.form.mstring_fdate##]"
                                                                    class="mstring_date departureMdate" type="hidden"
                                                                    name="mstring_fdate" />
            
                                                            </div>
                                                        </div>
                                                        <div class="frm-other date z-margin" id="Tdate">
                                                            <div class="custom-select">
                                                                <input
                                                                    class="second cal Basis_Date end_date nextCalOpening returndate"
                                                                    onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                    data-active="0" data-cache="0" id="inp2" name="tdate"
                                                                    type="text" placeholder="برگشت" value="[##cms.form.tdate##]"
                                                                    readonly="true" autocomplete="off">
                                                                <input value="[##cms.form.mstring_tdate##]"
                                                                    class="mstring_date returnMdate" type="hidden"
                                                                    name="mstring_tdate" />
            
                                                            </div>
                                                        </div>
                                                    </div>
            
                                                    <div class="frm-other passinfo-field">
                                                        <div class="custom-select">
                                                            <input type="text" placeholder="" readonly
                                                                class="hotel-input">
                                                            <div class="Wrapper-CountPassenger">
                                                                <span class="count-room"></span>
                                                                <span class="count-adultRoom"></span>
                                                                <span class="count-childRoom"></span>
                                                            
                                                                <div class="clr"></div>
                                                            </div>
                                                            <div class="HotelPassengers">
                                                                <div class="itemlable2 Classname-box">
                                                                    <label> <span class="notshow">کلاس پروازی</span>
                                                                    </label>
                                                                    <div class="Class_box_inner">
                                                                        <i class="fas fa-chevron-down"></i>
                                                                        <select name="FlightClass">
                                                                            <option value="[##cms.form.FlightClass##]"
                                                                                class="selected">
                                                                                [##cms.form.FlightClass##]</option>
                                                                            <option value="Economy" class="not-selected">Economy
                                                                                Class
                                                                            </option>
                                                                            <option value="BusinessClass" class="not-selected">
                                                                                Bussines Class
                                                                            </option>
                                                                            <option value="FirstClass" class="not-selected">First
                                                                                Class
                                                                            </option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="itemlable2">
                                                                    <label> <span class="notshow">تعداد اتاق</span> </label>
                                                                    <ul class="button-click-room">
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">+</span></a>
                                                                        </li>
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">-</span></a>
                                                                        </li>
                                                                        <div class="clr"></div>
                                                                    </ul>
                                                                    <input type="text" class="cat_textbox roomcount"
                                                                        maxlength="4000" value="">
                                                                </div>
                                                                <div class="clr"></div>
                                                                <div class="countRoom countRoomHT">
                                                                    <div class="contentRooms">
                                                                        <div class="itemlable2">
                                                                            <label> <span class="notshow">بزرگسال</span> </label>
                                                                            <ul class="button-click">
                                                                                <li><a class="button secondary"><span
                                                                                            class="hide">+</span></a>
                                                                                </li>
                                                                                <li><a class="button secondary"><span
                                                                                            class="hide">-</span></a>
                                                                                </li>
                                                                            </ul>
                                                                            <input type="text" class="cat_textbox adultcount"
                                                                                name="_root.rooms__1.adultcount" maxlength="4000"
                                                                                value="1">
                                                                            <div class="clr"></div>
                                                                        </div>
                                                                        <div class="itemlable2">
                                                                            <label> <span class="notshow">کودک</span> </label>
                                                                            <ul class="button-click-childRoom">
                                                                                <li><a class="button secondary"><span
                                                                                            class="hide">+</span></a>
                                                                                </li>
                                                                                <li><a class="button secondary"><span
                                                                                            class="hide">-</span></a>
                                                                                </li>
                                                                                <div class="clr"></div>
                                                                            </ul>
                                                                            <input type="text" class="cat_textbox chcount"
                                                                                maxlength="4000" value="0">
                                                                        </div>
                                                                        <div class="clr"></div>
                                                                        <div class="childDropdowns"></div>
                                                                        <input type="hidden" name="_root.rooms__1.childcountandage"
                                                                            class="childcountandage" value="0" />
                                                                    </div>
                                                                </div>
                                                                <div class="CloseHotelPassengers">تایید</div>
                                                            </div>
                                                            <div class="clr"></div>
                                                        </div>
                                                    </div>
                                                    <section class="frm-submit-btn">
                                                        <div class="searchagain"><button type="submit"
                                                                class="search-flight hvr-shutter-in-horizontal">جستجو</button></div>
                                                    </section>
            
                                                    <div class="clr"></div>
                                                    <div class="Wrapper-CheckHotelDate">
                                                        <input id="needhotel" type="checkbox" value="[##cms.form.Hotel-Date##]"
                                                            onChange="CheckExteraHoteldate(this)" name="Hotel-Date"
                                                            class="Hotel-Date" />
                                                        <label class="needhotel-label" for="needhotel">من فقط برای بخشی از سفر به هتل نیاز دارم</label>
                                                    </div>
                                                    <div class="Wrapper-ExteraHoteldate Basis_Date_Box">
                                                        <div class="frm-other date">
                                                            <div class="custom-select">
                                                                <input class="first cal Basis_Date start_date cal-fill-check"
                                                                    onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                    data-active="0" data-cache="0" id="inp1" name="checkin"
                                                                    type="text" placeholder="تاریخ ورود" value="[##cms.form.checkin##]"
                                                                    autocomplete="off">
                                                            </div>
                                                        </div>
                                                        <div class="frm-other date">
                                                            <div class="custom-select">
                                                                <input
                                                                    class="second cal Basis_Date end_date nextCalOpeningex cal-fill-check"
                                                                    onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                                    data-active="0" data-cache="0" id="inp2" name="checkout"
                                                                    type="text" placeholder="تاریخ خروج" value="[##cms.form.checkout##]"
                                                                    autocomplete="off">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                </div>
            
                                <div class="clr"></div>
                            </div>
            
                            <div class="clr"></div>
                        </div>
                        <div class="changeDate_box">
                            <div class="prevdate"><span class="inner-next">روز قبل<i class="fa fa-angle-right"
                                        aria-hidden="true"></i></span></div>
                            <div class="nextdate"><span class="inner-next">روز بعد<i class="fa fa-angle-left"
                                        aria-hidden="true"></i></span></div>
                        </div>
                        <div class="inner-box-ticket FH_list" id="Result"></div>
                    </div>
                </div>
                <div class="clr"></div>
            </div>
            <div class="clr"></div>
        </div>
        <basis core="call" file="footer.inc" />
    </div>
    <basis core="call" file="Client_Basis_Calendar.inc" />
    <script type="text/javascript">
        $(document).ready(function () {
            fetch('/Client_FlightHotel_Json.bc', {
            method: 'POST',
            body: 'from=[##cms.form.from##]&to=[##cms.form.to##]&fdate=[##cms.form.fdate##]&tdate=[##cms.form.tdate##]&checkin=[##cms.form.checkin##]&checkout=[##cms.form.checkout##]&flexible=[##cms.form.flexible|(0)##]&userid=[##db.userid.userid##]&rooms=[##cms.json.header|cms.form.roomSearch##]&FlightClass=[##cms.form.FlightClass##]'
        })
            .then(response => response.text())
            .then(text => {
                const Maindata = JSON.parse(text.replace(/\'/g, '"'))
                const lenMaindata = Maindata.length
                if (lenMaindata == undefined) {
                    $('.bgLoading').hide()
                    $('.boxContainer').show()
                    $(".sort_box").hide()
                } else {
                    const { flight } = Maindata.find(a => a.type === "2") || {}
                    const MergedData = Maindata.filter(a => a.type === "3")
                        .map(a => {
                            const hotels = a.hotels.map(b => ({ ...b, flight }))
                            return { ...a, hotels }
                        })
                    const MergedDataFinal = MergedData[0].hotels
                    MergedDataFinal.sort((a, b) => b.hotelinfo.hotelsearch.star - a.hotelinfo.hotelsearch.star);
                    $('.bgLoading').hide()
                    $('.boxContainer').show()
                    load_data(MergedDataFinal)
                }
            }).catch(error => console.error(error))
        })
    </script>
    <!---------------------------------JS PROGRESS--------------------------------->
    <script type="text/javascript" src="/js/Progress-Bar.js"></script>
    <!---------------------------------JS RESEARCH--------------------------------->
    <script type="text/javascript" src="/js/ChangeDate-Scripts.js"></script>
  <script type="text/javascript">
    <basis core = "call" file = "Client_Basis_Calendar_js.inc"/>
  </script>
    <!---------------------------------JS MENU--------------------------------->
    <script type='text/javascript' src="/js/jquery.navgoco.js"></script> 
    <script type='text/javascript' src="/js/off-canvas.js"></script> 
    <!---------------------------------LIBRARY REACT--------------------------------->
    <script src="/js/react.production.min.js" crossorigin></script>
    <script src="/js/react-dom.production.min.js" crossorigin></script>
    <script src="/js/babel.min.js" crossorigin></script>
    <script src="/js/react-library.js"></script>
    <script type="text/babel">
        function load_data(load_data){
    class App extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            data: [],
            dataFlight: [],
            data_provider: [],
            library: null,
            libraryFlight: null,
            librarySecond: null,
            librarySecondFlight: null,
            perPage: 20,
            currentPage: 1,
            currentPage2: 2,
            currentPage3: 3,
            maxPage: null,
            perPageFlight: 20,
            currentPageFlight: 1,
            currentPageFlight2: 2,
            currentPageFlight3: 3,
            maxPageFlight: null,
            VisiblesAllDetails: {},
            visibleDetailsFlight: {},
            visibleBarFlight: {},
            visibleRuleFlight: {},
            loadingBarDep: {},
            loadingBarDes: {},
            barDepTxt: {},
            barDesTxt: {},
            loadingRuleDep: {},
            loadingRuleDes: {},
            ruleDepTxt: {},
            ruleDesTxt: {},
            resultruleRoom: {},
            ruleRoomVisibles: {},
            VisiblesAllRooms: {},
            loadingVisible: {},
            visibleRoom: {},
            filterNameHotel: "",
            filterTotalFHotel: "",
            filterTotalSHotel: "",
            rangevalTotalFHotel: "",
            rangevalTotalSHotel: "",
            filterExitTimeDepF: "00",
            filterExitTimeDepS: "24",
            rangevalExitTimeDepF: "00:00",
            rangevalExitTimeDepS: "24:00",
            filterExitTimeDesF: "00",
            filterExitTimeDesS: "24",
            rangevalExitTimeDesF: "00:00",
            rangevalExitTimeDesS: "24:00",
            filterDurationTimeDepF: "",
            filterDurationTimeDepS: "",
            rangevalTimeDepF: "",
            rangevalTimeDepS: "",
            filterDurationTimeDesF: "",
            filterDurationTimeDesS: "",
            rangevalTimeDesF: "",
            rangevalTimeDesS: "",
            NewFlightAmount: "",
            NewFlightSign: "",
            activeTab_details: {},
            activeTab_bar: {},
            activeTab_rule: {},
            activeTab_price: {},
            defaultS: {},
            priceS: {},
            defaultactive: {},
            priceactive: {},
            starS: {},
            staractive: {},
            checkkeyprice: 0,
            checkkeystar: 0,
            activedefault: "activesort",
            activeprice: "",
            activestar: "",
            activeDarrow: "activearrow",
            activeParrow: "deactivearrow",
            activeSarrow: "deactivearrow",
            state_active_btn : ""
        }
        this.airlines = [];
        this.stops_dep = [];
        this.stops_des = [];
        this.stars = [];
        this.service = [];
        this.availability = [];
        this.handleClick = this.handleClick.bind(this);
        this.handleReset = this.handleReset.bind(this);
        this.handleResetFlight = this.handleResetFlight.bind(this);
    }
    componentDidMount() {
        this.setState(state => ({
                        ...state,
                        data: load_data
                    }), () => {
                        this.reorganiseLibrary()
        })

        $(document).on('update_flight', (event, TotalComPack, productid, moneytype) => {
            $(".ChangeFlight-loader").show()

            fetch('/Client_Flight_Json.bc', {
                method: 'POST',
                body: 'from=[##cms.form.from##]&to=[##cms.form.to##]&fdate=[##cms.form.fdate##]&tdate=[##cms.form.tdate##]&checkin=[##cms.form.checkin##]&checkout=[##cms.form.checkout##]&flexible=[##cms.form.flexible|(0)##]&userid=[##db.userid.userid##]&rooms=[##cms.json.header|cms.form.roomSearch##]&FlightClass=[##cms.form.FlightClass##]&productid=' + productid + ''
            })
                .then(response => response.text())
                .then(text => {
                    const Maindata = JSON.parse(text.replace(/\'/g, '"'))
                    const LenMaindata = Maindata.length
                    if (LenMaindata !== undefined) {
                        $(".SearchInfoTotal").text(new Intl.NumberFormat().format(TotalComPack) + moneytype)
                    }
                    this.setState(state => ({
                        ...state,
                        dataFlight: Maindata
                    }), () => {
                        this.reorganiseLibraryFlight()
                        $(".ChangeFlight-loader").hide()
                        $(".NoDataFlight").show()
                        $(".search-info").show()
                    })
                }).catch(error => console.error(error))

        })

        $(document).on('update_result', (event, service, stars, availability, checktype, checkkey) => {
            this.reorganiseLibrary(service, stars, availability, checktype, checkkey)
        })
        $(document).on('update_resultFlight', (event, airlines, stops_dep, stops_des) => {
            this.reorganiseLibraryFlight(airlines, stops_dep, stops_des)
        })

        if ([##db.chagencyuser.result##] == 1) {
            fetch('/Client_Provider_Library.bc')
                .then(response => response.json())
                .then(provider => {
                    this.setState({ data_provider: provider })
                }).catch(error => console.error(error))
        }
    }
    componentDidUpdate() {
        $(".night_hotel").text($(".nightLink").val())
        $(".unit_content").each(function () {
             if ($(this).text() == 'ریالريال' || $(this).text() == 'ريالریال') {
                $(this).text('ریال')
            }
        })
        $(".airline_filter").sort(function (a, b) {
            a = $(".min_total", a).text().replace(/,/g, '');
            b = $(".min_total", b).text().replace(/,/g, '');
            return a - b;
        }).appendTo(".airline_results");
        $(".grade_filter").sort(function (a, b) {
            a = $(".stars", a).val().replace(/,/g, '');
            b = $(".stars", b).val().replace(/,/g, '');
            return a - b;
        }).appendTo(".grade_results");
    }
    reorganiseLibrary = (service, stars, availability, checktype, checkkey) => {
        const { filterNameHotel, filterTotalFHotel, filterTotalSHotel, perPage, data, Othersfilter } = this.state;
        let library = data;
        let librarySecond = data;
        librarySecond = _.chunk(librarySecond, perPage);
        this.setState({
            librarySecond,
            currentPage: 1,
            maxPage: librarySecond.length === 0 ? 1 : librarySecond.length
        })
        let defaultFilterTotalF = null;
        defaultFilterTotalF = filterTotalFHotel
            ? (filterTotalFHotel)
            : (this.renderMinFilterTotal(librarySecond));
        let defaultFilterTotalS = null;
        defaultFilterTotalS = filterTotalSHotel
            ? (filterTotalSHotel)
            : (this.renderMaxFilterTotal(librarySecond));
        if (filterTotalFHotel !== "" || filterTotalSHotel !== "") {
            let lenLibraryDef = library.length
            if (lenLibraryDef !== undefined) {
                library = library.filter(item =>
                    item.totalCom >= defaultFilterTotalF && item.totalCom <= defaultFilterTotalS
                )
                let lenLibrary = library.length
                $('.numbersearch').text(lenLibrary)
            }
        }

        if (checktype == 'default') {
            library.sort((a, b) => a.total - b.total);
            this.setState({ activedefault: "activesort" })
            this.setState({ activeprice: "" })
            this.setState({ activestar: "" })
            this.setState({ activeSarrow: "deactivearrow" })
            this.setState({ activeParrow: "deactivearrow" })
        }


        if (checktype == 'price') {
            if (checkkey == 0) {
                library.sort((a, b) => b.total - a.total);
                this.setState({ checkkeyprice: 1 });
            } else {
                library.sort((a, b) => a.total - b.total);
                this.setState({ checkkeyprice: 0 });
            }
            this.setState(prevState => ({
                priceS: { ...prevState.priceS, [0]: !prevState.priceS[0] }
            }))
            this.setState({ activeParrow: "" })
            this.setState({ activeSarrow: "deactivearrow" })
            this.setState({ activeprice: "activesort" })
            this.setState({ activedefault: "" })
            this.setState({ activestar: "" })
        }

        if (checktype == 'star') {
            if (checkkey == 0) {
                library.sort((a, b) => b.hotelinfo.hotelsearch.star - a.hotelinfo.hotelsearch.star);
                this.setState({ checkkeystar: 1 });
            } else {
                library.sort((a, b) => a.hotelinfo.hotelsearch.star - b.hotelinfo.hotelsearch.star);
                this.setState({ checkkeystar: 0 });
            }
            this.setState(prevState => ({
                starS: { ...prevState.starS, [0]: !prevState.starS[0] }
            }))
            this.setState({ activeSarrow: "" })
            this.setState({ activeParrow: "deactivearrow" })
            this.setState({ activeprice: "" })
            this.setState({ activedefault: "" })
            this.setState({ activestar: "activesort" })
        }



        if (filterNameHotel !== "") {
            library = library.filter(item =>
                item.hotelinfo.hotelsearch.realname.toLowerCase().includes(filterNameHotel)
            )
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }

        if (stars !== undefined) {
            if (stars !== "") {
                stars = stars.split(",");

                library = library.filter(item => {
                    if (stars.includes(this.renderStarFilter(item.hotelinfo.hotelsearch.star))) return item;
                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }


        if (service !== undefined) {
            if (service !== "") {
                service = service.split(",");
                library = library.filter(item => {
                    if (service.includes(item.families[0].services)) return item;
                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }

        if (availability !== undefined) {
            if (availability !== "") {
                availability = availability.split(",");
                library = library.filter(item => {
                    if (this.render_availability_filter(item.families[0]).some(r => availability.includes(r))) return item;

                })
            }

            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)

        }
        let lenLibrary = library.length
        if (lenLibrary == undefined) {
            $('.numbersearch').text(0)
        } else {
            $('.numbersearch').text(lenLibrary)
        }
        library = _.chunk(library, perPage);
        this.setState({
            library,
            currentPage: 1,
            maxPage: library.length === 0 ? 1 : library.length
        })

    }

    renderStarFilter(element) {
        let elementToSting = element.toString()
        return elementToSting
    }
    render_availability_filter(element) {
        let elementAdd = []
        for (let i = 0; i < element.availablerooms.length; i++) {
            elementAdd.push(element.availablerooms[i].info.availability)
        }
        return elementAdd
    }

    reorganiseLibraryFlight = (airlines, stops_dep, stops_des) => {
        const { filterExitTimeDepF, filterExitTimeDepS, filterExitTimeDesF, filterExitTimeDesS, filterDurationTimeDepF, filterDurationTimeDepS, filterDurationTimeDesF, filterDurationTimeDesS, perPageFlight, dataFlight } = this.state;
        let libraryFlight = dataFlight
        let AllLibraryFlight = dataFlight
        let librarySecondFlight = dataFlight;
        librarySecondFlight = _.chunk(librarySecondFlight, perPageFlight, AllLibraryFlight);
        this.setState({
            AllLibraryFlight,
            librarySecondFlight,
            currentPageFlight: 1,
            maxPageFlight: librarySecondFlight.length === 0 ? 1 : librarySecondFlight.length
        })

        let defaultFilterTimeDepF = null;
        defaultFilterTimeDepF = filterDurationTimeDepF
            ? (filterDurationTimeDepF)
            : (this.renderMinFilterTimeDep(librarySecondFlight));
        let defaultFilterTimeDepS = null;
        defaultFilterTimeDepS = filterDurationTimeDepS
            ? (filterDurationTimeDepS)
            : (this.renderMaxFilterTimeDep(librarySecondFlight));
        if (filterDurationTimeDepS !== "" || filterDurationTimeDepF !== "") {
            let lenLibraryDef = libraryFlight.length
            if (lenLibraryDef !== undefined) {
                libraryFlight = libraryFlight.filter(item =>
                    parseInt(this.renderStoppinfoF(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)) >= parseInt(defaultFilterTimeDepF) && parseInt(this.renderStoppinfoS(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)) <= parseInt(defaultFilterTimeDepS)
                )
                let lenLibrary = libraryFlight.length
                $('.InfoCountFlight').text(lenLibrary)
            }
        }
        let defaultFilterTimeDesF = null;
        defaultFilterTimeDesF = filterDurationTimeDesF
            ? (filterDurationTimeDesF)
            : (this.renderMinFilterTimeDes(librarySecondFlight));
        let defaultFilterTimeDesS = null;
        defaultFilterTimeDesS = filterDurationTimeDesS
            ? (filterDurationTimeDesS)
            : (this.renderMaxFilterTimeDes(librarySecondFlight));
        if (filterDurationTimeDesF !== "" || filterDurationTimeDesS !== "") {
            let lenLibraryDef = libraryFlight.length
            if (lenLibraryDef !== undefined) {
                libraryFlight = libraryFlight.filter(item =>
                    parseInt(this.renderStoppinfoF(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)) >= parseInt(defaultFilterTimeDesF) && parseInt(this.renderStoppinfoS(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)) <= parseInt(defaultFilterTimeDesS)
                )
                let lenLibrary = libraryFlight.length
                $('.InfoCountFlight').text(lenLibrary)
            }
        }

        if (filterExitTimeDepF !== "00" || filterExitTimeDepS !== "24") {
            let lenLibraryDef = libraryFlight.length
            if (lenLibraryDef !== undefined) {
                libraryFlight = libraryFlight.filter(item =>
                    this.renderShowExitTimeF(item.info.departureinformation.ticketinfooo.exitinfo.showexittime) >= filterExitTimeDepF && this.renderShowExitTimeS(item.info.departureinformation.ticketinfooo.exitinfo.showexittime) <= filterExitTimeDepS
                )
                let lenLibrary = libraryFlight.length
                $('.InfoCountFlight').text(lenLibrary)
            }
        }

        if (filterExitTimeDesF !== "00" || filterExitTimeDesS !== "24") {
            let lenLibraryDef = libraryFlight.length
            if (lenLibraryDef !== undefined) {
                libraryFlight = libraryFlight.filter(item =>
                    this.renderShowExitTimeF(item.info.returninformation.ticketinfooo.exitinfo.showexittime) >= filterExitTimeDesF && this.renderShowExitTimeS(item.info.returninformation.ticketinfooo.exitinfo.showexittime) <= filterExitTimeDesS
                )
                let lenLibrary = libraryFlight.length
                $('.InfoCountFlight').text(lenLibrary)
            }
        }


        if (airlines !== undefined) {
            if (airlines !== "") {
                airlines = airlines.split(",");
                libraryFlight = libraryFlight.filter(item => {
                    if (this.renderAirlineFilter(item.info).some(r => airlines.includes(r))) return item;
                })
            }
            let lenLibrary = libraryFlight.length
            $('.InfoCountFlight').text(lenLibrary)
        }

        if (stops_dep !== undefined) {
            if (stops_dep !== "") {
                stops_dep = stops_dep.split(",");
                libraryFlight = libraryFlight.filter(item => {
                    if (stops_dep.includes(this.renderStopsFilter(item.info.departureinformation.ticketinfooo.stoppinfoo.showstopinfo))) return item;
                })
            }
            let lenLibrary = libraryFlight.length
            $('.InfoCountFlight').text(lenLibrary)
        }
        if (stops_des !== undefined) {
            if (stops_des !== "") {
                stops_des = stops_des.split(",");
                libraryFlight = libraryFlight.filter(item => {
                    if (stops_des.includes(this.renderStopsFilter(item.info.returninformation.ticketinfooo.stoppinfoo.showstopinfo))) return item;
                })
            }
            let lenLibrary = libraryFlight.length
            $('.InfoCountFlight').text(lenLibrary)
        }
        let lenlibraryFlight = libraryFlight.length
        if (lenlibraryFlight == undefined) {
            $('.InfoCountFlight').text(0)
        } else {
            $('.InfoCountFlight').text(lenlibraryFlight)
            $('.Wapper-PagenumberFlight,.SearchInfoCount,.SearchInfoPrice').show()
        }
        libraryFlight = _.chunk(libraryFlight, perPageFlight, AllLibraryFlight);
        this.setState({
            AllLibraryFlight,
            libraryFlight,
            currentPageFlight: 1,
            maxPageFlight: libraryFlight.length === 0 ? 1 : libraryFlight.length
        })
    }
    renderStopsFilter(element) {
        let elementToSting = element.toString()
        return elementToSting

    }
    renderAirlineFilter(element) {
        let elementAdd = []
        for (let i = 0; i < element.departureinformation.routeshow.routesinfoo.length; i++) {
            elementAdd.push(element.departureinformation.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairline)

        }
        for (let i = 0; i < element.returninformation.routeshow.routesinfoo.length; i++) {
            elementAdd.push(element.returninformation.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairline)
        }

        return elementAdd
    }

    // Previous Page
    previousPage = event => {
        this.handleReset(event);
        this.handleClick(event);
        this.setState({
            currentPage: this.state.currentPage - 1,
            currentPage2: this.state.currentPage2 - 1,
            currentPage3: this.state.currentPage3 - 1

        })
    }
    // Next Page 
    nextPage = event => {
        this.handleReset(event);
        this.handleClick(event);
        this.setState({
            currentPage: this.state.currentPage + 1,
            currentPage2: this.state.currentPage2 + 1,
            currentPage3: this.state.currentPage3 + 1

        })
    }
    // Next Page3
    nextPage3 = event => {
        this.handleReset(event);
        this.handleClick(event);
        this.setState({
            currentPage: this.state.currentPage3,
            currentPage2: this.state.currentPage3 + 1,
            currentPage3: this.state.currentPage3 + 2
        })
    }

    nextPageFlight3 = event => {
        this.handleResetFlight(event);
        this.setState({
            currentPageFlight: this.state.currentPageFlight3,
            currentPageFlight2: this.state.currentPageFlight3 + 1,
            currentPageFlight3: this.state.currentPageFlight3 + 2
        })
    }


    nextPageFlight = event => {
        this.handleResetFlight(event);
        this.setState({
            currentPageFlight: this.state.currentPageFlight + 1,
            currentPageFlight2: this.state.currentPageFlight2 + 1,
            currentPageFlight3: this.state.currentPageFlight3 + 1
        })
    }
    previousPageFlight = event => {
        this.handleResetFlight(event);
        this.setState({
            currentPageFlight: this.state.currentPageFlight - 1,
            currentPageFlight2: this.state.currentPageFlight2 - 1,
            currentPageFlight3: this.state.currentPageFlight3 - 1
        })
    }
    // handle per page
    handlePerPage = evt => {
        this.setState({
            perPage: evt.target.value
        }, () => this.reorganiseLibrary());
        this.setState({
            perPage: evt.target.value
        }, () => this.reorganiseLibraryFlight());
    }

    renderShowExitTimeF(element) {
        let SplitElement = element.split(':')
        let SplitElementFirst = SplitElement[0]
        return SplitElementFirst
    }
    renderShowExitTimeS(element) {
        let SplitElement = element.split(':')
        let SplitElementFirst = SplitElement[0]
        let SplitElementSecond = SplitElement[1]
        if (SplitElementSecond > 0) {
            return parseInt(SplitElementFirst) + 1
        } else {
            return SplitElementFirst
        }
    }



    renderMinFilterTimeDep = (librarySecondFlight) => {
        return librarySecondFlight.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => this.renderStoppinfoF(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)
    }
    renderMaxFilterTimeDep = (librarySecondFlight) => {
        return librarySecondFlight.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => this.renderStoppinfoS(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)))
            return libMax > acc ? libMax : acc
        }, 0)
    }
    renderMinFilterTimeDes = (librarySecondFlight) => {
        return librarySecondFlight.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => this.renderStoppinfoF(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)
    }
    renderMaxFilterTimeDes = (librarySecondFlight) => {
        return librarySecondFlight.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => this.renderStoppinfoS(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)))
            return libMax > acc ? libMax : acc
        }, 0)
    }
    renderMinFilterTotal = (librarySecond) => {
        return librarySecond.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => item.totalCom))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)
    }
    renderMaxFilterTotal = (librarySecond) => {
        return librarySecond.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => item.totalCom))
            return libMax > acc ? libMax : acc
        }, 0)
    }
    renderMinTimeDep = () => {
        const { librarySecondFlight } = this.state;
        if (!librarySecondFlight || (librarySecondFlight && librarySecondFlight.length === 0)) {
            return ''
        }
        return librarySecondFlight.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => this.renderStoppinfoF(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)

    }

    renderMaxTimeDep = () => {
        const { librarySecondFlight } = this.state;
        if (!librarySecondFlight || (librarySecondFlight && librarySecondFlight.length === 0)) {
            return ''
        }
        return librarySecondFlight.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => this.renderStoppinfoS(item.info.departureinformation.ticketinfooo.stoppinfoo.showtiming)))
            return libMax > acc ? libMax : acc
        }, 0)
    }
    renderMinTimeDes = () => {
        const { librarySecondFlight } = this.state;
        if (!librarySecondFlight || (librarySecondFlight && librarySecondFlight.length === 0)) {
            return ''
        }
        return librarySecondFlight.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => this.renderStoppinfoF(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)
    }
    renderMaxTimeDes = () => {
        const { librarySecondFlight } = this.state;
        if (!librarySecondFlight || (librarySecondFlight && librarySecondFlight.length === 0)) {
            return ''
        }
        return librarySecondFlight.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => this.renderStoppinfoS(item.info.returninformation.ticketinfooo.stoppinfoo.showtiming)))
            return libMax > acc ? libMax : acc
        }, 0)
    }

    renderStoppinfoF(element) {
        let splitElement = element.split(" ")
        return splitElement[0].slice(0, -1)
    }
    renderStoppinfoS(element) {
        let splitElement = element.split(" ")
        let SplitElementSecond = splitElement[1]
        if (SplitElementSecond !== undefined) {
            let SliceElementSecond = splitElement[1].slice(0, -1)
            if (SliceElementSecond > 0) {
                return parseInt(splitElement[0].slice(0, -1)) + 1
            } else {
                return splitElement[0].slice(0, -1)
            }
        }
    }
    renderMinTotal = () => {
        const { librarySecond } = this.state;
        if (!librarySecond || (librarySecond && librarySecond.length === 0)) {
            return ''
        }
        return librarySecond.reduce((acc, lib) => {
            const libMin = Math.min(...lib.map(item => item.totalCom))
            return acc === undefined ? libMin : libMin < acc ? libMin : acc
        }, undefined)
    }
    renderMaxTotal = () => {
        const { librarySecond } = this.state;
        if (!librarySecond || (librarySecond && librarySecond.length === 0)) {
            return ''
        }
        return librarySecond.reduce((acc, lib) => {
            const libMax = Math.max(...lib.map(item => item.totalCom))
            return libMax > acc ? libMax : acc
        }, 0)
    }
     // handle filter
     handlerFilterHotelName = (event) => {
        this.handleReset(event);
            const { state_service, state_stars, state_availability, state_checktype, state_checkkey } = this.state;
            this.setState(
                {
                    filterNameHotel: event.target.value.toLowerCase()
                },
                () => {
                    this.reorganiseLibrary(state_service, state_stars, state_availability, state_checktype, state_checkkey);
                }
            )
        }


    // start handler filter price
    handlerFilterTotal = (event) => {
        this.handleReset(event);
        const { state_service, state_stars, state_availability, state_checktype, state_checkkey } = this.state;
        let renderMax = this.renderMaxTotal()
        let value = event.target.value
        let key = event.target.getAttribute("data-key")
        if (key == '1') {
            this.setState(
                {
                    filterTotalFHotel: event.target.value,
                    rangevalTotalFHotel: event.target.value,
                },
                () => {
                    this.reorganiseLibrary(state_service, state_stars, state_availability, state_checktype, state_checkkey);
                }
            )
        } else if (key == '2') {
            event.target.max = renderMax
            this.setState(
                {
                    filterTotalSHotel: event.target.value,
                    rangevalTotalSHotel: event.target.value,
                },
                () => {
                    this.reorganiseLibrary(state_service, state_stars, state_availability, state_checktype, state_checkkey);
                }
            )
        }
    }// end handler filter price
    //start handler filter ExitTime
    handlerFilterExitDep = (event) => {
        this.handleResetFlight(event);
        const { state_airlines, state_stops } = this.state;
        let value = event.target.value
        let key = event.target.getAttribute("data-key")
        if (key == '1') {
            if (value < 10) {
                this.setState(
                    {
                        filterExitTimeDepF: "0" + event.target.value,
                        rangevalExitTimeDepF: "0" + event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
            else {
                this.setState(
                    {
                        filterExitTimeDepF: event.target.value,
                        rangevalExitTimeDepF: event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
        } else if (key == '2') {
            if (value < 10) {
                this.setState(
                    {
                        filterExitTimeDepS: "0" + event.target.value,
                        rangevalExitTimeDepS: "0" + event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
            else {
                this.setState(
                    {
                        filterExitTimeDepS: event.target.value,
                        rangevalExitTimeDepS: event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
        }
    }//end handler filter ExitTime

    // start handler filter ExitTime
    handlerFilterExitDes = (event) => {
        this.handleResetFlight(event);
        const { state_airlines, state_stops } = this.state;
        let value = event.target.value
        let key = event.target.getAttribute("data-key")
        if (key == '1') {
            if (value < 10) {
                this.setState(
                    {
                        filterExitTimeDesF: "0" + event.target.value,
                        rangevalExitTimeDesF: "0" + event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
            else {
                this.setState(
                    {
                        filterExitTimeDesF: event.target.value,
                        rangevalExitTimeDesF: event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
        } else if (key == '2') {
            if (value < 10) {
                this.setState(
                    {
                        filterExitTimeDesS: "0" + event.target.value,
                        rangevalExitTimeDesS: "0" + event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
            else {
                this.setState(
                    {
                        filterExitTimeDesS: event.target.value,
                        rangevalExitTimeDesS: event.target.value + ": 00",
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }
        }
    }// end handler filter ExitTime



    // start handler filter StopTime
    handlerFilterTimeDep = (event) => {
        this.handleResetFlight(event);
        const { state_airlines, state_stops } = this.state;
        let value = event.target.value
        let key = event.target.getAttribute("data-key")
        if (key == '1') {
            if (value < 10) {
                this.setState(
                    {
                        filterDurationTimeDepF: event.target.value,
                        rangevalTimeDepF: "0" + event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            } else {
                this.setState(
                    {
                        filterDurationTimeDepF: event.target.value,
                        rangevalTimeDepF: event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }

        } else if (key == '2') {
            if (value < 10) {
                this.setState(
                    {
                        filterDurationTimeDepS: event.target.value,
                        rangevalTimeDepS: "0" + event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            } else {
                this.setState(
                    {
                        filterDurationTimeDepS: event.target.value,
                        rangevalTimeDepS: event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }

        }
    } // end handler filter StopTime
    // start handler filter StopTime
    handlerFilterTimeDes = (event) => {
        this.handleResetFlight(event);
        const { state_airlines, state_stops } = this.state;
        let value = event.target.value
        let key = event.target.getAttribute("data-key")
        if (key == '1') {
            if (value < 10) {
                this.setState(
                    {
                        filterDurationTimeDesF: event.target.value,
                        rangevalTimeDesF: "0" + event.target.value,
                    },
                    () => {
                        this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            } else {
                this.setState(
                    {
                        filterDurationTimeDesF: event.target.value,
                        rangevalTimeDesF: event.target.value,
                    },
                    () => {
                        this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }

        } else if (key == '2') {
            if (value < 10) {
                this.setState(
                    {
                        filterDurationTimeDesS: event.target.value,
                        rangevalTimeDesS: "0" + event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            } else {
                this.setState(
                    {
                        filterDurationTimeDesS: event.target.value,
                        rangevalTimeDesS: event.target.value,
                    },
                    () => {
                         this.reorganiseLibraryFlight(state_airlines, state_stops);
                    }
                )
            }

        }
    } // end handler filter StopTime   

  
    // handle render of library
    renderLibrary = () => {
        const { library, currentPage } = this.state;
        if (!library || (library && library.length === 0)) {
            return <div className="nodata">
                <div className="imgnodata"><img src="/images/no-result.png" alt="no-result" width="" height="" /></div>
                <div className="tltnodata">برای جستجوی شما نتیجه ای یافت نشد!</div>
                <div className="textnodata">شما می توانید با انجام مجدد عملیات جستجو,نتیجه مورد نظر خود را بیابید</div>
                <div className="optionsnodata"><button className="researchnodata" onClick={this.renderResearch} type="submit">جستجوی مجدد </button><input className="homepage" value="صفحه اصلی" onClick={this.renderhomepage} type="button" /></div>
            </div>
        }
        return library[currentPage - 1].map((item, i) => (
            <div className="ticket-box">
                <form method="post" action="">
                    {this.renderfhid(item)}
                    {this.renderOptionIdFirst(item)}
                    {this.renderproviderId(item)}
                    {this.renderprovider(item)}
                    {this.renderflightproviderId(item.flight._id)}
                    {this.renderflightprovider(item.flight._id)}
                    {this.renderroomidFirst(item)}
                    {this.renderadultsFirst(item)}
                    {this.renderchildwithbedFirst(item)}
                    {this.renderchildwithoutbedFirst(item)}
                    {this.renderinfantFirst(item)}
                    <input type="hidden" value='[##cms.json.header|cms.form.roomSearch##]' name="roomSearch" />
                    <input type="hidden" value="[##cms.form.fdate##]" name="fdate" />
                    <input type="hidden" value="[##cms.form.tdate##]" name="tdate" />
                    <input type="hidden" value="[##cms.form.checkin##]" name="checkin" />
                    <input type="hidden" value="[##cms.form.checkout##]" name="checkout" />
                    <input type="hidden" value="[##cms.form.from##]" name="from" />
                    <input type="hidden" value="[##cms.form.to##]" name="to" />
                    <input type="hidden" value="[##cms.form.Hotel-Date|(0)##]" name="Hotel-Date" />
                    <input type="hidden" value="[##cms.form.FlightClass##]" name="FlightClass" />
                    <input type="hidden" value={item.nights} name="nights" className="nightLink" />
                    <input type="hidden" value={item.supplier} name="supplier" />
                    <input type="hidden" value={item.countryid} name="inscountry" />
                    <input type="hidden" value={item.flight.flight_supplier} name="fsupplier" />
                    <input type="hidden" value={item.hotel_supplier} name="hsupplier" />
                    <input type="hidden" value={item.hotelinfo.hotelsearch.hotelid} name="hotelid" />
                    <input type="hidden" value={item.flight._id.value} name="idvalue" />


                    <div className="inner-box-hotel">

                        <div className="right-Hresrve right-FHresrve">
                            <div className="section_hotel float_right">
                                <div className="img-Hreserve">{this.renderImgHotel(item)}</div>
                            <div className="info-Rhotel">
                                <div className="realname"><a className="linkrealname"><span className="realname">{item.hotelinfo.hotelsearch.realname}</span></a></div>
                                <div className="clr"></div>
                                <div className="rating-Rhotel"><img src={(`/images/${item.hotelinfo.hotelsearch.star}-rating.png`)} width="80" height="14" alt="rating" />{this.renderProviderName_H(item)}</div>
                                <div className="first-room">
                                    <div className="rooms_tbody">
                                        <div className="first-row">
                                            <div className="other-rows2"><span className="tltrow">نوع اتاق : </span>{this.renderRoomtypeFirst(item)} </div>
                                            <div className="viewname"><span className="tltrow">نمای اتاق : </span><span>{item.hotelinfo.information.viewname}</span></div>
                                            <div className="availability"><span className="tltrow">وضعیت : </span>{this.renderavailabFirst(item)}</div>
                                            <div className="servicesHotel"><span className="tltrow">نوع سرویس : </span>{this.renderservicesFirst(item)}</div>
                                        </div>
                                        <div className="clr"></div>
                                    </div>
                                </div>
                                <div className="Details-box" onClick={e => this.select_room(e, item, i)}  data-active = {`${this.state.state_active_btn[i] ? "1" : "0"}`} >
                               <span>تغییر اتاق</span><i className={`icon icon-arrow-down-16 ${!this.state.visibleRoom[i] ? "downarrow" : "uparrow"}`} ></i>
                              </div>
                                                       
                                
                                    <div className="clr"></div>
                                
                            </div>
                                </div>
                                <div className="section_flight float_left">
                        {this.renderid(item.flight)}
                        {this.renderProductid(item.flight)}
                        <div className="p-relative">
                            <div className="ticket-arrive">
                                <div className="right-side2">
                                    <div className="inner-parts">
                                        <div className="ticket-logo "><img src={item.flight.info.departureinformation.ticketinfooo.showstartairline}
                                            width="60" height="24" alt={item.flight.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                            <span>{item.flight.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span>
                                            <span className="btn-large">
                                                    <div>{item.flight.info.departureinformation.ticketinfooo.classes.classname}</div>
                                            </span>
                                            {this.renderProviderName(item.flight)}
                                        </div>
                                    </div>
                                </div>
                                <div className="middle-side middelround">
                                    <div className="box1-ticket">
                                  
                                        <div className="info-beginDestination">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket1">{item.flight.info.departureinformation.ticketinfooo.exitinfo.showexittime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span>( {item.flight.info.departureinformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                    <span>{item.flight.info.departureinformation.infooo.showstartcity}</span>
                                                </div>

                                            </div>
                                        </div>

                                        <div className="rout">
                                            <div className="inner-rout">
                                                <div className="shape-rout">

                                                    <div className="line">
                                                        <span className="total-time">{item.flight.info.departureinformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                        {this.renderStopinfo(item.flight.info.departureinformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div className="info-beginDestination2">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket2">{item.flight.info.departureinformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span> ( {item.flight.info.departureinformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                    <span>{item.flight.info.departureinformation.infooo.showendcity} </span>
                                                </div>
                                                <div className="second-line2"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="clr"></div>
                            <div className="ticket-depart">
                                <div className="right-side2">
                                    <div className="inner-parts">
                                        <div className="ticket-logo ticket-logo2 "><img src={item.flight.info.returninformation.ticketinfooo.showstartairline}
                                            width="60" height="24" alt={item.flight.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                            <span>{item.flight.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span>
                                            <span className="btn-large">
                                                    <div>{item.flight.info.returninformation.ticketinfooo.classes.classname}</div>
                                            </span>
                                            {this.renderProviderName(item.flight)}
                                        </div>
                                    </div>
                                </div>
                                <div className="middle-side middelround">
                                    <div className="box1-ticket">
                                 
                                        <div className="info-beginDestination">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket1">{item.flight.info.returninformation.ticketinfooo.exitinfo.showexittime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span>( {item.flight.info.returninformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                    <span>{item.flight.info.returninformation.infooo.showstartcity}</span>
                                                </div>

                                            </div>
                                        </div>
                                        <div className="rout">
                                            <div className="inner-rout">

                                                <div className="shape-rout">

                                                    <div className="line">
                                                        <span className="total-time">{item.flight.info.returninformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                        {this.renderStopinfo(item.flight.info.returninformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                    </div>
                                                </div>



                                            </div>
                                        </div>
                                        <div className="info-beginDestination2">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket2">{item.flight.info.returninformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span> ( {item.flight.info.returninformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                    <span>{item.flight.info.returninformation.infooo.showendcity}</span>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="section_Details-box">
                         <span className="inner-box-moreInfo Details-box" onClick={((e) => this.showFlights(e, i, this.renderTotalComPack(item.totalCom), this.renderchid(item.flight), item.moneytype))}><span>تغییر پرواز</span></span> 
                         <span className="inner-box-moreInfo Details-box" onClick={((e) => this.showAllDetails(e, i))}><span>جزئیات  پرواز</span><i className={`icon icon-arrow-down-16 ${!this.state.VisiblesAllDetails[i] ? "downarrow" : "uparrow"}`} ></i></span> 
                         <div className="clr"></div>
                     </div>
                           
                   
                        </div>
                        <div className="clr"></div>
                    </div>
                    <div className="clr"></div>
                  
                            <div className="clr"></div>
         
                            <div className={`detalis-flight-main ${!this.state.VisiblesAllDetails[i] ? "unvisibleD" : "visibleD"}`}>
                            <div className={`details ${!this.state.activeTab_details[i] ? "" : "active-tab"}`} onClick={((e) => this.showDetails(e, i))}><a>جزییات پرواز</a></div>
                            <div className={`details ${!this.state.activeTab_rule[i] ? "" : "active-tab"}`} onClick={((e) => this.showRule(e, i))}> <a>قوانین پرواز</a> </div>
                            <div className={`details ${!this.state.activeTab_bar[i] ? "" : "active-tab"}`} onClick={((e) => this.showBar(e, i))}> <a>قوانین بار</a> </div>
                            <div key={i} className={`rulls-box ${!this.state.visibleDetailsFlight[i] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeDetails(i)}> <span className="fa-times"></span></div>
                                <div id="details-flight">
                                    <div className="table2 flightdetails">{this.renderFlightDetails(item.flight.info.departureinformation, 'dep')}</div>
                                </div>
                                <div id="details-flight2">
                                    <div className="table2 flightdetails2">{this.renderFlightDetails(item.flight.info.returninformation, 'des')}</div>
                                </div>
                            </div>
    
                            <div key={i} className={`rulls-box ${!this.state.visibleBarFlight[i] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeBar(i)}> <span className="fa-times"></span></div>
                                <div className="table">{this.renderBar(item.flight, i)}</div>
                            </div>
                            <div key={i} className={`rulls-box ${!this.state.visibleRuleFlight[i] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeRule(i)}> <span className="fa-times"></span></div>
                                <div className="table">{this.renderRule(item.flight, i)}</div>
                            </div>
                        </div>
                        <div className="clr"></div>
                        <div key={i} className={`${!this.state.loadingVisible[i] ? "unvisible" : "visible"}`}>
                        <div id="ballsWaveG">
                            <div id="ballsWaveG_1" className="ballsWaveG"></div>
                            <div id="ballsWaveG_2" className="ballsWaveG"></div>
                            <div id="ballsWaveG_3" className="ballsWaveG"></div>
                            <div id="ballsWaveG_4" className="ballsWaveG"></div>
                            <div id="ballsWaveG_5" className="ballsWaveG"></div>
                            <div id="ballsWaveG_6" className="ballsWaveG"></div>
                            <div id="ballsWaveG_7" className="ballsWaveG"></div>
                            <div id="ballsWaveG_8" className="ballsWaveG"></div>
                        </div>
                    </div>
                    <div key={i} className={`details-row p-relative ${!this.state.visibleRoom[i] ? "unvisible" : "visible"}`}>
                        <div className="close-btn p-absolute" onClick={() => this.closeRooms(i)}><span className="fa fa-times"></span></div>
                        <div className="details-item backgroud-color" >
                            {this.show_rooms(i, item.flight._id, item.countryid, item.flight.flight_supplier, item.hotel_supplier)}
                            <div className="clr"></div>
                        </div>
                    </div>

                     </div>
                        <div className="outer-left section_left">
                            <div className="left-side2 hotel-left-side2">
                                <div className="cost-ticket costTotal"><span>مبلغ کل : </span><span className="costi">{this.renderTotal(item, this.state.NewFlightAmount)}</span> <span className="monettypetbl">{item.moneytype}</span></div>
                                {this.renderCommission(item)}
                            {this.renderTotalcom(item, this.state.NewFlightAmount)}
                                <div className="reserve btnhotel">
                                    <div className="inner-search">
                                        <input className="linkreserve not-active-form" value="رزرو هتل" type="button" />
        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="clr"></div>
                </form>
            </div>
        ))
    }
    renderLibraryFlightDef = () => {
        const { libraryFlight, AllLibraryFlight } = this.state;
        if (!libraryFlight || (libraryFlight && libraryFlight.length === 0)) {
            return <div id="ballsWaveG" className="ChangeFlight-loader">
                <div id="ballsWaveG_1" className="ballsWaveG"></div>
                <div id="ballsWaveG_2" className="ballsWaveG"></div>
                <div id="ballsWaveG_3" className="ballsWaveG"></div>
                <div id="ballsWaveG_4" className="ballsWaveG"></div>
                <div id="ballsWaveG_5" className="ballsWaveG"></div>
                <div id="ballsWaveG_6" className="ballsWaveG"></div>
                <div id="ballsWaveG_7" className="ballsWaveG"></div>
                <div id="ballsWaveG_8" className="ballsWaveG"></div>
            </div>
        }
        return AllLibraryFlight.map((item, i) => (
            this.renderDefaultFlight(item)
        ))

    }
    renderLibraryFlightBreif = () => {
        const { libraryFlight, AllLibraryFlight } = this.state;
        if (!libraryFlight || (libraryFlight && libraryFlight.length === 0)) {
            return ''
        }
        return AllLibraryFlight.map((item, i) => (
            this.renderSearchInfo(item)
        ))

    }
    renderLibraryFlight = () => {
        const { libraryFlight, currentPageFlight } = this.state;
        if (!libraryFlight || (libraryFlight && libraryFlight.length === 0)) {
            return <div className="NoDataFlight unvisible">برای جستجوی شما نتیجه ای یافت نشد!</div>
        }
        return libraryFlight[currentPageFlight - 1].map((item, i) => (
            this.renderOthersFlight(item, i)


        ))

    }



    render() {
        const { library, currentPage, perPage, maxPage, libraryFlight, currentPageFlight, perPageFlight, maxPageFlight, rangevalTotalFHotel, rangevalTotalSHotel, rangevalExitTimeDepF, rangevalExitTimeDepS, rangevalExitTimeDesF, rangevalExitTimeDesS, rangevalTotalFFlight, rangevalTotalSFlight, rangevalTimeDepF, rangevalTimeDepS, rangevalTimeDesF, rangevalTimeDesS, librarySecond, librarySecondFlight } = this.state;
        let defaultRangeTotalF = null;
        defaultRangeTotalF = rangevalTotalFHotel
            ? (<span>{new Intl.NumberFormat().format(rangevalTotalFHotel)}</span>)
            : (<span>{new Intl.NumberFormat().format(this.renderMinTotal())}</span>);
        let defaultRangeTotalS = null;
        defaultRangeTotalS = rangevalTotalSHotel
            ? (<span>{new Intl.NumberFormat().format(rangevalTotalSHotel)}</span>)
            : (<span>{new Intl.NumberFormat().format(this.renderMaxTotal())}</span>);


        let defaultRangeTotalFFlight = null;
        defaultRangeTotalFFlight = rangevalTotalFFlight
            ? (<span>{new Intl.NumberFormat().format(rangevalTotalFFlight)}</span>)
            : (<span>{new Intl.NumberFormat().format(this.renderMinTotal())}</span>);
        let defaultRangeTotalSFlight = null;
        defaultRangeTotalSFlight = rangevalTotalSFlight
            ? (<span>{new Intl.NumberFormat().format(rangevalTotalSFlight)}</span>)
            : (<span>{new Intl.NumberFormat().format(this.renderMaxTotal())}</span>);

        let defaultRangeTimeDepF = null;
        defaultRangeTimeDepF = rangevalTimeDepF
            ? (<span>{rangevalTimeDepF}</span>)
            : (<span>{this.renderMinTimeDep()}</span>);
        let defaultRangeTimeDepS = null;
        defaultRangeTimeDepS = rangevalTimeDepS
            ? (<span>{rangevalTimeDepS}</span>)
            : (<span>{this.renderMaxTimeDep()}</span>);

        let defaultRangeTimeDesF = null;
        defaultRangeTimeDesF = rangevalTimeDesF
            ? (<span>{rangevalTimeDesF}</span>)
            : (<span>{this.renderMinTimeDes()}</span>);
        let defaultRangeTimeDesS = null;
        defaultRangeTimeDesS = rangevalTimeDesS
            ? (<span>{rangevalTimeDesS}</span>)
            : (<span>{this.renderMaxTimeDes()}</span>);
        return (
            <div>
    <div id="main-box-fliter">
        <div className="inner-box-filter">
            <div className="countHotel">تعداد <span className="numbersearch">{this.renderCount()} </span> هتل یافت شد .</div>
            <div className="counterbox">
                <div className="ttcounter">مدت زمان باقی مانده فرآیند رزرو</div><span id="count"></span>
            </div>
            <div className="slide_ExteraFilter">
                <div className="mainTlt-filter"><span>فیلتر نتایج هتل براساس : </span></div>
                <div className="filter-box">
                    <div className="title-filter"><span>نام هتل</span> </div>
                    <div className="items-filter">
                        <div className="every-item">
                            <div className="rightCheck" data-index="0">
                                <input value={this.state.filterNameHotel} onChange={this.handlerFilterHotelName} placeholder="نام هتل مورد نظر را وارد نمائید" className="hotelName" />
                            </div>
                            <div className="clr"></div>
                        </div>
                    </div>
                </div>

                <div className="filter-box">
                    <div className="title-filter"><span>قیمت</span> </div>
                    <div className="items-filter">
                        <div className="every-item">
                            <div className="wrappertimeTotal">
                                <input type="range" min={this.renderMinTotal() || 0} max='999999999'
                                    defaultValue='999999999' step="1000" onChange={this.handlerFilterTotal} data-key="2"
                                    className="multirange original" />
                                <input type="range" min={this.renderMinTotal()} max={this.renderMaxTotal()}
                                    defaultValue={this.renderMinTotal()} step="1000" onChange={this.handlerFilterTotal}
                                    data-key="1" className="multirange ghost" />
                                <div className="rangevalSecondTotal">{defaultRangeTotalS} <span>ریال</span></div>
                                <div className="rangevalFirstTotal">{defaultRangeTotalF} <span>ریال</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                {this.ShowFilterHotel()}
            </div>
        </div>
    </div>
    <div className="main-box-ticket">
        <div className="info-loading">
            <div className="inner-box-ticket">
                <div className="sort_box hotel_sort_box">
                    <div className="filter-sort-box">
                        <div className="items-filter">
                            <div>مرتب سازی بر اساس :</div>
                        </div>
                    </div>
                    <div className={`filter-sort-box ${this.state.activedefault}`}>
                        <div className="items-filter">
                            <div data-type="default" data-key="0" onClick={((e) => this.handleChange(e))}>پیش فرض
                    <span className={`sorticon ${this.state.activeDarrow} ${!this.state.defaultS[0] ? "uparrow" : "downarrow"}`} ></span>
                            </div>
                        </div>
                    </div>
                    <div className={`filter-sort-box ${this.state.activeprice}`} >
                        <div className="items-filter">
                            <div data-type="price" data-key={this.state.checkkeyprice} onClick={((e) => this.handleChange(e))}>قیمت
                  <span className={`sorticon ${this.state.activeParrow} ${!this.state.priceS[0] ? "uparrow" : "downarrow"}`} ></span>
                            </div>
                        </div>
                    </div>
                    <div className={`filter-sort-box ${this.state.activestar}`}>
                        <div className="items-filter">
                            <div data-type="star" data-key={this.state.checkkeystar} onClick={((e) =>
                                this.handleChange(e))}>درجه
                    <span className={`sorticon ${this.state.activeSarrow} ${!this.state.starS[0] ? "uparrow" : "downarrow"}`}></span>
                            </div>
                        </div>
                    </div>
                </div>
                {this.renderLibrary()}
                <div className="popup-background unvisible"></div>
                <div className="Change-flight  unvisible">
                    <div className="section-header background-color_2">
                        <span>تغییر پرواز</span>
                        <i className="fa fa-times" onClick={this.CloseChangeFlight}></i>
                    </div>
                    <div className="section-body">
                        <section className="col-filter scroll">
                            <div className="wrapper-95">
                                <div className="row-filter">
                                    <div className="search-info unvisible">
                                        <div className="search-info-item"><span
                                            className="question-info">تعداد پرواز :
                                        </span><span className="InfoCountFlight">1</span></div>
                                        <div className="search-info-item"><span
                                            className="question-info">قیمت کل تور :
                                        </span><span className="SearchInfoTotal">1</span></div>
    
                                        {this.renderLibraryFlightBreif()}
    
    
                                    </div>
                                    {this.ShowFilterFlight()}
              
                         
                                  
                                        <div className="filter-box">
                                            <div className="title-filter"><span><i className="fas fa-clock"></i> ساعت حرکت (رفت)</span> </div>
                                            <div className="items-filter">
                                                <div className="every-item">
                                                    <div className="wrappertime">
                                                        <img src="/images/moonstars.png" width="23" height="23" alt="moonstars" className="imgThird" />
                                                        <input type="range" min="0" max="24" defaultValue="24" step="1"
                                                            onChange={this.handlerFilterExitDep} data-key="2" className="multirange original" />
                                                        <input type="range" min="0" max="24" defaultValue="0" step="1"
                                                            onChange={this.handlerFilterExitDep} data-key="1" className="multirange ghost" />
                                                        <div className="rangevalSecond">{this.state.rangevalExitTimeDepS}
                                                        </div>
                                                        <img src="/images/sunrise.png" width="30" height="30" alt="sunrise" className="imgFirst" />

                                                        <div className="rangevalFirst">
                                                            {this.state.rangevalExitTimeDepF}
                                                        </div>
                                                        <img src="/images/sunny.png" width="25" height="25" alt="sunny" className="imgSecond" />
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div className="filter-box">
                                            <div className="title-filter"><span><i className="fas fa-clock"></i> ساعت حرکت (برگشت)</span> </div>
                                            <div className="items-filter">
                                                <div className="every-item">
                                                    <div className="wrappertime">
                                                        <img src="/images/moonstars.png" width="23" height="23" alt="moonstars" className="imgThird" />
                                                        <input type="range" min="0" max="24" defaultValue="24" step="1" onChange={this.handlerFilterExitDes} data-key="2" className="multirange original" />
                                                        <input type="range" min="0" max="24" defaultValue="0" step="1" onChange={this.handlerFilterExitDes} data-key="1" className="multirange ghost" />
                                                        <div className="rangevalSecond">{this.state.rangevalExitTimeDesS}
                                                        </div>
                                                        <img src="/images/sunrise.png" width="30" height="30" alt="sunrise" className="imgFirst" />
                                                        <div className="rangevalFirst">{this.state.rangevalExitTimeDesF}</div>
                                                        <img src="/images/sunny.png" width="25" height="25" alt="sunny" className="imgSecond" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="filter-box">
                                            <div className="title-filter"><span><i className="fas fa-dollar"></i> قیمت</span> </div>
                                            <div className="items-filter">
                                                <div className="every-item">
                                                    <div className="wrappertimeTotal">
                                                        <input type="range" min={this.renderMinTotal() || 0} max='999999999' defaultValue='999999999' step="1000"
                                                            onChange={this.handlerFilterTotal} data-key="2" className="multirange original" />
                                                        <input type="range" min={this.renderMinTotal()} max={this.renderMaxTotal()} defaultValue={this.renderMinTotal()} step="1000"
                                                            onChange={this.handlerFilterTotal} data-key="1" className="multirange ghost" />
                                                        <div className="rangevalSecondTotal">{defaultRangeTotalS} <span>ریال</span>
                                                        </div>
                                                        <div className="rangevalFirstTotal">{defaultRangeTotalF} <span>ریال</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="filter-box">
                                            <div className="title-filter"><span><i className="fas fa-clock"></i> مدت زمان سفر(رفت)</span> </div>
                                            <div className="items-filter">
                                                <div className="every-item">
                                                    <div className="wrappertimeTotal">
                                                        <input type="range" min={this.renderMinTimeDep()} max={this.renderMaxTimeDep()} defaultValue='100' step="1"
                                                            onChange={this.handlerFilterTimeDep} data-key="2" className="multirange original" />
                                                        <input type="range" min={this.renderMinTimeDep()} max={this.renderMaxTimeDep()} defaultValue='0' step="1"
                                                            onChange={this.handlerFilterTimeDep} data-key="1" className="multirange ghost" />
                                                        <div className="rangevalFirstTotal">{defaultRangeTimeDepF} <span>ساعت</span>
                                                        </div>
                                                        <div className="rangevalSecondTotal">{defaultRangeTimeDepS} <span>ساعت</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="filter-box">
                                            <div className="title-filter"><span><i className="fas fa-clock"></i> مدت زمان سفر(برگشت)</span> </div>
                                            <div className="items-filter">
                                                <div className="every-item">
                                                    <div className="wrappertimeTotal">
                                                        <input type="range" min={this.renderMinTimeDes()} max={this.renderMaxTimeDes()} defaultValue='100' step="1" onChange={this.handlerFilterTimeDes} data-key="2" className="multirange original" />
                                                        <input type="range" min={this.renderMinTimeDes()} max={this.renderMaxTimeDes()} defaultValue='0' step="1" onChange={this.handlerFilterTimeDes} data-key="1" className="multirange ghost" />
                                                        <div className="rangevalFirstTotal">{defaultRangeTimeDesF} <span className="MoneyType">ساعت</span></div>
                                                        <div className="rangevalSecondTotal">{defaultRangeTimeDesS} <span className="MoneyType">ساعت</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </section>
                        <section className="col-list-result scroll">
    
                            <div className="row-list">
                                {this.renderLibraryFlightDef()}
                                {this.renderLibraryFlight()}
                                <ul id="page-numbers" className="Wapper-PagenumberFlight">
                    <li className="nexprev">{currentPageFlight !== 1 && (<button onClick={this.previousPageFlight}><span className="fa-backward"></span></button>)}</li>
                    <li className="controls activeCnt">{this.state.currentPageFlight}</li>
                    {(this.state.currentPageFlight2 < maxPageFlight) && (<li className="controls" onClick={this.nextPageFlight}>{this.state.currentPageFlight2}</li>)}
                    {(this.state.currentPageFlight3 < maxPageFlight) && (<li className="controls" onClick={this.nextPageFlight3}>{this.state.currentPageFlight3}</li>)}
                    <li className="restControls">...</li>
                    <li className="controls">{this.state.maxPageFlight}</li>
                    <li className="nexprev">{(this.state.currentPageFlight < maxPageFlight) && (<button onClick={this.nextPageFlight}><span className="fa-forward"></span></button>)}</li>
                </ul>
   
                            </div>
                        </section>
                        <div className="clr"></div>
                    </div>
    
                    <div className="section-footer"><span className="" onClick={this.CloseChangeFlight}>انصراف</span></div>
                    <div className="clr"></div>
                </div>
                <ul id="page-numbers" className="Wapper-Pagenumber">
                    <li className="nexprev">{currentPage !== 1 && (<button onClick={this.previousPage}><span className="fa-backward"></span></button>)}</li>
                    <li className="controls activeCnt">{this.state.currentPage}</li>
                    {(this.state.currentPage2 < maxPage) && (<li className="controls" onClick={this.nextPage}>{this.state.currentPage2}</li>)}
                    {(this.state.currentPage3 < maxPage) && (<li className="controls" onClick={this.nextPage3}>{this.state.currentPage3}</li>)}
                    <li className="restControls">...</li>
                    <li className="controls">{this.state.maxPage}</li>
                    <li className="nexprev">{(this.state.currentPage < maxPage) && (<button onClick={this.nextPage}><span className="fa-forward"></span></button>)}</li>
                </ul>
            </div>
        </div>
    </div>

</div>
        )
    }


    renderhomepage = event => {
        return window.location = '/'
    }
    renderResearch = event => {
        return location.reload()
    }
    CloseChangeFlight = event => {
        $(".popup-background,.Change-flight").hide()
    }

    renderCount() {
        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let sum = len * maxPage
        sum = sum || 0
        if (sum == '0') {
            $(".Wapper-Pagenumber").hide()
            $(".row-list #bg-popup,.row-list .message_box").show()

        } else {
            $(".Wapper-Pagenumber").show()
            $(".row-list #bg-popup,.row-list .message_box").hide()
        }

    }
    handleClick(event) {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        })
        this.setState({
            currentPage: Number(event.target.id)
        })
    }
    handleReset(event){
       let maxPage = this.state.maxPage
       let len = this.renderLibrary().length
       let Multi = len * maxPage
       for (let i = 0; i <= Multi; i++) {
            this.setState(prevState => ({
                visibleRoom: { ...prevState.visibleRoom, [i]: "" },
                VisiblesRuleFlight: { ...prevState.VisiblesRuleFlight, [i]: "" },
                VisiblesBarFlight: { ...prevState.VisiblesBarFlight, [i]: "" },
                VisiblesDetailsFlight: { ...prevState.VisiblesDetailsFlight, [i]: "" },
                visibleAll: { ...prevState.visibleAll, [i]: "" },
                state_active_btn: { ...prevState.state_active_btn, [i]: "" },
            }))
        }
    }
    handleResetFlight(event){
        let maxPage = this.state.maxPageFlight
        let len = this.renderLibraryFlight().length
        let sum = len * maxPage
        for (let i = 0; i <= sum; i++) {
        this.setState(prevState => ({
        VisiblesDetailsFlight: { ...prevState.VisiblesDetailsFlight, [i + 'n']: "" },
        VisiblesRuleFlight: { ...prevState.VisiblesRuleFlight, [i + 'n']: "" },
        VisiblesBarFlight: { ...prevState.VisiblesBarFlight, [i + 'n']: "" },
        visibleAll: { ...prevState.visibleAll, [i + 'n']: "" }
       }))
     }
    }

 
    renderfhid(element) {
        let id = element.id
        if (typeof id === 'string') {
            return <input type="hidden" value={id} name="productid" />
        } else if (typeof id === 'object') {
            return <input type="hidden" value={id.hotelId} name="productid" />
        }
    }



    renderImgHotel(element) {
        let imghotel_garanti = element.hotelinfo.hotelsearch.hotelimage
        let imghotel_ws = element.hotelinfo.hotelsearch.webserviceimage
        if (imghotel_garanti == '') {
            return this.renderHotelidImg(element, imghotel_ws)
        } else {
            return this.renderHotelidImg(element, imghotel_garanti)
        }
    }
    renderHotelidImg(element, image) {
        return <form method="post" action='/Client_Hotel_Information.bc' target="_blank">
            {this.renderproviderid_hotelInfo(element)}
            {this.renderid_HotelInfo(element.flight)}
            <input type="hidden" value="6" name="type_module" />
            <input type="hidden" value={element.hotelinfo.hotelsearch.hotelid} name="hotelid" />
            <input type="hidden" value={element.families[0].optionId} name="optionId-hotel" />
            <input type="hidden" value={JSON.stringify(element.flight._id)} name="FlightId" />
            <input type="hidden" value={element.countryid} name="inscountry" />
            <input type="hidden" value={element.flight.flight_supplier} name="fsupplier" />
            <input type="hidden" value={element.hotel_supplier} name="hsupplier" />
            <input type="hidden" value='[##cms.json.header|cms.form.roomSearch##]' name="roomSearch" />
            <input type="hidden" value="[##cms.form.fdate##]" name="fdate" />
            <input type="hidden" value="[##cms.form.tdate##]" name="tdate" />
            <input type="hidden" value="[##cms.form.checkin##]" name="checkin" />
            <input type="hidden" value="[##cms.form.checkout##]" name="checkout" />
            <input type="hidden" value="[##cms.form.from##]" name="from" />
            <input type="hidden" value="[##cms.form.to##]" name="to" />
            <input type="hidden" value="[##cms.form.Hotel-Date|(0)##]" name="Hotel-Date" />
            <input type="hidden" value="[##cms.form.FlightClass##]" name="FlightClass" />
            <button type="submit" className="LinkToHotelInfo">
            <div className="effect-6 effects clearfix"><div className="img"><img src={image} title="جزئیات هتل" width="200" height="200" alt={element.hotelinfo.hotelsearch.realname} /><div className="overlay"><span className="expand">+</span></div></div></div></button>
        </form>
    }

    renderproviderid_hotelInfo(element) {
        let provider = element.id.provider
        if (provider == undefined) {
            return <input type="hidden" value="0" name="provider-hotel" />;
        }
        else {
            let providerId = element.id.provider.provider_id
            return <input type="hidden" value={providerId} name="provider-hotel" />;
        }
    }
    renderRoomtypeFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            indents.push(<span className="answer-info roomtype">{element.families[0].availablerooms[i].info.room}</span>)
        }
        return (
            indents
        )
    }
    renderavailabFirst(element) {
    let lenavailablerooms = element.families[0].availablerooms.length
    let indents = [];
    for (let i = 0; i < lenavailablerooms; i++) {
        let elem = element.families[0].availablerooms[i].info.availability
        if (elem == 'onrequest') {
            indents.push(<span><span className="fa-clock-o"></span><span>{element.families[0].availablerooms[i].info.availability}</span></span>)
        } else if (elem == 'available') {
            indents.push(<span><span className="fa-check2"></span><span>{element.families[0].availablerooms[i].info.availability}</span></span>)
        } else {
            indents.push(<span><span>-</span><span>{element.families[0].availablerooms[i].info.availability}</span></span>)
        }
    }
    return (
        indents
    )

}
    renderservicesFirst(servic) {
        let indents = [];
        indents.push(<span className="answer-info">{servic.families[0].services}</span>)
        return (indents)
    }
    renderEnddepartureMs_dep(element) {
        if (element.dateinfo[0].enddeparture[0] == undefined) {
            return element.dateinfo[1].enddeparture[0].mstring
        } else {
            return element.dateinfo[0].enddeparture[0].mstring
        }
    }
    renderEnddepartureSs_dep(element) {
        if (element.dateinfo[0].enddeparture[0] == undefined) {
            return element.dateinfo[1].enddeparture[0].sstring
        } else {
            return element.dateinfo[0].enddeparture[0].sstring
        }
    }
    renderEnddepartureMs_des(element) {
        if (element.dateinfo[0].endreturn[0] == undefined) {
            return element.dateinfo[1].endreturn[0].mstring
        } else {
            return element.dateinfo[0].endreturn[0].mstring
        }
    }
    renderEnddepartureSs_des(element) {
        if (element.dateinfo[0].endreturn[0] == undefined) {
            return element.dateinfo[1].endreturn[0].sstring
        } else {
            return element.dateinfo[0].endreturn[0].sstring
        }
    }
    renderStopinfo(element) {
        if (element == 0) {
            return <span className="stopORnotStop">بدون توقف</span>
        } else {
            return <span className="stopORnotStop">{stop} توقف</span>
        }
    }
    renderProviderName(element){
          if (element._id.provider == undefined) {
            const providerName = this.state.data_provider
            .filter((x) => x.id === 0)
            .map((x) => x.name);
            return <div className="provider-info">{providerName}</div>;
        } else {
            const providerName = this.state.data_provider
            .filter((x) => x.id === parseInt(element._id.provider.provider_id))
            .map((x) => x.name);
            return <div className="provider-info">{providerName}</div>;
        }
     
     
    }
    renderProviderName_H(element) {
        if(this.state.data_provider.length == 0){
            return ''
        }else{
            if (element.id.provider == undefined) {
           const providerName = this.state.data_provider
               .filter((x) => x.id === 0)
               .map((x) => x.name);
           return <div className="provider-info">{providerName}</div>;
       } else {
           const providerName = this.state.data_provider
               .filter((x) => x.id === parseInt(element.id.provider.provider_id))
               .map((x) => x.name);
           return <div className="provider-info">{providerName}</div>;
       }
        }
    }
    renderCommission(element) {
        let commissioncost = element.commissioncost
        let moneytype = element.moneytype
        if (commissioncost == 0) {
            return '';
        } else {
            return <div className="cost-ticket"><span className="cost-commission">کمیسیون:</span><span>{new Intl.NumberFormat().format(commissioncost)}</span><span className="moneytype">{moneytype}</span></div>
        }
    }
    renderTotalcom(element, NewFlightAmount) {
        let totalCom = element.totalCom
        let total = element.total
        let moneytype = element.moneytype
        if (totalCom == total) {
            return '';
        } else {
            if (NewFlightAmount == '') {
                return <div className="cost-ticket"><span className="cost-final">مبلغ نهایی: </span><span>{new Intl.NumberFormat().format(totalCom)}</span><span className="moneytype">{moneytype}</span></div>
            } else {
                return <div className="cost-ticket"><span className="cost-final">مبلغ نهایی: </span><span>{new Intl.NumberFormat().format(totalCom + NewFlightAmount)}</span><span className="moneytype">{moneytype}</span></div>
            }
        }
    }

    renderFlightDetails(element, deps) {
        let len = element.routeshow.routesinfoo.length
        let indents = [];
        for (let i = 0; i < len; i++) {
            indents.push(<div className="details-item">
                <p className="details_title font_weight">{this.renderDepOrDes(deps)}  ({element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsstartcity} - {element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsendcity})</p>
                <div className="content row">
                    <div className="details-col row first-col">
                        <span>{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.exit_date.sstring}/<span className="EnNum">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.exit_date.mstring}</span></span>
                        <span>{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.arrival_date.sstring}/<span className="EnNum">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.arrival_date.mstring}</span></span>
                    </div>
                    <div className="details-col row second-col">

                        <div className="city-dep">
                            <span className="city_hour">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.detailsexittime}</span>
                            <i className="city_sep-dot background-color_2"></i>
                            <label className="city_name">
                                <span>{element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsstartcity}،</span>
                                <span>({element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.detailsexitairport})</span>
                            </label>
                        </div>
                        <div className="duration-time d-flex">
                            <span className="duration-time_dot d-flex">
                                <i className="background-color_2"></i><i
                                    className="background-color_2"></i><i
                                        className="background-color_2"></i><i
                                            className="background-color_2"></i><i
                                                className="background-color_2"></i>
                            </span>
                            <span className="duration-time_text">مدت پرواز: {element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailstiming}</span>
                        </div>
                        <div className="city-dest">
                            <span className="city_hour">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.detailsarrivaltime}</span>
                            <i className="city_sep-dot background-color_2"></i>
                            <label className="city_name">
                                <span>{element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsendcity}،</span>
                                <span>({element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.detailsarrivalairport})</span>
                            </label>
                        </div>
                    </div>
                    <div className="details-col row third-col">
                        <img src={element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairlineimage} alt={element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairline} width="80" height="32"
                        />
                        <div className="class-item  p-relative">{element.ticketinfooo.classes.classname}</div>
                        <span className="code-item  p-relative"> شماره پرواز: {element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsroutecode}</span>
                    </div>
                </div>
            </div>);
        }
        return (
            indents
        )
    }
    renderDepOrDes(element) {
        if (element == 'dep') {
            return 'پرواز رفت '

        } else {
            return 'پرواز برگشت '
        }
    }
    renderRule(element, i) {
        if (typeof element.info.departureinformation.routeshow.description === 'string') {
            return <div className="description">
                <div>
                    <p>قوانین پرواز رفت :</p>
                    <div dir="auto" className="text-justify max-height" dangerouslySetInnerHTML={{ __html: element.info.departureinformation.routeshow.description }}></div>
                </div>

                <div>
                    <p>قوانین پرواز برگشت :</p>
                    <div dir="auto" className="text-justify max-height" dangerouslySetInnerHTML={{ __html: element.info.returninformation.routeshow.description }}></div>
                </div>
            </div>


        } else {
            return <div className="descriptionObject">
                <div>
                    <div className="box-price-title"> برای مشاهده اطلاعات پرواز رفت<span className="click" onClick={e => this.ruleDep(e, element, i)}> کلیک </span>کنید</div>
                    <div key={i} className={`${!this.state.loadingRuleDep[i] ? "unvisible" : "visible"}`}>
                        <div id="ballsWaveG">
                            <div id="ballsWaveG_1" className="ballsWaveG"></div>
                            <div id="ballsWaveG_2" className="ballsWaveG"></div>
                            <div id="ballsWaveG_3" className="ballsWaveG"></div>
                            <div id="ballsWaveG_4" className="ballsWaveG"></div>
                            <div id="ballsWaveG_5" className="ballsWaveG"></div>
                            <div id="ballsWaveG_6" className="ballsWaveG"></div>
                            <div id="ballsWaveG_7" className="ballsWaveG"></div>
                            <div id="ballsWaveG_8" className="ballsWaveG"></div>
                        </div>
                    </div>
                    <div dir="auto" className="text-justify  max-height" dangerouslySetInnerHTML={{ __html: this.state.ruleDepTxt[i] }}></div>
                </div>

                <div>
                    <div className="box-price-title"> برای مشاهده اطلاعات پرواز رفت<span className="click" onClick={e => this.ruleDes(e, element, i)}> کلیک </span>کنید</div>
                    <div key={i} className={`${!this.state.loadingRuleDes[i] ? "unvisible" : "visible"}`}>
                        <div id="ballsWaveG">
                            <div id="ballsWaveG_1" className="ballsWaveG"></div>
                            <div id="ballsWaveG_2" className="ballsWaveG"></div>
                            <div id="ballsWaveG_3" className="ballsWaveG"></div>
                            <div id="ballsWaveG_4" className="ballsWaveG"></div>
                            <div id="ballsWaveG_5" className="ballsWaveG"></div>
                            <div id="ballsWaveG_6" className="ballsWaveG"></div>
                            <div id="ballsWaveG_7" className="ballsWaveG"></div>
                            <div id="ballsWaveG_8" className="ballsWaveG"></div>
                        </div>
                    </div>
                    <div dir="auto" className="text-justify  max-height" dangerouslySetInnerHTML={{ __html: this.state.ruleDesTxt[i] }}></div>
                </div>

            </div>
        }
    }

    renderBar(element, i) {
        if (typeof element.info.departureinformation.routeshow.description === 'string') {
            return <div className="barBox">
                <div>
                    <p className="details_title font_weight">قوانین بار رفت :</p>
                    <div dir="auto" className="eachBarInfo"><span>بار کابین: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.info.departureinformation.bar.bar2 }}></span></div>
                    <div dir="auto" className="eachBarInfo"><span>بار مجاز: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.info.departureinformation.bar.bar1 }}></span></div>
                    <div className="clr"></div>
                </div>
                <div>
                    <p className="details_title font_weight">قوانین بار برگشت :</p>
                    <div dir="auto" className="eachBarInfo"><span>بار کابین: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.info.returninformation.bar.bar2 }}></span></div>
                    <div dir="auto" className="eachBarInfo"><span>بار مجاز: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.info.returninformation.bar.bar1 }}></span></div>
                    <div className="clr"></div>
                </div>
                <div className="clr"></div>
            </div>
        } else {
            return <div className="descriptionObject">
                <div>
                    <div className="box-price-title font_weight"> برای مشاهده قوانین بار رفت<span className="click" onClick={e => this.barDep(e, element.info.departureinformation, i)}> کلیک </span>کنید</div>
                    <div key={i} className={`${!this.state.loadingBarDep[i] ? "unvisible" : "visible"}`}>
                        <div id="ballsWaveG">
                            <div id="ballsWaveG_1" className="ballsWaveG"></div>
                            <div id="ballsWaveG_2" className="ballsWaveG"></div>
                            <div id="ballsWaveG_3" className="ballsWaveG"></div>
                            <div id="ballsWaveG_4" className="ballsWaveG"></div>
                            <div id="ballsWaveG_5" className="ballsWaveG"></div>
                            <div id="ballsWaveG_6" className="ballsWaveG"></div>
                            <div id="ballsWaveG_7" className="ballsWaveG"></div>
                            <div id="ballsWaveG_8" className="ballsWaveG"></div>
                        </div>
                    </div>
                    <div dir="auto" className="text-justify  max-height" dangerouslySetInnerHTML={{ __html: this.state.barDepTxt[i] }}></div>
                </div>
                <div>
                    <div className="box-price-title font_weight"> برای مشاهده قوانین بار برگشت<span className="click" onClick={e => this.barDes(e, element.info.returninformation, i)}> کلیک </span>کنید</div>
                    <div key={i} className={`${!this.state.loadingBarDes[i] ? "unvisible" : "visible"}`}>
                        <div id="ballsWaveG">
                            <div id="ballsWaveG_1" className="ballsWaveG"></div>
                            <div id="ballsWaveG_2" className="ballsWaveG"></div>
                            <div id="ballsWaveG_3" className="ballsWaveG"></div>
                            <div id="ballsWaveG_4" className="ballsWaveG"></div>
                            <div id="ballsWaveG_5" className="ballsWaveG"></div>
                            <div id="ballsWaveG_6" className="ballsWaveG"></div>
                            <div id="ballsWaveG_7" className="ballsWaveG"></div>
                            <div id="ballsWaveG_8" className="ballsWaveG"></div>
                        </div>
                    </div>
                    <div dir="auto" className="text-justify  max-height" dangerouslySetInnerHTML={{ __html: this.state.barDesTxt[i] }}></div>
                </div>

            </div>

        }
    }

    ruleDep = (e, element, i) => {
        this.showloadingRuleDep(e, i);
        const obj = new Object();
        obj["id"] = element._id
        obj["adults"] = element.adults.count
        obj["childs"] = element.childs.count
        obj["infant"] = element.infants.count
        delete obj["bar_info"];
        setTimeout(() => {
            let return_rule = function () {
                let tmp = null;
                $.ajax({
                    'async': false,
                    'type': "POST",
                    'global': false,
                    'dataType': 'html',
                    'url': "Client_FlightHotel_Flight_Rule.bc",
                    'data': { 'IdDesc': JSON.stringify(obj) },
                    'success': (response) => {
                        tmp = response;
                    }
                });
                return tmp;
            }();
            return this.setState(prevState => ({
                ruleDepTxt: { ...prevState.ruleDepTxt, [i]: return_rule },
                loadingRuleDep: { ...prevState.loadingRuleDep, [i]: "" }
            }))

        }, 1000)
    }
    ruleDes = (e, element, i) => {
        this.showloadingRuleDes(e, i);
        const obj = new Object();
        obj["id"] = element._id
        obj["adults"] = element.adults.count
        obj["childs"] = element.childs.count
        obj["infant"] = element.infants.count
        delete obj["bar_info"];
        setTimeout(() => {
            let return_rule = function () {
                let tmp = null;
                $.ajax({
                    'async': false,
                    'type': "POST",
                    'global': false,
                    'dataType': 'html',
                    'url': "Client_FlightHotel_Flight_Rule.bc",
                    'data': { 'IdDesc': JSON.stringify(obj) },
                    'success': (response) => {
                        tmp = response;
                    }
                });
                return tmp;
            }();
            return this.setState(prevState => ({
                ruleDesTxt: { ...prevState.ruleDesTxt, [i]: return_rule },
                loadingRuleDes: { ...prevState.loadingRuleDes, [i]: "" }
            }))

        }, 1000)
    }


    barDep = (e, element, i) => {
        this.showloadingBarDep(e, i);
        let id = element.routeshow.description
        setTimeout(() => {
            let return_rule = function () {
                let tmp = null;
                $.ajax({
                    'async': false,
                    'type': "POST",
                    'global': false,
                    'dataType': 'html',
                    'url': "Client_FlightHotel_Baggage_Rule.bc",
                    'data': { 'IdDesc': JSON.stringify(id) },
                    'success': (response) => {
                        tmp = response;
                    }
                });

                return tmp;
            }();
            return this.setState(prevState => ({
                barDepTxt: { ...prevState.barDepTxt, [i]: return_rule },
                loadingBarDep: { ...prevState.loadingBarDep, [i]: "" }
            }))

        }, 1000);
    };

    barDes = (e, element, i) => {
        this.showloadingBarDes(e, i);
        let id = element.routeshow.description
        setTimeout(() => {
            let return_rule = function () {
                let tmp = null;
                $.ajax({
                    'async': false,
                    'type': "POST",
                    'global': false,
                    'dataType': 'html',
                    'url': "Client_FlightHotel_Baggage_Rule.bc",
                    'data': { 'IdDesc': JSON.stringify(id) },
                    'success': (response) => {
                        tmp = response;
                    }
                });

                return tmp;
            }();
            return this.setState(prevState => ({
                barDesTxt: { ...prevState.barDesTxt, [i]: return_rule },
                loadingBarDes: { ...prevState.loadingBarDes, [i]: "" }
            }))

        }, 1000);
    };


    select_room = (e, element, i) => {
        let active_btn = this.state.state_active_btn[i];
        let provider = element.id.provider
        let optionId = element.families[0].optionId
        let IdFlight = $(".IdFlight").val()
        let mainprovider = 0
        if (provider == undefined) {
            mainprovider = "0"
        } else {
            mainprovider = element.id.provider
        }
        if(active_btn == '' ||  active_btn == undefined){
        this.setState(prevState => ({
            state_active_btn: { ...prevState.state_active_btn, [i]: !prevState.state_active_btn[i] },
        }))
        this.showLoading(e, i);
        setTimeout(() => {
            fetch('/Client_FlightHotel_ShowAllRooms.bc', {
                method: 'POST',
                body: 'mainprovider=' + JSON.stringify(mainprovider) + '&optionId=' + encodeURIComponent(optionId) + '&idproduct=' + IdFlight + ''
            })
                .then(response => response.text())
                .then(text => {
                    let Maindata = JSON.parse(text.replace(/\'/g, '"'))
                    this.setState(prevState => ({
                        VisiblesAllRooms: {
                            ...prevState.VisiblesAllRooms,
                            [i]: Maindata,
                        },
                        visibleRoom: { ...prevState.visibleRoom, [i]: !prevState.visibleRoom[i] },
                        loadingVisible: { ...prevState.loadingVisible, [i]: "" }
                    }))
                }).catch(error => console.error(error))
        }, 1000)
    }
    }

      show_rooms(i, FlightId, CountryId, FlightSupplier, HotelSupplier) {
        let element = this.state.VisiblesAllRooms[i];
        if (!element) return null;
        if (element.families !== undefined) {
            let lenfamilies = element.families.length
            let indents = [];
            for (let j = 0; j < lenfamilies; j++) {
                let index = 0;
                let numF = i;
                let numS = j;
                let stingF = numF.toString();
                let stingS = numS.toString();
                index = stingF + stingS
                indents.push(<form method="post" action="" className="info-Hotel">{this.renderOptionId(element.families[j])}
    {this.renderadults(element.families[j])}
    {this.renderchildwithbed(element.families[j])}
    {this.renderchildwithoutbed(element.families[j])}
    {this.renderinfant(element.families[j])}
    {this.renderroomid(element.families[j])}
    {this.renderfhid(element.families[j])}
    {this.renderproviderId(element.families[j])}
    {this.renderprovider(element.families[j])}
    {this.renderhotelidRooms(element.families[j], element)}
    {this.rendernightsRooms(element.families[j], element)}
    {this.rendersupplierRooms(element.families[j], element)}
    {this.renderFlightIdOtherRooms(FlightId)}
    <input type="hidden" value={CountryId} name="inscountry" />
    <input type="hidden" value={FlightSupplier} name="fsupplier" />
    <input type="hidden" value={HotelSupplier} name="hsupplier" />
    <input type="hidden" value='[##cms.json.header|cms.form.roomSearch##]' name="roomSearch" />
    <input type="hidden" value="[##cms.form.fdate##]" name="fdate" />
    <input type="hidden" value="[##cms.form.tdate##]" name="tdate" />
    <input type="hidden" value="[##cms.form.checkin##]" name="checkin" />
    <input type="hidden" value="[##cms.form.checkout##]" name="checkout" />
    <input type="hidden" value="[##cms.form.from##]" name="from" />
    <input type="hidden" value="[##cms.form.to##]" name="to" />
    <input type="hidden" value="[##cms.form.Hotel-Date|(0)##]" name="Hotel-Date" />
    <input type="hidden" value="[##cms.form.FlightClass##]" name="FlightClass" />
    <div className="eachroom"><div className="other-rows"><div className="other-rows2"><span className="tltrow">نوع اتاق : </span> {this.renderRoomtype(element.families[j])}</div>
        <div className="viewname"><span className="tltrow">نمای اتاق : </span><span>{this.renderviewnameRooms(element.families[j])}</span></div><div className="availability"><span className="tltrow">وضعیت : </span>{this.renderavailability(element.families[j])}
        </div>
        <div className="servicesHotel"><span className="tltrow">نوع سرویس : </span>{this.renderservices(element.families[j])}
            {this.renderProviderName_H(element.families[j])}
        </div>
        
    </div><div className="txtwebservice renderruleRoom">
            <span className="txtRul" key={index} onClick={e => this.handelruleRoom(e, element.families[j], index)}>قوانین اتاق</span>

        </div><div className="txtwebservice"><div className="f-part">
            {new Intl.NumberFormat().format(element.families[j].totalPrice)}
        <span className="monettypetbl">{this.rendermoneytype(element.families[j], element)}</span>
        </div><div className="s-part">
            {this.renderBtn(element, j, index)}
        </div></div><div className="clr"></div>
        <div key={index} className={`${!this.state.loadingVisible[index] ? "unvisible" : "visible"}`}>
            <div id="ballsWaveG">
                <div id="ballsWaveG_1" className="ballsWaveG"></div>
                <div id="ballsWaveG_2" className="ballsWaveG"></div>
                <div id="ballsWaveG_3" className="ballsWaveG"></div>
                <div id="ballsWaveG_4" className="ballsWaveG"></div>
                <div id="ballsWaveG_5" className="ballsWaveG"></div>
                <div id="ballsWaveG_6" className="ballsWaveG"></div>
                <div id="ballsWaveG_7" className="ballsWaveG"></div>
                <div id="ballsWaveG_8" className="ballsWaveG"></div>
            </div>
        </div>
        <div key={index} className={`popup-ruleRoom ${!this.state.ruleRoomVisibles[index] ? "unvisible" : "visible"}`} onClick={() => this.CloseRuleRoom(index)}>
            <div className="close-ruleromm" onClick={() => this.CloseRuleRoom(i)}><span className="fa-times"></span></div>
            <div className="outer-resultruleRoom"><div className="resultruleRoom" key={index} dir="auto" dangerouslySetInnerHTML={{ __html: this.state.resultruleRoom[index] }}></div></div>
        </div>

    </div>
</form>
                )
            }
            return (indents)
        }
        else {
            return null
        }
    }
    renderid(element) {
        let id = element._id
        if (typeof id === 'string') {
            return <input type="hidden" value={id} className="IdFlight" name="idnows" />
        } else if (typeof id === 'object') {
            return <span className="Flightid"><input type="hidden" value={element._id.value} className="IdFlight" /><input type="hidden" value={JSON.stringify(id)} name="idws" /></span>
        }
    }
    renderProductid(element){
         if (typeof element._id === 'string'){
           return <input type="hidden" value={element._id}  name="productid_f" />
         }else if(typeof element._id === 'object'){
             return <input type="hidden" value={element._id.value}  name="productid_f" />
         }
     }
    renderid_HotelInfo(element) {
        let id = element._id
        if (typeof id === 'string') {
            return <input type="hidden" value={id} name="Flight_Id" />
        } else if (typeof id === 'object') {
            return <input type="hidden" value={element._id.value} name="Flight_Id" />
        }
    }

    renderFlightIdOtherRooms(element) {
        let id = element
        if (typeof id === 'string') {
            return <span><input type="hidden" value={id} name="idnows" /><input type="hidden" value="0" name="fprovider" /><input type="hidden" value={element} name="productid_f" /></span>
        } else if (typeof id === 'object') {
            return <span><input type="hidden" value={JSON.stringify(id)} name="idws" /><input type="hidden" value={element.value} name="idvalue" /><input type="hidden" value={element.provider.provider_id} name="fprovider" /><input type="hidden" value={JSON.stringify(element.provider)} name="fmainprovider" /><input type="hidden" value={element.value} name="productid_f" /></span>
        }
    }

    renderchid(element) {
        let id = element._id
        if (typeof id === 'string') {
            return id
        } else if (typeof id === 'object') {
            return element._id.value
        }
    }
    renderprovider(element) {
        let provider = element.id.provider
        if (provider == undefined) {
            return '';
        } else {
            return <input type="hidden" value={JSON.stringify(provider)} name="mainprovider" />
        }
    }
    renderproviderId(element) {
        let provider = element.id.provider
        if (provider == undefined) {
            return <input type="hidden" value="0" name="provider" />;
        }
        else {
            let providerId = element.id.provider.provider_id
            return <input type="hidden" value={providerId} name="provider" />;
        }
    }
    renderflightprovider(element) {
        let provider = element.provider
        if (provider == undefined) {
            return '';
        } else {
            return <input type="hidden" value={JSON.stringify(provider)} name="fmainprovider" />
        }
    }
    renderflightproviderId(element) {
        let provider = element.provider
        if (provider == undefined) {
            return <input type="hidden" value="0" name="fprovider" />;
        } else {
            let providerId = element.provider.provider_id
            return <input type="hidden" value={providerId} name="fprovider" />;
        }
    }
    renderhotelidRooms(elementFamily, element) {
        let hotelIdFamily = elementFamily.id.hotelId
        if (hotelIdFamily == undefined) {
            return <input type="hidden" value={elementFamily.hotelid} name="hotelid" className="hotelidund" />
        } else {
            return <input type="hidden" value={hotelIdFamily} name="hotelid" />
        }
    }
    rendernightsRooms(elementFamily, element) {
        let hotelIdFamily = elementFamily.id.hotelId
        if (hotelIdFamily == undefined) {
            return <input type="hidden" value={element.nights} name="nights" className="nightund" />
        } else {
            return <input type="hidden" value={elementFamily.nights} name="nights" />
        }
    }
    rendersupplierRooms(elementFamily, element) {
        let hotelIdFamily = elementFamily.id.hotelId
        if (hotelIdFamily == undefined) {
            return <input type="hidden" value={element.supplier} name="supplier" />
        } else {
            return <input type="hidden" value={elementFamily.supplier} name="supplier" />
        }
    }

    rendermoneytype(elementFamily, element) {
        let hotelIdFamily = elementFamily.id.hotelId
        if (hotelIdFamily == undefined) {
            return <span className="monettypetbl">{element.moneytype}</span>
        } else {
            return <span className="monettypetbl">ریال</span>
        }
    }

    renderBtn(BtnFlight, j, index) {
            if (j == 0) {
            return  <button type="button" className="inner-box-moreInfo Details-box First not-active-form">انتخاب شده</button>
        } else {
            return  <button type="button" className="inner-box-moreInfo Details-box not-active-form">انتخاب اتاق</button>
        }
        }
    renderRoomtype(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            indents.push(<span className="answer-info roomtype">{element.availablerooms[i].info.room}</span>)
        }
        return (
            indents
        )
    }

    renderviewnameRooms(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            indents.push(<span className="answer-info">{element.availablerooms[i].info.viewname}</span>)
        }
        return (
            indents
        )

    }
    renderavailability(element) {
            let lenavailablerooms = element.availablerooms.length
            let indents = [];
            for (let i = 0; i < lenavailablerooms; i++) {
                let elem = element.availablerooms[i].info.availability
                if (elem == 'onrequest') {
                    indents.push(<span><span className="fa-clock-o"></span><span>{element.availablerooms[i].info.availability}</span></span>)
                } else if (elem == 'available') {
                    indents.push(<span><span className="fa-check2"></span><span>{element.availablerooms[i].info.availability}</span></span>)
                } else {
                    indents.push(<span><span>-</span><span>{element.availablerooms[i].info.availability}</span></span>)
                }
    
            }
            return (
                indents
            )
    
        }
    renderservices(element) {
        return <span className="answer-info">{element.services}</span>
    }

    renderadultsFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.adults`} value={element.families[0].availablerooms[i].info.adults} />)
        }
        return (
            indents
        )

    }
    renderchildwithbedFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.childwithbed`} value={element.families[0].availablerooms[i].info.withbed} />)
        }
        return (
            indents
        )

    }
    renderchildwithoutbedFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.childwithoutbed`} value={element.families[0].availablerooms[i].info.withoutbed} />)
        }
        return (
            indents
        )

    }
    renderinfantFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.infant`} value={element.families[0].availablerooms[i].info.infant} />)
        }
        return (
            indents
        )

    }
    renderroomidFirst(element) {
        let lenavailablerooms = element.families[0].availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.roomid`} value={element.families[0].availablerooms[i].info.roomid} />)
        }
        return (
            indents
        )

    }

    renderadults(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.adults`} value={element.availablerooms[i].info.adults} />)
        }
        return (
            indents
        )

    }
    renderchildwithbed(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.childwithbed`} value={element.availablerooms[i].info.withbed} />)
        }
        return (
            indents
        )

    }
    renderchildwithoutbed(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.childwithoutbed`} value={element.availablerooms[i].info.withoutbed} />)
        }
        return (
            indents
        )
    }
    renderinfant(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.infant`} value={element.availablerooms[i].info.infant} />)
        }
        return (
            indents
        )

    }
    renderroomid(element) {
        let lenavailablerooms = element.availablerooms.length
        let indents = [];
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i
            indents.push(<input type="hidden" name={`_root.rooms__${idx}.roomid`} value={element.availablerooms[i].info.roomid} />)
        }
        return (
            indents
        )

    }

    renderOptionId(element) {
        return <input type="hidden" value={element.optionId} name="optionId" />
    }
    renderTotalPrice(element) {
        if (element !== "0") {
            return new Intl.NumberFormat().format(element.substr(1)) + element.substr(0, 1)
        } else {
            return element
        }


    }
    renderOptionIdFirst(element) {
        let indents = [];
        indents.push(<input type="hidden" value={element.families[0].optionId} name="optionId" />)

        return (
            indents
        )
    }


    renderTotalComPack(element) {
        return element
    }
    showFlights = (e, elem, TotalComPack, productid, moneytype) => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        })

        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let sum = len * maxPage
        for (let i = 0; i <= sum; i++) {
            this.setState(prevState => ({
                visibleRoom: { ...prevState.visibleRoom, [i]: "" }
            }))
        }

        $(".popup-background,.Change-flight").show()
        $(document).trigger('update_flight', [TotalComPack, productid, moneytype])


    }

    renderSearchInfo(element) {
        let IdSelectedFlight = $(".IdFlight").val()

        let id = element._id
        if (id == IdSelectedFlight || id.value == IdSelectedFlight) {
            return <div>
                <div className="search-info-item "><span
                    className="question-info">مسیر : </span><span>{element.info.departureinformation.infooo.showstartcity}
                    </span><i className="fa fa-arrow-left"></i><span>{element.info.returninformation.infooo.showstartcity}</span>
                </div>
                <div className="search-info-item "><span
                    className="question-info"> تاریخ :</span> <span>{element.info.departureinformation.ticketinfooo.timesinfo}
                    </span><span className="seperator"> تا </span><span>
                        {element.info.returninformation.ticketinfooo.timesinfo}</span></div>
                <div className="search-info-item"><span
                    className="question-info">تعداد مسافران :
</span><span>1</span></div>
                <div className="search-info-item"><span>{element.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline}</span><img src={element.info.departureinformation.ticketinfooo.showstartairline}
                         alt="" width="50" height="20" />
                    <div className="clr"></div>
                </div> </div>
        }
    }


    renderDefaultFlight(element) {
        let IdSelectedFlight = $(".IdFlight").val()
        let id = element._id
        if (id == IdSelectedFlight || id.value == IdSelectedFlight) {
            return <div className="Wrapper-ChangeFlightDef"><div className="search-item transition selected">
                <div className="rightmain">
                <div className="ticket-arrive">
                            <div className="right-side2">
                                <div className="inner-parts">
                                    <div className="ticket-logo "><img src={element.info.departureinformation.ticketinfooo.showstartairline}
                                        width="100" height="40" alt={element.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                        <div className="flightClass"><span>شماره پرواز : {element.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                                        {this.renderProviderName(element)}
                                    </div>
                                </div>
                            </div>
                            <div className="middle-side middelround">
                                <div className="box1-ticket">
                                    <div className="flight-class">
                                        <div className="inner-info">
                                            <span className="btn-large">
                                                <div>کلاس پروازی <span  className="flight-classname">{element.info.departureinformation.ticketinfooo.classes.classname}</span></div>
                                            </span>
                                        </div>
                                    </div>
                                    <div className="info-beginDestination">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket1">{element.info.departureinformation.ticketinfooo.exitinfo.showexittime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span>( {element.info.departureinformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                <span>{element.info.departureinformation.infooo.showstartcity}</span>
                                            </div>

                                        </div>
                                    </div>

                                    <div className="rout">
                                        <div className="inner-rout">
                                            <div className="shape-rout">

                                                <span className="mstring float_right">{element.info.departureinformation.routeshow.dateinfo[0].startdeparture[0].mstring}</span>
                                                <span className="mstring float_left">{this.renderEnddepartureMs_dep(element.info.departureinformation.routeshow)}</span>
                                                <div className="line">
                                                    <span className="total-time">{element.info.departureinformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                    {this.renderStopinfo(element.info.departureinformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                </div>
                                                <span className="sstring float_right">({element.info.departureinformation.routeshow.dateinfo[0].startdeparture[0].sstring})</span>
                                                <span className="sstring float_left">({this.renderEnddepartureSs_dep(element.info.departureinformation.routeshow)})</span>
                                            </div>

                                        </div>
                                    </div>

                                    <div className="info-beginDestination2">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket2">{element.info.departureinformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span> ( {element.info.departureinformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                <span>{element.info.departureinformation.infooo.showendcity} </span>
                                            </div>
                                            <div className="second-line2"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="clr"></div>
                        <div className="ticket-depart">
                            <div className="right-side2">
                                <div className="inner-parts">
                                    <div className="ticket-logo ticket-logo2 "><img src={element.info.returninformation.ticketinfooo.showstartairline}
                                        width="100" height="40" alt={element.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                        <div className="flightClass"><span>شماره پرواز : {element.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                                        {this.renderProviderName(element)}
                                    </div>
                                </div>
                            </div>
                            <div className="middle-side middelround">
                                <div className="box1-ticket">
                                    <div className="flight-class">
                                        <div className="inner-info">
                                            <span className="btn-large">
                                                <div>کلاس پروازی <span  className="flight-classname">{element.info.returninformation.ticketinfooo.classes.classname}</span></div>
                                            </span>
                                        </div>
                                    </div>
                                    <div className="info-beginDestination">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket1">{element.info.returninformation.ticketinfooo.exitinfo.showexittime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span>( {element.info.returninformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                <span>{element.info.returninformation.infooo.showstartcity}</span>
                                            </div>

                                        </div>
                                    </div>
                                    <div className="rout">
                                        <div className="inner-rout">

                                            <div className="shape-rout">

                                                <span className="mstring float_right">{element.info.returninformation.routeshow.dateinfo[0].startreturn[0].mstring}</span>
                                                <span className="mstring float_left">{this.renderEnddepartureMs_des(element.info.returninformation.routeshow)}</span>
                                                <div className="line">
                                                    <span className="total-time">{element.info.returninformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                    {this.renderStopinfo(element.info.returninformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                </div>
                                                <span className="sstring float_right">({element.info.returninformation.routeshow.dateinfo[0].startreturn[0].sstring})</span>
                                                <span className="sstring float_left">({this.renderEnddepartureSs_des(element.info.returninformation.routeshow)})</span>
                                            </div>



                                        </div>
                                    </div>
                                    <div className="info-beginDestination2">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket2">{element.info.returninformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span> ( {element.info.returninformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                <span>{element.info.returninformation.infooo.showendcity}</span>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div className="left-side2">
                        <div className="left-side2-inner selected-left-side">
                            <div className="cost-ticket"></div>
                            <div className="reserve">
                                <div className="inner-search"><input type="button" onClick={this.CloseChangeFlight} className="dflbtn" value="انتخاب  شده" /></div>
                            </div>
                        </div>
                    </div>
                    <div className="clr"></div>
            </div>
                <div className="clr"></div>
            </div>
        }
    }
    renderOthersFlight(element, i) {
        let IdSelectedFlight = $(".IdFlight").val()
        let id = element._id
        if (id != IdSelectedFlight && id.value != IdSelectedFlight) {
            return <div className="Wrapper-ChangeFlight"><div className="search-item transition">
                <div className="rightmain">
                <div className="ticket-arrive">
                            <div className="right-side2">
                                <div className="inner-parts">
                                    <div className="ticket-logo "><img src={element.info.departureinformation.ticketinfooo.showstartairline}
                                        width="100" height="40" alt={element.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                        <div className="flightClass"><span>شماره پرواز : {element.info.departureinformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                                        {this.renderProviderName(element)}
                                    </div>
                                </div>
                            </div>
                            <div className="middle-side middelround">
                                <div className="box1-ticket">
                                    <div className="flight-class">
                                        <div className="inner-info">
                                            <span className="btn-large">
                                                <div>کلاس پروازی <span  className="flight-classname">{element.info.departureinformation.ticketinfooo.classes.classname}</span></div>
                                            </span>
                                        </div>
                                    </div>
                                    <div className="info-beginDestination">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket1">{element.info.departureinformation.ticketinfooo.exitinfo.showexittime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span>( {element.info.departureinformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                <span>{element.info.departureinformation.infooo.showstartcity}</span>
                                            </div>

                                        </div>
                                    </div>

                                    <div className="rout">
                                        <div className="inner-rout">
                                            <div className="shape-rout">

                                                <span className="mstring float_right">{element.info.departureinformation.routeshow.dateinfo[0].startdeparture[0].mstring}</span>
                                                <span className="mstring float_left">{this.renderEnddepartureMs_dep(element.info.departureinformation.routeshow)}</span>
                                                <div className="line">
                                                    <span className="total-time">{element.info.departureinformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                    {this.renderStopinfo(element.info.departureinformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                </div>
                                                <span className="sstring float_right">({element.info.departureinformation.routeshow.dateinfo[0].startdeparture[0].sstring})</span>
                                                <span className="sstring float_left">({this.renderEnddepartureSs_dep(element.info.departureinformation.routeshow)})</span>
                                            </div>

                                        </div>
                                    </div>

                                    <div className="info-beginDestination2">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket2">{element.info.departureinformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span> ( {element.info.departureinformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                <span>{element.info.departureinformation.infooo.showendcity} </span>
                                            </div>
                                            <div className="second-line2"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="clr"></div>
                        <div className="ticket-depart">
                            <div className="right-side2">
                                <div className="inner-parts">
                                    <div className="ticket-logo ticket-logo2 "><img src={element.info.returninformation.ticketinfooo.showstartairline}
                                        width="100" height="40" alt={element.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                        <div className="flightClass"><span>شماره پرواز : {element.info.returninformation.routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                                        {this.renderProviderName(element)}
                                    </div>
                                </div>
                            </div>
                            <div className="middle-side middelround">
                                <div className="box1-ticket">
                                    <div className="flight-class">
                                        <div className="inner-info">
                                            <span className="btn-large">
                                                <div>کلاس پروازی <span  className="flight-classname">{element.info.returninformation.ticketinfooo.classes.classname}</span></div>
                                            </span>
                                        </div>
                                    </div>
                                    <div className="info-beginDestination">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket1">{element.info.returninformation.ticketinfooo.exitinfo.showexittime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span>( {element.info.returninformation.ticketinfooo.exitinfo.shortstartairport} )</span>
                                                <span>{element.info.returninformation.infooo.showstartcity}</span>
                                            </div>

                                        </div>
                                    </div>
                                    <div className="rout">
                                        <div className="inner-rout">

                                            <div className="shape-rout">

                                                <span className="mstring float_right">{element.info.returninformation.routeshow.dateinfo[0].startreturn[0].mstring}</span>
                                                <span className="mstring float_left">{this.renderEnddepartureMs_des(element.info.returninformation.routeshow)}</span>
                                                <div className="line">
                                                    <span className="total-time">{element.info.returninformation.ticketinfooo.stoppinfoo.showtiming}</span>
                                                    {this.renderStopinfo(element.info.returninformation.ticketinfooo.stoppinfoo.showstopinfo)}
                                                </div>
                                                <span className="sstring float_right">({element.info.returninformation.routeshow.dateinfo[0].startreturn[0].sstring})</span>
                                                <span className="sstring float_left">({this.renderEnddepartureSs_des(element.info.returninformation.routeshow)})</span>
                                            </div>



                                        </div>
                                    </div>
                                    <div className="info-beginDestination2">
                                        <div className="inner-info">
                                            <div className="time-go">
                                                <span className="timeTicket2">{element.info.returninformation.ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                            </div>
                                            <div className="first-line2">
                                                <span> ( {element.info.returninformation.ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                <span>{element.info.returninformation.infooo.showendcity}</span>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="Details-box" onClick={((e) => this.showAllDetails(e, i + 'n'))} key={i + 'n'}>
  
                            <span>جزئیات پرواز</span><i className={`icon icon-arrow-down-16 ${!this.state.VisiblesAllDetails[i + 'n'] ? "downarrow" : "uparrow"}`} ></i>
                        </div>
                        <div className={`detalis-flight-main ${!this.state.VisiblesAllDetails[ i + 'n'] ? "unvisibleD" : "visibleD"}`}>
                            <div className={`details ${!this.state.activeTab_details[ i + 'n'] ? "" : "active-tab"}`} onClick={((e) => this.showDetails(e,  i + 'n'))}><a>جزییات پرواز</a></div>
                            <div className={`details ${!this.state.activeTab_rule[ i + 'n'] ? "" : "active-tab"}`} onClick={((e) => this.showRule(e,  i + 'n'))}> <a>قوانین پرواز</a> </div>
                            <div className={`details ${!this.state.activeTab_bar[ i + 'n'] ? "" : "active-tab"}`} onClick={((e) => this.showBar(e,  i + 'n'))}> <a>قوانین بار</a> </div>
                            <div key={ i + 'n'} className={`rulls-box ${!this.state.visibleDetailsFlight[ i + 'n'] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeDetails(i + 'n')}> <span className="fa-times"></span></div>
                                <div id="details-flight">
                                    <div className="table2 flightdetails">{this.renderFlightDetails(element.info.departureinformation, 'dep')}</div>
                                </div>
                                <div id="details-flight2">
                                    <div className="table2 flightdetails2">{this.renderFlightDetails(element.info.returninformation, 'des')}</div>
                                </div>
                            </div>
        
                            <div key={ i + 'n'} className={`rulls-box ${!this.state.visibleBarFlight[ i + 'n'] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeBar( i + 'n')}> <span className="fa-times"></span></div>
                                <div className="table">{this.renderBar(element,  i + 'n')}</div>
                            </div>
                            <div key={ i + 'n'} className={`rulls-box ${!this.state.visibleRuleFlight[ i + 'n'] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closeRule( i + 'n')}> <span className="fa-times"></span></div>
                                <div className="table">{this.renderRule(element,  i + 'n')}</div>
                            </div>
                        </div>

                        </div>
   
                <div className="left-side2 round-left-side2">
                        <div className="left-side2-inner">
                            <div className="cost-ticket"><span>افزایش قیمت : </span><span className="cost1">{this.renderTotalPrice(element.total)}</span><span className="moneytype">{element.moneytype}</span></div>
                          
                            <div className="reserve">
                                <div className="inner-search">
                                    <button type="button" onClick={((e) => this.ChangePrice(e, i, this.renderChangePrice(element.total), this.renderSignPrice(element.total), element.index))} className="dflbtn">انتخاب</button>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <div className="clr"></div>
            </div>
                <div className="clr"></div>
            </div>


        }

    }
    renderTotal(element, NewFlightAmount, NewFlightSign) {
        let total = element.total
        if (NewFlightAmount == '') {
            return new Intl.NumberFormat().format(total)
        } else {
            return new Intl.NumberFormat().format(total + NewFlightAmount)
        }
    }


    renderChangePrice(element) {
        if (element == '0') {
            return parseInt(element)
        } else {
            let SliceElementNumber = parseInt(element.substr(1))
            return parseInt(SliceElementNumber)
        }
    }

    renderSignPrice(element) {
        let SliceElementSign = element.slice(0, 1)
        return SliceElementSign
    }




    handelruleRoom = (e, element, index) => {
        let mainprovider = element.id.provider
        let optionId = element.optionId
        if (mainprovider == undefined) {
            return ''
        } else {
            this.showLoading(e, index);
            setTimeout(() => {
                let return_rule = function () {
                    let tmp = null;
                    $.ajax({
                        'async': false,
                        'type': "POST",
                        'global': false,
                        'dataType': 'html',
                        'url': "Client_FlightHotel_Room_Rule.bc",
                        'data': { 'mainprovider': JSON.stringify(mainprovider), 'optionId': optionId, },
                        'success': (response) => {
                            tmp = response;
                        }
                    });

                    return tmp;
                }();
                return this.setState(prevState => ({
                    resultruleRoom: { ...prevState.resultruleRoom, [index]: return_rule },
                    ruleRoomVisibles: { ...prevState.ruleRoomVisibles, [index]: !prevState.ruleRoomVisibles[index] },
                    loadingVisible: { ...prevState.loadingVisible, [index]: "" }
                }))

            }, 1000);
        }

    }
    CloseRuleRoom = (index) => {
           this.setState( prevState => ({
          ruleRoomVisibles: {[index]: !prevState.ruleRoomVisibles[index] }
          }))
        }
    renderpassenger() {
        let info = [##cms.json.header | cms.form.roomSearch##]
        let valueAdded = 0;
        let valueAdded2 = 0;
        let sum = 0;
        for (let i = 0; i < info.rooms.length; i++) {
            let adultcount = parseInt(info.rooms[i].adultcount);
            valueAdded += adultcount;
            let childcountandage = info.rooms[i].childcountandage
            let spl = childcountandage.split(",");
            let childcount = parseInt(spl[0]);
            valueAdded2 += childcount;
        }
        valueAdded = parseInt(valueAdded)
        valueAdded2 = parseInt(valueAdded2)
        sum = valueAdded2 + valueAdded
        return sum
    }
    ShowFilterHotel() {
        let element = this.state.data;
        if (!element) return null;
        return <div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>درجه مکان اقامتی</span> </div>
                <div className="items-filter grade_results">
                    {this.renderstars(element)}
                    <div className="clr"></div>
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>سرویس</span> </div>
                <div className="items-filter">
                    {this.renderservice(element)}
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>وضعیت</span> </div>
                <div className="items-filter">
                    {this.renderAllavailability(element)}
                </div>
            </div>
        </div>
    }
    renderstars(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['hotelinfo']['hotelsearch']['star']).flat()))]
            let singleSentence = sentences.map(s => <React.Fragment><div className="item2 grade_filter"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="stars" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"  className="lable_content" ><span className="checkbox"><span><img src={(`/images/${s}-rating.png`)} width="80" height="14" alt="rating" /></span></span><span className="total_content">از <span className="min_total">{new Intl.NumberFormat().format(this.min_totalByGrade(element, s))}</span><span className="unit_content">{[...(new Set(element.map(x => x.moneytype)))]}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
            let output = singleSentence
            return (
                output
            )
        }
    }
    min_totalByGrade = (data, name) => {
        const totals = data
            .filter(x =>
                x.hotelinfo.hotelsearch.star === name)
            .map(x => x.total);
        return Math.min(...totals);
    }
    renderservice(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['families']).flat().map(info => info['services'])))]
            let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="service" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"  className="lable_content" ><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
            let output = singleSentence
            return (
                output
            )
        }
    }
    renderAllavailability(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['families']).flat().map(info => info['availablerooms']).flat().map(info => info['info']['availability'])))]
            let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="all_availability" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"  className="lable_content" ><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
            let output = singleSentence
            return (
                output
            )
        }
    }
    handleChange = (e) => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
        this.handleReset(e);
        let checktype = e.target.getAttribute("data-type")
        let checkkey = e.target.getAttribute("data-key")
        let isChecked = e.target.checked
        let valu = e.target.value
        let classname = e.target.getAttribute("class");
        switch (classname) {
            case 'service':
                if (isChecked) {
                    this.service.push(valu + ',')
                } else {
                    this.service.splice(this.service.indexOf(valu + ','), 1)
                }
                break;
            case 'stars':
                if (isChecked) {
                    this.stars.push(valu + ',')
                } else {
                    this.stars.splice(this.stars.indexOf(valu + ','), 1)
                }
                break;
            case 'all_availability':
                if (isChecked) {
                    this.availability.push(valu + ',')
                } else {
                    this.availability.splice(this.availability.indexOf(valu + ','), 1)
                }
                break;

        }
        $(document).trigger('update_result', [this.service.join(), this.stars.join(), this.availability.join(), checktype, checkkey])
    }
    ShowFilterFlight() {
        let element = this.state.dataFlight;
        if (!element) return null;
        return <div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>خطوط هوایی</span> </div>
                <div className="items-filter airline_results">

                    {this.renderairlines(element)}
                    <div className="clr"></div>
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>توقف (مسیر رفت)</span> </div>
                <div className="items-filter">
                    {this.renderstop_dep(element)}
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>توقف (مسیر برگشت)</span> </div>
                <div className="items-filter">
                    {this.renderstop_des(element)}
                </div>
            </div>
        </div>
    }
    renderairlines(element) {
        let indents = [];
        if (element.length !== undefined) {


            let sentencesDep = [...(new Set(element.map(d => d['info']['departureinformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairline'])))]
            let sentencesDes = [...(new Set(element.map(d => d['info']['returninformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairline'])))]
            let sentences = sentencesDep.concat(sentencesDes.filter((item) => sentencesDep.indexOf(item) < 0))
            let imgDep = [...(new Set(element.map(d => d['info']['departureinformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
            let imgDes = [...(new Set(element.map(d => d['info']['returninformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
            let sentencesimg = imgDep.concat(imgDes.filter((item) => imgDep.indexOf(item) < 0))

            for (let i = 0; i < sentences.length; i++) {
                let singleSentence = <div className="item2 airline_filter"><div className="right rightCheck" data-index="1"><input type="checkbox" value={sentences[i]} className="startairline" onChange={((e) => this.handleChangeFlight(e))} defaultChecked={this.props.defaultChecked} /><label className="lable_content" for="filter"><span className="checkbox"><span className="name_airline">{sentences[i]}</span></span><span className="total_content">از <span className="min_total">{new Intl.NumberFormat().format(this.min_totalByAirline(element, sentences[i]))}</span><span className="unit_content">{[...(new Set(element.map(x => x.moneytype)))]}</span></span></label></div><div className="clr"></div></div>
                let output = singleSentence
                indents.push(singleSentence)

            }

            return (
                indents
            )

        }
    }



    renderairlineimg(element) {
        let sentencesDepimg = [...(new Set(element.map(d => d['info']['departureinformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
        let sentencesDesimg = [...(new Set(element.map(d => d['info']['returninformation']['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
        let sentencesimg = sentencesDepimg.concat(sentencesDesimg.filter((item) => sentencesDepimg.indexOf(item) < 0))
        let singleSentenceimg = sentencesimg.map(s => <img src={s} alt="" width="100" height="40" />);
        let output = singleSentenceimg
        return (
            output
        )

    }
    min_totalByAirline = (data, name) => {
        const totalsDep = data
            .filter(x =>
                x.info.departureinformation.routeshow.routesinfoo.find(y => y.routesinfoodetails.otherdetails.detailsairline === name)
            ).map(x => x.total);

        const totalsDes = data
            .filter(x =>
                x.info.returninformation.routeshow.routesinfoo.find(y => y.routesinfoodetails.otherdetails.detailsairline === name)
            ).map(x => x.total);

        return Math.min(...totalsDep, ...totalsDes);
    }

    renderstop_dep(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['info']['departureinformation']['ticketinfooo']['stoppinfoo']['showstopinfo']).flat()))]
            let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="stops_dep" onChange={((e) => this.handleChangeFlight(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"  className="lable_content" ><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
            let output = singleSentence
            return (
                output
            )
        }
    }
    renderstop_des(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['info']['returninformation']['ticketinfooo']['stoppinfoo']['showstopinfo']).flat()))]
            let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="stops_des" onChange={((e) => this.handleChangeFlight(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"  className="lable_content" ><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
            let output = singleSentence
            return (
                output
            )
        }
    }
    handleChangeFlight = (e) => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
        this.handleResetFlight(e);
        let isChecked = e.target.checked
        let valu = e.target.value
        let classname = e.target.getAttribute("class");
        switch (classname) {
            case 'startairline':
                if (isChecked) {
                    this.airlines.push(valu + ',')
                } else {
                    this.airlines.splice(this.airlines.indexOf(valu + ','), 1)
                }
                break;
            case 'stops_dep':
                if (isChecked) {
                    this.stops_dep.push(valu + ',')
                } else {
                    this.stops_dep.splice(this.stops_dep.indexOf(valu + ','), 1)
                }
                break;
            case 'stops_des':
                if (isChecked) {
                    this.stops_des.push(valu + ',')
                } else {
                    this.stops_des.splice(this.stops_des.indexOf(valu + ','), 1)
                }
                break;    
        }
        $(document).trigger('update_resultFlight', [this.airlines.join(), this.stops_dep.join(), this.stops_des.join()])
    }


    showDetails = (e, i) => {
        this.setState(prevState => ({
            visibleDetailsFlight: { ...prevState.visibleDetailsFlight, [i]: !prevState.visibleDetailsFlight[i] },
            activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
        }))
        if (this.state.visibleBarFlight[i] == true) {
            this.setState(prevState => ({
                visibleBarFlight: { ...prevState.visibleBarFlight, [i]: !prevState.visibleBarFlight[i] },
                activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
            }))
        }

        if (this.state.visibleRuleFlight[i] == true) {
            this.setState(prevState => ({
                visibleRuleFlight: { ...prevState.visibleRuleFlight, [i]: !prevState.visibleRuleFlight[i] },
                activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
            }))
        }
    }
    showBar = (e, i) => {
        this.setState(prevState => ({
            visibleBarFlight: { ...prevState.visibleBarFlight, [i]: !prevState.visibleBarFlight[i] },
            activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
        }))
        if (this.state.visibleDetailsFlight[i] == true) {
            this.setState(prevState => ({
                visibleDetailsFlight: { ...prevState.visibleDetailsFlight, [i]: !prevState.visibleDetailsFlight[i] },
                activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
            }))
        }

        if (this.state.visibleRuleFlight[i] == true) {
            this.setState(prevState => ({
                visibleRuleFlight: { ...prevState.visibleRuleFlight, [i]: !prevState.visibleRuleFlight[i] },
                activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
            }))
        }
    }
    showRule = (e, i) => {
        this.setState(prevState => ({
            visibleRuleFlight: { ...prevState.visibleRuleFlight, [i]: !prevState.visibleRuleFlight[i] },
            activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
        }))
        if (this.state.visibleDetailsFlight[i] == true) {
            this.setState(prevState => ({
                visibleDetailsFlight: { ...prevState.visibleDetailsFlight, [i]: !prevState.visibleDetailsFlight[i] },
                activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
            }))
        }
        if (this.state.visibleBarFlight[i] == true) {
            this.setState(prevState => ({
                visibleBarFlight: { ...prevState.visibleBarFlight, [i]: !prevState.visibleBarFlight[i] },
                activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
            }))
        }

    }
    showAllDetails = (e, i) => {
        this.setState(prevState => ({
            VisiblesAllDetails: { ...prevState.VisiblesAllDetails, [i]: !prevState.VisiblesAllDetails[i] },
            visibleDetailsFlight: { ...prevState.visibleDetailsFlight, [i]: !prevState.visibleDetailsFlight[i] },
            activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
        }))
    }




    showloadingRuleDep = (e, i) => {
        this.setState(prevState => ({
            loadingRuleDep: { ...prevState.loadingRuleDep, [i]: !prevState.loadingRuleDep[i] }
        }))
    }
    showloadingRuleDes = (e, i) => {
        this.setState(prevState => ({
            loadingRuleDes: { ...prevState.loadingRuleDes, [i]: !prevState.loadingRuleDes[i] }
        }))
    }
    showloadingBarDep = (e, i) => {
        this.setState(prevState => ({
            loadingBarDep: { ...prevState.loadingBarDep, [i]: !prevState.loadingBarDep[i] }

        }))
    };
    showloadingBarDes = (e, i) => {
        this.setState(prevState => ({
            loadingBarDes: { ...prevState.loadingBarDes, [i]: !prevState.loadingBarDes[i] }

        }))
    };

    showLoading = (e, i) => {
        this.setState(prevState => ({
            loadingVisible: { ...prevState.loadingVisible, [i]: !prevState.loadingVisible[i] }
        }))
    }
    closeRooms = (i) => {
        this.setState(prevState => ({
            visibleRoom: { ...prevState.visibleRoom, [i]: "" },
            state_active_btn: { ...prevState.state_active_btn, [i]: "" },
        }))
    }
    closeDetails = (i) => {
        this.setState(prevState => ({
            visibleDetailsFlight: { ...prevState.visibleDetailsFlight, [i]: !prevState.visibleDetailsFlight[i] }
        }))
    }

    closeRule = (i) => {
        this.setState(prevState => ({
            visibleRuleFlight: { ...prevState.visibleRuleFlight, [i]: !prevState.visibleRuleFlight[i] }
        }))
    }
    closeBar = (i) => {
        this.setState(prevState => ({
            visibleBarFlight: { ...prevState.visibleBarFlight, [i]: !prevState.visibleBarFlight[i] }
        }))
    }

    ChangePrice = (e, i, elem, elemS, index) => {

        const itemToReplace = this.state.AllLibraryFlight[index];
        let { data } = this.state;
        data = data.map((el, idx) => {
            return Object.assign({}, el, { flight: itemToReplace });
        });
        this.setState({ data: data }, () => { this.reorganiseLibrary() });
        if (elemS == '+' || elemS == '0') {
            this.setState(
                {
                    NewFlightAmount: parseInt((this.state.NewFlightAmount || 0) + elem),
                    MinusSumElement: elemS,

                },
                () => {

                    $(".popup-background,.Change-flight").hide()
                    this.reorganiseLibrary();
                }
            )
        } else {
            this.setState(
                {
                    NewFlightAmount: parseInt((this.state.NewFlightAmount || 0) - elem),
                    MinusSumElement: elemS,

                },
                () => {

                    $(".popup-background,.Change-flight").hide()
                    this.reorganiseLibrary();
                }
            )
        }

    }

}
ReactDOM.render(<App />, document.getElementById('Result'))
        }
   </script>
<script type="text/javascript">
var progress = $(".loading-progress").progressTimer({
    timeLimit: 40,
    onFinish: function () {}
});
$.ajax({
    url: "/"
});

function onloadFunc() {
    var counter = 300;
    setInterval(function () {
        counter--;
        var m = parseInt(counter / 60);
        var s = counter % 60;
        if (counter >= 0) {
            span = document.getElementById("count");
            if(span !== null){
                if (s < 10) {
                   s = "0" + s;
                }
                if (m < 10) {
                   m = "0" + m;
                }
                if (m < 2) {
                   document.getElementById("count").classList.add("blink_me")
                }
                span.innerHTML = "00:" + m + ":" + s;
            }
        }
        if (counter === 0) {
            $(".boxalert,#bg-popup-timeout").fadeIn();
            $(".boxalert").css("top", "200px")
            clearInterval(counter);
        }
    }, 1000);

};

//<!---------------------------------JS RESEARCH--------------------------------->
//<!-----------JS CALENDARE----------->
$(document).ready(function () {
    if ($(window).width() <= 750) {
        $(".frm").attr('action', '/M_FlightHotel_Search.bc')
    }
    if ($(".departuredate").val() == $(".persiancurrent").val()) {
        $(".prevdate").hide()
        $('.nextdate').click(NextDate);
    } else {
        $('.prevdate').click(PrevDate);
        $('.nextdate').click(NextDate);
    }
});

function openNextCal(e) {
        if ($('.Wrapper-ExteraHoteldate').is(':visible')) {
            let returnDate = $('.Wrapper-ExteraHoteldate').find('.nextCalOpeningex').val();
            if (returnDate == '') {
                $('.Wrapper-ExteraHoteldate').find('.nextCalOpeningex').trigger("onclick");
            }
            } else {
                let returnDate = $('#r-flighthotel').find('.nextCalOpening').val();
                if (returnDate == '') {
                    $('#r-flighthotel').find('.nextCalOpening').trigger("onclick");
                }
            }
};

//<!-----------JS PASSENGERS----------->
$(".content-HotelTour").each(function () {
    var json = [##cms.json.header | cms.form.roomSearch##]
    var room = json.rooms.length
    var ad = ""
    var ch = ""
    for (var i = 0; i < room; i++) {
        ad = ad + json.rooms[i].adultcount + ','
        ch = ch + json.rooms[i].childcountandage + '*'
    }
    ad = ad.slice(0, -1)
    ch = ch.slice(0, -1)
    $(".roomcount").val(room)
    $(this).find(".count-room").text('تعداد اتاق: ' + room)
    var m = room;
    var n = ad
    var x = ch
    var sp = n.split(",");
    var sp2 = x.split("*")

    var ad = 0;
    var sum = 0;
    for (var y = 0; y < sp.length; y++) {
        var adultcount = parseInt(sp[y])
        ad += adultcount;
    }
    sum = parseInt(ad)
    $(this).find(".count-adultRoom").text('بزرگسال : ' + sum)

    var ch = 0;
    var sum2 = 0;
    for (var z = 0; z < sp2.length; z++) {
        var q = sp2[z]
        var p = q.split(",")
        var childcount = parseInt(p[0])
        ch += childcount;

    }
    sum2 = parseInt(ch)
    $(this).find(".count-childRoom").text('کودک: ' + sum2)
    $(this).find(".countRoom").empty()
    for (i = 1; i <= m; i++) {

        $(this).find(".countRoom").addClass("tttest")
        var childage = ""
        var q = sp2[i - 1]
        var p = q.split(",")
        var s = p.length
        if (p[0] > 0) {
            var age = ""
            var chage = ""
            for (var j = 1; j < s; j++) {
                age = age + '<div class="age-selection"><label class="label">سن کودک ' + j +
                    '</label><select class="select-age"><option value="' + p[
                        j] + '">' + p[j] +
                    '</option><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
                chage = chage + p[j] + ','
            }
            chage = chage.slice(0, -1);
            childage = childage + p[0] + ',' + chage
            $(this).find(".countRoom").append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click defaultAdNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i + '.adultcount" maxlength="4000" value="' + sp[i - 1] +
                '"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom defaultChNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="' +
                p[0] + '"></div><div class="clr"></div><div class="childDropdowns">' + age +
                '</div><input type="hidden" name="_root.rooms__' + i +
                '.childcountandage" class="childcountandage" value="' + childage +
                '" /></div></div>')

        } else {
            $(this).find(".countRoom").append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click defaultAdNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i + '.adultcount" maxlength="4000" value="' + sp[i - 1] +
                '"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom defaultChNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="' +
                p[0] +
                '"></div><div class="clr"></div><div class="childDropdowns"></div><input type="hidden" name="_root.rooms__' +
                i + '.childcountandage" class="childcountandage" value="0" /></div></div>')
        }
    }

});

$(".button-click-room a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    if (oldVal < newVal) {
        var room = newVal;
        button.closest("form").find('.countRoom').empty()
        for (i = 1; i <= room; i++) {
            button.closest("form").find('.countRoom').append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click"><li><a class="button secondary" onclick="increaseAdult(this)"><span class="hide">+</span></a></li><li><a class="button secondary"  onclick="decreaseAdult(this)"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i +
                '.adultcount" maxlength="4000" value="1"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom"><li><a class="button secondary" onclick="increaseChild(this)"><span class="hide">+</span></a></li><li><a class="button secondary" onclick="decreaseChild(this)"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="0"></div><div class="clr"></div><div class="childDropdowns"></div><input type="hidden" name="_root.rooms__' +
                i + '.childcountandage" class="childcountandage" /></div></div>')
        }
    } else if (oldVal > newVal) {
        destroyRoomDropdown(button.closest("form").find('.countRoom'), newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
    button.closest("form").find(".count-room").text('تعداد اتاق: ' + newVal)
    button.closest("form").find(".count-adultRoom").text('بزرگسال : ' + newVal)
    button.closest("form").find(".count-childRoom").text('کودک : 0')
});
var destroyRoomDropdown = function ($el, i) {
    if (i < 1) return;
    $el.find('div.contentRooms').get(i).remove();
};

function increaseAdult(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal >= 10) return;
    button.closest("ul").next().val(newVal);
    SumAdult(a)
}

function decreaseAdult(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    SumAdult(a)
}

function SumAdult(a) {
    var ad = 0;
    var sum = 0;
    $(a).closest("form").find(".countRoomHT").find(".contentRooms").each(function () {
        var adultcount = parseInt($(this).find(".adultcount").val())
        ad += adultcount;
    })
    sum = parseInt(ad)
    $(a).closest("form").find(".count-adultRoom").text('بزرگسال : ' + sum)

}

function increaseChild(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    button.closest("ul").next().val(newVal);
    if (oldVal < newVal) {
        var childCount = newVal;
        button.closest(".contentRooms").find('.childDropdowns').empty()
        for (i = 1; i <= childCount; i++) {
            button.closest(".contentRooms").find('.childDropdowns').append(
                '<div class="age-selection"><label class="label">سن کودک ' + i +
                '</label><select class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
            );
        }

    }
    total_value = total_value.substring(0, total_value.length - 2);
    SumChild(a)
}

function decreaseChild(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    button.closest("ul").next().val(newVal);
    if (oldVal > newVal) {
        var childCount = newVal;
        destroyChildDropdownRoom(button.closest(".contentRooms").find('.childDropdowns'), newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
    SumChild(a)
}

function SumChild(a) {
    var ch = 0;
    var sum = 0;
    $(a).closest("form").find(".countRoomHT").find(".contentRooms").each(function () {
        var chcount = parseInt($(this).find(".chcount").val())
        ch += chcount;
    })
    sum = parseInt(ch)
    $(a).closest("form").find(".count-childRoom").text('کودک : ' + sum)

}
$(".button-click a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal >= 10) return;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    $(".cat_textbox").each(function () {
        var cat = $(this).next('span').text();
    });
    $(".count-adultRoom").text('بزرگسال : ' + newVal)
});
$(".button-click-childRoom a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    button.closest("ul").next().val(newVal);
    $(".count-childRoom").text('کودک : ' + newVal)
    if (oldVal < newVal) {
        var childCount = newVal;
        button.closest(".contentRooms").find('.childDropdowns').empty()
        for (i = 1; i <= childCount; i++) {
            button.closest(".contentRooms").find('.childDropdowns').append(
                '<div class="age-selection"><label class="label">سن کودک ' + i +
                '</label><select class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
            );
        }

    } else if (oldVal > newVal) {
        destroyChildDropdownRoom(button.closest(".contentRooms").find('.childDropdowns'),
            newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
});
var destroyChildDropdownRoom = function ($el, i) {
    $el.find('div.age-selection').get(i).remove();
};


function roomCount(a) {
    var room = $(a).val();
    $(a).closest("form").find(".infoRooms").empty()
    for (i = 1; i <= room; i++) {
        $(a).closest("form").find(".infoRooms").append(
            '<div class="contentRooms counRoom2"><div class="numberOfRooms">اتاق' + i +
            '</div><div class="passengerInfo"><div class="label"><span>بزرگسال</span><span class="age-range">بالای 12 سال</span></div><div class="textbox"><select  name="_root.rooms__' +
            i +
            '.adultcount" class="adultcountHotel"><option value="1">1 بزرگسال</option><option value="2">2 بزرگسال</option><option value="3">3 بزرگسال</option><option value="4">4 بزرگسال</option><option value="5">5 بزرگسال</option><option value="6">6 بزرگسال</option><option value="7">7 بزرگسال</option><option value="8">8 بزرگسال</option><option value="9">9 بزرگسال</option></select></div></div><div class="passengerInfo"><div class="label"><span>کودک</span><span class="age-range">1 تا 12 سال</span></div><div class="textbox"><select name="child" onchange="childCount2(this)" class="childCount">       <option value="0">بدون کودک</option><option value="1">1 کودک</option><option value="2">2 کودک</option><option value="3">3 کودک</option><option value="4">4 کودک</option><option value="5">5 کودک</option><option value="6">6 کودک</option></select></div></div><div class="selectAge"></div><input type="hidden"  name="_root.rooms__' +
            i + '.childcountandage" class="childcountandage"/></div>')
    }
}

function childCount2(a) {
    var age = $(a).val();
    $(a).closest(".contentRooms").find(".selectAge").empty()
    for (var j = 1; j <= age; j++) {
        $(a).closest(".contentRooms").find(".selectAge").append(
            '<div class="createChildDropdown"><label  class="label">سن کودک ' + j +
            '</label><select  class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
        );
    }
}
//<!-----------JS SUBMIT----------->
$(".search-flight").click(function () {
    s = $(this).closest("form").find(".childcountinput").val();
    if (s == "0,") {
        $(this).closest("form").find(".childcountinput").val(0)
    }
    $(this).closest("form").find(".contentRooms").each(function (index, element) {
        var childCount = $(this).find(".chcount").val();
        var childAge = "";
        $(this).find(".select-age").each(function (index, element) {
            childAge = childAge + ',' + $(this).val();
        });
        $(this).find(".childcountandage").val(childCount + childAge);
    });
});
$(document).on('click', function (event) {
    if (!$(event.target).closest('.searchList,.country,.outer-searchList').length) {
        $(".outer-searchList").slideUp();
        $(".searchList").slideUp();
    }
})

$('.hotel-input, .count-room, .count-adultRoom, .count-childRoom').click(function (e) {
    $(this).closest('.frm-other').find('.HotelPassengers').toggleClass("block");
    e.preventDefault();
    return false;
});

$('.CloseHotelPassengers').click(function (e) {
    $(this).closest('.frm-other').find('.HotelPassengers').removeClass("block");
    e.preventDefault();
    return false;
});
$(".frm").submit(function (event) {
    $(this).find("input[name=fdate],input[name=tdate]").each(function () {
        if ($(this).val() == '' && !$(this).is(':disabled')) {
            event.preventDefault();
            $(this).css('border', '1px solid red')
        }
    })
    if ($(this).find(".Hotel-Date").val() == 1) {
        $(this).find("input[name=checkin],input[name=checkout]").each(function () {
            if ($(this).val() == '') {
                event.preventDefault();
                $(this).css('border', '1px solid red')
            }
        })
    }
})
if ($(".Hotel-Date").val() == 1) {
     $(".Wrapper-ExteraHoteldate").show()
     $(".Hotel-Date").prop("checked",true)
}else{
    $(".Wrapper-ExteraHoteldate").hide() 
    $(".Hotel-Date").prop("checked",false)
}
//<!-----------JS DESTINATIO/DEPARTURE----------->
$(".customized-icon-searchbox-exchange").click(function () {
    let i = $(this).attr("data-index");
    if (i == 0) {
        $(this).attr("data-index", "1")
        var dep = $(this).closest(".frm").find(".FCD1").val()
        var des = $(this).closest(".frm").find(".FCD2").val()
        var depid = $(this).closest(".frm").find(".FCDid1").val()
        var desid = $(this).closest(".frm").find(".FCDid2").val()
        $(this).closest(".frm").find(".FCD1").val(des)
        $(this).closest(".frm").find(".FCD2").val(dep)
        $(this).closest(".frm").find(".FCDid1").val(desid)
        $(this).closest(".frm").find(".FCDid2").val(depid)
    } else {
        $(this).attr("data-index", "0")
        var dep = $(this).closest(".frm").find(".FCD1").val()
        var des = $(this).closest(".frm").find(".FCD2").val()
        var depid = $(this).closest(".frm").find(".FCDid1").val()
        var desid = $(this).closest(".frm").find(".FCDid2").val()
        $(this).closest(".frm").find(".FCD1").val(des)
        $(this).closest(".frm").find(".FCD2").val(dep)
        $(this).closest(".frm").find(".FCDid1").val(desid)
        $(this).closest(".frm").find(".FCDid2").val(depid)
    }
});

function empty(a) {
    $(a).val('')
    $(a).closest(".city").find(".co-id").val('')
    $(a).closest(".city").find(".outer-searchList").slideDown()
    $(a).closest(".city").find(".searchList").slideDown()
    $(a).closest(".city").siblings(".city").find(".outer-searchList").slideUp()
    $(a).closest(".city").siblings(".city").find(".searchList").slideUp()
}

function SelectPlace(element) {
    var idSelected = $(element).attr("data-id")
    var textSelected = $(element).find("span").text()
    $(element).closest(".city").find(".country").val(textSelected)
    $(element).closest(".city").find(".co-id").val(idSelected)
    $(element).closest(".city").find(".outer-searchList").slideUp()
    $(element).closest(".city").find(".searchList").slideUp()
}
$('.country').each(function () {
    $(this).on('keyup', function (e) {
        $(this).closest(".city").find(".outer-searchList").slideUp()
        $(this).closest(".city").find(".searchList").slideUp()
    });
    $(this).on('blur', function () {
        if ($(this).closest(".city").find(".countryFlight").text().length > 0) {
            if (hoverelse == 0) {
                var defresult = $(this).closest(".city").find(".countryFlight")
                    .children(".selectCountry:first").find(".txtcountry")
                    .text();
                var spl = defresult.split(" ");
                var defresultid = $(this).closest(".city").find(
                    ".countryFlight").children(".selectCountry:first").find(
                    ".countryid").val();
                $(this).closest(".city").find(".country").val(defresult);
                $(this).closest(".city").find(".co-id").val(defresultid);
                $(this).closest(".city").find(".countryFlight").empty();
            }



        } else {

            $(this).closest(".city").find(".mini-loading").css("display",
                "none")
            $(this).closest(".city").find(".country").val('');
            $(this).closest(".city").find(".co-id").val('');
        }
    });

});

function city_search(a) {
    if (a.which !== 0 && !a.ctrlKey && !a.metaKey && !a.altKey) {
        upper_case = $(a).val().substr(0, 1).toUpperCase() + $(a).val().substr(1).toLowerCase();
        $(a).val(upper_case)

        if ($(a).val().length > 2) {
            $(a).closest(".city").find(".mini-loading").show();

            $.ajax({
                url: '/Client_City_Search.bc',
                type: 'get',
                data: {
                    term: $(a).val(),
                    type: $(a).attr('data-type')
                },
                success: function (result) {
                    $(a).closest(".city").find(".mini-loading").hide();
                    $(a).closest(".city").find(".countryFlight").empty().html(result)
                }
            });
        } else
            $(a).closest(".city").find(".countryFlight").empty()
    }
}
$(".Classname-box").each(function () {
    var m = $(this).find("select .selected").val()
    $(this).find("select .not-selected").each(function () {
        var n = $(this).val();
        if (n == m) {
            $(this).remove()
        }
    });
});
function CheckExteraHoteldate(elme) {
    var isChecked = $(elme).prop("checked")
    if (isChecked == true) {
        $(elme).val(1)
        $(".Wrapper-ExteraHoteldate").show()
        $(".checkout").attr('required', true)
        $(".checkin").attr('required', true)
    } else if (isChecked == false) {
        $(elme).val(0)
        $(".Wrapper-ExteraHoteldate").hide()
        $(".checkout").attr('required', false)
        $(".checkin").attr('required', false)
        $(".checkout").val('')
        $(".checkin").val('')
        }
}
</script>