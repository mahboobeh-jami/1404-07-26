<basis core="tracking" name="tracking" source="Monitoring" collectionname="activity" dbname="tracking" addcookie="true" />
<basis core="cookie" name="trackingid" value="[##tracking.inserted.id|(0)##]" />
<basis core="dbsource" source="trust_login8" mid="24" name="db" lid="1" rkey="[##cms.cookie.rkey##]">
    <member name="userid" type="scalar" request="userid" preview="" />
</basis>
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>تور tripcenter</title>
    <meta name="author" content="BasisCore">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!---------------------------------CSS MAIN--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/tripcenter_main_style.css" />
    <link rel="stylesheet" type="text/css" href="/css/tripcenter-reservation.css" />
    <!---------------------------------CSS CALENDARE--------------------------------->
    <link rel="stylesheet" type="text/css" href="/css/Basis_Calendar.css" />
    <!---------------------------------JS LIBRARY--------------------------------->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
</head>

<body class="rightLogoOnFix" onload="onloadFunc();">
    <div class="loginRegister"></div>
    <div id="bg-popup-timeout" style="display:none"></div>
    <div class="boxalert" style="display:none">
        <div class="imgdiv"><img src="/images/time-out.png" alt="time-out" width="" height="" /></div>
        <div class="firstdiv"><span class="firstalert">مدت زمان اعتبار جستجوی شما به پایان رسید</span></div>
        <div class="seconddiv"> <span class="secondalert">لطفا جستجوی خود را از ابتدا انجام دهید.</span></div>
        <div class="optionsnodata">
            <input class="researchnodata" value="جستجوی مجدد" onclick="location.reload()" type="button" />
            <input class="homepage" value="صفحه اصلی" onclick="window.location='/'" type="button">
        </div>
    </div>
    <div class="bgLoading">
        <div class="bg-searching tour">
            <div class="text-searching">
                <div class="loading-progress"></div><span>در حال جستجوی بهترین تور , لطفا کمی صبر کنید...</span>
            </div>
        </div>
    </div>
  <div class="boxContainer pages">
        <basis core="call" file="header.inc" />
        <div id="container">
            <div id="tabs-filter-resize">
                <div id="tabs-filter">
                    <div class="wrapper_box">
                        <div class="wraper_top_info">
                            <div class="research">
                                <div class="research_box">
                                    <div id="r-tour" class="content-HotelTour" style="display:block">
                                        <form action="/tour_search.bc" method="post" class="frm changedate">
                                            <input type="hidden" value="[##cms.form.persiancurrent##]"
                                                class="persiancurrent" name="persiancurrent" />
                                                <input type="hidden" value='[##cms.json.header | cms.form.roomSearch##]' class="json"  />
                                                <div class="Wrapper-DesDep">
                                                    <div class="city">
                                                        <input type="text" value="[##cms.form.tour-search-text##]" name="tour-search-text"
                                                            onclick="city_search(this)" data-type='4' data-active="0" class="tour-search-text"
                                                            autocomplete="off"  required
                                                            placeholder="تور" />
                                                        <span class="mini-loading"><img src="/images/load.gif" width="20"
                                                                height="20" alt="loading" /></span>
                                                        <input value="[##cms.form.tourname##]" class="co-id" type="hidden"
                                                            name="tourname" />
                                                        <div class="countryFlight tour-search-content"></div>
                                                        <div class="clr"></div>
                                                    
                                                    </div>
                                                </div>
                                      
                                            <div class="Basis_Date_Box">
                                                <div class="frm-other date">
                                                    <div class="custom-select">
                                                        <input class="first cal Basis_Date start_date departuredate"
                                                            onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                            data-active="0" data-cache="0" id="inp1" name="fdate"
                                                            type="text" placeholder="ورود" value="[##cms.form.fdate##]"
                                                            required readonly="true" autocomplete="off">
                                                        <input value="[##cms.form.mstring_fdate##]"
                                                            class="mstring_date departureMdate" type="hidden"
                                                            name="mstring_fdate" />
                                                    </div>
                                                </div>
                                                <div class="frm-other date">
                                                    <div class="custom-select">
                                                        <input
                                                            class="second cal Basis_Date end_date nextCalOpening returndate"
                                                            onclick="Basis_Calendar(this,'[##cms.cms.date##]', 1)"
                                                            data-active="0" data-cache="0" id="inp2" name="tdate"
                                                            type="text" placeholder="خروج" value="[##cms.form.tdate##]"
                                                            required readonly="true" autocomplete="off">
                                                        <input value="[##cms.form.mstring_tdate##]"
                                                            class="mstring_date returnMdate" type="hidden"
                                                            name="mstring_tdate" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="frm-other passinfo-field">
                                                <div class="custom-select">
                                                    <input type="text" placeholder="" readonly
                                                        class="hotel-input">
                                                    <div class="Wrapper-CountPassenger">
                                                        <span class="count-room"></span>
                                                        <span class="count-adultRoom"></span>
                                                        <span class="count-childRoom"></span>
                                                        <div class="clr"></div>
                                                    </div>
                                                    <div class="HotelPassengers">
                                                        <div class="itemlable2">
                                                            <label> <span class="notshow">تعداد اتاق</span> </label>
                                                            <ul class="button-click-room">
                                                                <li><a class="button secondary"><span
                                                                            class="hide">+</span></a>
                                                                </li>
                                                                <li><a class="button secondary"><span
                                                                            class="hide">-</span></a>
                                                                </li>
                                                                <div class="clr"></div>
                                                            </ul>
                                                            <input type="text" class="cat_textbox roomcount"
                                                                maxlength="4000" value="">
                                                        </div>
                                                        <div class="clr"></div>
                                                        <div class="countRoom countRoomHT">
                                                            <div class="contentRooms">
                                                                <div class="itemlable2">
                                                                    <label> <span class="notshow">بزرگسال</span>
                                                                    </label>
                                                                    <ul class="button-click">
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">+</span></a>
                                                                        </li>
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">-</span></a>
                                                                        </li>
                                                                    </ul>
                                                                    <input type="text" class="cat_textbox adultcount"
                                                                        name="_root.rooms__1.adultcount"
                                                                        maxlength="4000" value="1">
                                                                    <div class="clr"></div>
                                                                </div>
                                                                <div class="itemlable2">
                                                                    <label> <span class="notshow">کودک</span> </label>
                                                                    <ul class="button-click-childRoom">
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">+</span></a>
                                                                        </li>
                                                                        <li><a class="button secondary"><span
                                                                                    class="hide">-</span></a>
                                                                        </li>
                                                                        <div class="clr"></div>
                                                                    </ul>
                                                                    <input type="text" class="cat_textbox chcount"
                                                                        maxlength="4000" value="0">
                                                                </div>
                                                                <div class="clr"></div>
                                                                <div class="childDropdowns"></div>
                                                                <input type="hidden"
                                                                    name="_root.rooms__1.childcountandage"
                                                                    class="childcountandage" value="0" />
                                                            </div>
                                                        </div>
                                                        <div class="CloseHotelPassengers">تایید</div>
                                                    </div>
                                                    <div class="clr"></div>
                                                </div>
                                            </div>
                                            <section class="frm-submit-btn">
                                                <div class="searchagain"><button type="submit"
                                                        class="search-flight hvr-shutter-in-horizontal">جستجو</button>
                                                </div>
                                            </section>
                                            <div class="clr"></div>
                                        </form>
                                    </div>
                                    </basis>
                                </div>

                            </div>
                            <div class="clr"></div>
                        </div>
                        <div class="changeDate_box">
                            <div class="prevdate"><span class="inner-next">روز قبل<i class="fa fa-angle-right"
                                        aria-hidden="true"></i></span></div>
                            <div class="nextdate"><span class="inner-next">روز بعد<i class="fa fa-angle-left"
                                        aria-hidden="true"></i></span></div>
                        </div>
                        <div class="inner-box-ticket" id="Result"></div>
                    </div>
                </div>
                <div class="clr"></div>
            </div>
            <div class="clr"></div>
        </div>
        <basis core="call" file="footer.inc" />
    </div>
    <basis core="call" file="Client_Basis_Calendar.inc" />
    <script type="text/javascript">
        $(document).ready(function () {
            fetch('/Client_Tour_Json.bc', {
            method: 'POST',
            body: 'tourname=[##cms.form.tourname##]&fdate=[##cms.form.fdate##]&tdate=[##cms.form.tdate##]&userid=[##db.userid.userid##]&rooms=[##cms.json.header|cms.form.roomSearch##]'
            }).then(response => response.text())
            .then(text => {
                let Maindata = JSON.parse(text.replace(/\'/g, '"'))
                let LenMaindata = Maindata.length
                if (LenMaindata == undefined) {
                    $(".sort_box").hide()
                }
                if (LenMaindata !== undefined) {
                    Maindata.sort((a, b) => a.totalCom- b.totalCom);
                }
                $('.bgLoading').hide()
                $('.boxContainer').show()
                load_data(Maindata)

            }).catch(error => console.error(error))
        })
    </script>
    <!---------------------------------JS PROGRESS--------------------------------->
    <script type="text/javascript" src="/js/Progress-Bar.js"></script>
    <!---------------------------------JS RESEARCH--------------------------------->
    <script type="text/javascript" src="/js/ChangeDate-Scripts.js"></script>
  <script type="text/javascript">
    <basis core = "call" file = "Client_Basis_Calendar_js.inc"/>
  </script>
    <!---------------------------------JS MENU--------------------------------->
    <script type='text/javascript' src="/js/jquery.navgoco.js"></script>
    <script type='text/javascript' src="/js/off-canvas.js"></script>
    <!---------------------------------LIBRARY REACT--------------------------------->
    <script src="/js/react.production.min.js" crossorigin></script>
    <script src="/js/react-dom.production.min.js" crossorigin></script>
    <script src="/js/babel.min.js" crossorigin></script>
    <script src="/js/react-library.js"></script>
    <script type="text/babel">
        function load_data(load_data){
class App extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            data: [],
            library: null,
            perPage: 20,
            currentPage: 1,
            currentPage2: 2,
            currentPage3: 3,
            maxPage: null,
            visibleAllDetails: {},
            visibleDetails: {},
            visibleRule: {},
            visibleBar: {},
            visibleCostTable: {},
            visibleTourInfo: {},
            roomids: {},
            ischecked: true,
            filterName: "",
            jsonbackup: {},
            cityindex: "",
            roomindex: "",
            roomcheck: "",
            chflag: 0,
            copy: {},
            Visible_rooms: {},
            activeTab_details: {},
            activeTab_bar: {},
            activeTab_rule: {},
            activeTab_price: {},
        }
        this.airlines = [];
        this.stops = [];
        this.stars = [];
        this.service = [];
        this.availability = [];
        this.classNames = []
        this.handleClick = this.handleClick.bind(this);
    }
    componentDidMount() {
        this.setState(state => ({
                    ...state,
                    data: load_data
                }), () => {
                    this.reorganiseLibrary()
         })

        $(document).on('update_result', (event, service, stars, availability, airlines, classNames, stops) => {
            this.reorganiseLibrary(service, stars, availability, airlines, classNames, stops)
        })
    }
    componentDidUpdate() {
        $(".ticket-box").each(function () {
            let basiscoreid = $(this).find(".basiscoreid").val()
            var check_loaded = $(this).attr("date-load-info");
            var self = $(this)
            if ($(this).find(".basiscoreid").val()) {
                if ($(this).find(".basiscoreid").val() == $(this).closest(".ticket-box").siblings().find(".basiscoreid").val()) {
                    if (check_loaded == 0) {
                        $.get("/tour_Info.bc?id=" + basiscoreid + "", function (data, status) {
                            self.find(".load_info_tour").empty().append(data)
                            self.closest(".ticket-box").siblings().find(".load_info_tour").empty().append(data)

                        });
                        $(this).attr("date-load-info", "1")
                        $(this).siblings().attr("date-load-info", "1")
                    }
                } else {
                    $.get("/tour_Info.bc?id=" + basiscoreid + "", function (data, status) {
                        self.find(".load_info_tour").empty().append(data)
                    });

                }
            }
        })
    }
    reorganiseLibrary = (service, stars, availability, airlines, classNames, stops) => {
        const { filterName, perPage, data } = this.state
        let library = data
        if (filterName !== "") {
            library = library.filter(item =>
                this.render_filter_search(item).toString().toLowerCase().includes(filterName)
            )
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }
        if (stars !== undefined) {
            if (stars !== "") {
                stars = stars.split(",");
                library = library.filter(item => {
                    if (this.renderFilter_search(item.hotelinfo, 'star').some(r => stars.includes(r))) return item;

                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }
        if (service !== undefined) {
            if (service !== "") {
                service = service.split(",");
                library = library.filter(item => {
                    if (this.renderFilter_search(item.hotelinfo, 'sevice').some(r => service.includes(r))) return item;

                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }

        if (availability !== undefined) {
            if (availability !== "") {
                availability = availability.split(",");
                library = library.filter(item => {
                    if (this.renderFilter_search(item.hotelinfo, 'availability').some(r => availability.includes(r))) return item;

                })
            }

            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)

        }
        if (airlines !== undefined) {
            if (airlines !== "") {
                airlines = airlines.split(",");

                library = library.filter(item => {
                    if (this.renderFilter_search(item, 'airlines').some(r => airlines.includes(r))) return item;


                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }

        if (stops !== undefined) {
            if (stops !== "") {
                stops = stops.split(",");
                library = library.filter(item => {
                    if (this.renderFilter_search(item, 'stops').some(r => stops.includes(r))) return item;

                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }
        if (classNames !== undefined) {
            if (classNames !== "") {
                classNames = classNames.split(",");
                library = library.filter(item => {
                    if (this.renderFilter_search(item, 'classNames').some(r => classNames.includes(r))) return item;
                })
            }
            let lenLibrary = library.length
            $('.numbersearch').text(lenLibrary)
        }
        let lenLibrary = library.length
        if (lenLibrary == undefined) {
            $('.dataLen').text(0)
        } else {
            $('.dataLen').text(lenLibrary)
        }
        library = _.chunk(library, perPage)
        this.setState({
            library,
            currentPage: 1,
            maxPage: library.length === 0 ? 1 : library.length
        })
    }
    render_filter_search = (element) => {
        let lenhotelinfo = element.hotelinfo.length
        for (let i = 0; i < lenhotelinfo; i++) {
            for (let i = 0; i < lenhotelinfo; i++) {
                let lenhotel = element.hotelinfo[i].hotel.length
                let indents = []
                for (let j = 0; j < lenhotel; j++) {
                    indents.push(element.hotelinfo[i].hotel[j].hotelinfo.name)
                }
                return (
                    indents
                )
            }
        }
    }

    renderFilter_search(element, type) {
        if (type == 'star') {
            let elementAdd = []
            for (let i = 0; i < element.length; i++) {
                for (let j = 0; j < element[i].hotel.length; j++) {
                    elementAdd.push(element[i].hotel[j].hotelinfo.hotelsearch.star.toString())
                }

            }
            return elementAdd
        } if (type == 'sevice') {
            let elementAdd = []
            for (let i = 0; i < element.length; i++) {
                for (let j = 0; j < element[i].hotel.length; j++) {
                    elementAdd.push(element[i].hotel[j].hotelinfo.hotelsearch.services)
                }

            }
            return elementAdd
        } if (type == 'availability') {
            let elementAdd = []
            for (let i = 0; i < element.length; i++) {
                for (let j = 0; j < element[i].hotel.length; j++) {
                    for (let y = 0; y < element[i].hotel[j].families.length; y++) {
                        for (let z = 0; z < element[i].hotel[j].families[y].availablerooms.length; z++) {
                            elementAdd.push(element[i].hotel[j].families[y].availablerooms[z].info.availability)
                        }
                    }

                }

            }
            return elementAdd
        }
        if (type == 'classNames') {
            let elementAdd = []
            for (let i = 0; i < element.backtobackinfo.mainflights.length; i++) {
                elementAdd.push(element.backtobackinfo.mainflights[i].classname)
            }
            for (let i = 0; i < element.onewayflights.length; i++) {
                elementAdd.push(element.onewayflights[i].classname)
            }
            return elementAdd
        }
        if (type == 'stops') {
            let elementAdd = []
            for (let i = 0; i < element.backtobackinfo.mainflights.length; i++) {
                elementAdd.push(element.backtobackinfo.mainflights[i].ticketinfooo.stoppinfoo.showstopinfo)
            }
            for (let i = 0; i < element.onewayflights.length; i++) {
                elementAdd.push(element.onewayflights[i].ticketinfooo.stoppinfoo.showstopinfo)
            }
            return elementAdd
        }

        if (type == 'airlines') {
            let elementAdd = []
            for (let i = 0; i < element.backtobackinfo.mainflights.length; i++) {

                for (let j = 0; j < element.backtobackinfo.mainflights[i].routeshow.routesinfoo.length; j++) {
                    elementAdd.push(element.backtobackinfo.mainflights[i].routeshow.routesinfoo[j].routesinfoodetails.otherdetails.detailsairline)
                }

            }
            for (let i = 0; i < element.onewayflights.length; i++) {
                for (let j = 0; j < element.onewayflights[i].routeshow.routesinfoo.length; j++) {
                    elementAdd.push(element.onewayflights[i].routeshow.routesinfoo[j].routesinfoodetails.otherdetails.detailsairline)
                }

            }
            return elementAdd

        }
    }
    // Previous Page
    previousPage = event => {
        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let Multi = len * maxPage
        for (let i = 0; i <= Multi; i++) {
            this.setState(prevState => ({
                visibleDetails: { ...prevState.visibleDetails, [i]: "" },
                visibleRule: { ...prevState.visibleRule, [i]: "" },
                visibleBar: { ...prevState.visibleBar, [i]: "" },
                visibleTourInfo: { ...prevState.visibleTourInfo, [i]: "" },
                Visible_rooms: { ...prevState.Visible_rooms, [i]: "" },
                visibleAllDetails: { ...prevState.visibleAllDetails, [i]: "" },
                visibleCostTable: { ...prevState.visibleCostTable, [i]: "" },
         
            }))
        }
        this.handleClick(event)
        this.setState({
            currentPage: this.state.currentPage - 1,
            currentPage2: this.state.currentPage2 - 1,
            currentPage3: this.state.currentPage3 - 1
        })
    }
    // Next Page 
    nextPage = event => {
        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let Multi = len * maxPage
        for (let i = 0; i <= Multi; i++) {
            this.setState(prevState => ({
                visibleDetails: { ...prevState.visibleDetails, [i]: "" },
                visibleRule: { ...prevState.visibleRule, [i]: "" },
                visibleBar: { ...prevState.visibleBar, [i]: "" },
                visibleTourInfo: { ...prevState.visibleTourInfo, [i]: "" },
                Visible_rooms: { ...prevState.Visible_rooms, [i]: "" },
                visibleAllDetails: { ...prevState.visibleAllDetails, [i]: "" },
                visibleCostTable: { ...prevState.visibleCostTable, [i]: "" },
         
            }))
        }
        this.handleClick(event)
        this.setState({
            currentPage: this.state.currentPage + 1,
            currentPage2: this.state.currentPage2 + 1,
            currentPage3: this.state.currentPage3 + 1
        })
    }

    // Next Page3
    nextPage3 = event => {
        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let Multi = len * maxPage
        for (let i = 0; i <= Multi; i++) {
            this.setState(prevState => ({
                visibleDetails: { ...prevState.visibleDetails, [i]: "" },
                visibleRule: { ...prevState.visibleRule, [i]: "" },
                visibleBar: { ...prevState.visibleBar, [i]: "" },
                visibleTourInfo: { ...prevState.visibleTourInfo, [i]: "" },
                Visible_rooms: { ...prevState.Visible_rooms, [i]: "" },
                visibleAllDetails: { ...prevState.visibleAllDetails, [i]: "" },
                visibleCostTable: { ...prevState.visibleCostTable, [i]: "" },
         
            }))
        }
        this.handleClick(event)
        this.setState({
            currentPage: this.state.currentPage3,
            currentPage2: this.state.currentPage3 + 1,
            currentPage3: this.state.currentPage3 + 2
        })
    }

    // handle filter
    handlerFilterName = evt =>
        this.setState(
            {
                filterName: evt.target.value.toLowerCase()
            },
            () => {
                this.reorganiseLibrary();
            }
        )

    // handle per page
    handlePerPage = (evt) =>
        this.setState({
            perPage: evt.target.value
        }, () => this.reorganiseLibrary())

    // handle render of library
    renderLibrary = () => {
        const { library, currentPage } = this.state

        if (!library || (library && library.length === 0)) {
            return <div className="nodata">
                <div className="imgnodata"><img src="/images/no-result.png" alt="no-result" width="" height="" /></div>
                <div className="tltnodata">برای جستجوی شما نتیجه ای یافت نشد!</div>
                <div className="textnodata">شما می توانید با انجام مجدد عملیات جستجو,نتیجه مورد نظر خود را بیابید</div>
                <div className="optionsnodata"><button className="researchnodata" onClick={this.renderResearch} type="submit">جستجوی مجدد </button><input className="homepage" value="صفحه اصلی" onClick={this.renderhomepage} type="button" /></div>
            </div>
        }
        return library[currentPage - 1].map((item, i) => (
            <div className="ticket-box">
                <form action="" method="post">
                    <input type="hidden" value="[##cms.form.tourname##]" name="tourname" />
                    <input type="hidden" value="[##cms.form.tour-search-text##]" name="tour-search-text" />
                    <input type="hidden" value='[##cms.json.header|cms.form.roomSearch##]' name="roomSearch" />
                    <input type="hidden" value={item.id} name="id" />
                    <input type="hidden" value={item.supplier} name="supplier" />
                    <input type="hidden" value={item.share} name="share" />
                    <input type="hidden" value={item.dateinfo.begindate.sstring} name="fdate" />
                    <input type="hidden" value={item.dateinfo.enddate.sstring} name="tdate" />
                    {this.renderproviderId(item.id)}
                    {this.renderprovider(item)}
                    {this.renderNeardate(item, item.index)}
                    {this.renderTourname(item.name)}
                    {this.renderFdate(item.dateinfo.begindate.sstring)}
                    {this.rendertdate(item.dateinfo.enddate.sstring)}
                    {this.renderhotelgroupid(item)}

                    <div className="right-Hresrve">
                        <div className="headerTour">
                            <span>تور : {item.name} / </span>
                            <span>{item.dateinfo.begindate.sstring}</span>
                            <span>({item.dateinfo.begindate.mstring})</span>
                            <span>الی </span>
                            <span>{item.dateinfo.enddate.sstring}</span>
                            <span>({item.dateinfo.enddate.mstring})</span>
                            {this.renderTime(item)}
                        </div>
                        {this.renderbacktobackinfo(item.backtobackinfo, item.index)}
                        {this.renderonewayflights(item, item.index)}
                        {this.renderhotelinfo_wrapper(item)}
                        {this.renderserviceTour(item)}
                        {this.renderInsurance(item)}
                        {this.rendervisa(item)}
                        <div className="clr"></div>

                        <div className="box-price">
                            <div key={item.index} className={`costbl ${!this.state.visibleCostTable[item.index] ? "unvisible" : "visible"}`}>
                                <div className="close" onClick={() => this.closecosttable(item.index)}><span className="fa-times"></span></div>
                                {this.rendercosttable(item)}
                            </div>
                            <div className="table-cost" onClick={() => this.showcosttable(item.index)}><span>جدول قیمت</span></div>

                        </div>
                    </div>
                    <div className="outer-left">
                        <div className="left-side2 hotel-left-side2">
                            <div className="cost-ticket costTotal"><span>مبلغ کل : </span><span className="cost1"> {this.renderTotal(item)}</span> <span className="moneytype">{item.unit}</span></div>
                            {this.renderCommission(item)}
                            {this.renderTotalcom(item)}
                            <div className="reserve btnhotel">
                                <div className="inner-search">
                                    <input className="linkreserve not-active-form" value="رزرو" type="button" />
                                </div>
                                {this.renderserviceTour_link(item)}
                            </div>
                        </div>
                    </div>



                </form>
            </div>
        ))
    }
    render() {
        const { library, currentPage, perPage, maxPage } = this.state
        return (
            <div>
                <div id="main-box-fliter">
                    <div className="inner-box-filter">
                        <div className="countHotel">تعداد <span className="numbersearch"><span className="dataLen">{this.renderCount()}</span> </span> تور یافت شد .</div>
                        <div className="counterbox">
                            <div className="ttcounter">مدت زمان باقی مانده فرآیند رزرو</div><span id="count"></span>
                        </div>
                        <div className="slide_ExteraFilter">
                            <div className="mainTlt-filter"><span>فیلتر نتایج تور براساس : </span></div>
                            <div className="filter-box">
                                <div className="title-filter"><span>نام هتل</span> </div>
                                <div className="items-filter">
                                    <div className="every-item">
                                        <div className="rightCheck" data-index="0">
                                            <input value={this.state.filterName} onChange={this.handlerFilterName} placeholder="نام هتل را وارد کنید." className="hotelName" />
                                        </div>
                                        <div className="clr"></div>
                                    </div>
                                </div>
                            </div>

                            {this.ShowFilterTour()}
                        </div>
                    </div>
                </div>
                <div className="main-box-ticket">
                    <div className="ndate-box"><span>تور در تاریخ مورد نظر شما موجود نیست ! نزدیک ترین تاریخ موجود نمایش داده شده است .</span></div>
                    <div className="info-loading">
                        <div className="inner-box-ticket">
                            {this.renderLibrary()}
                            <ul id="page-numbers">
                                <li className="nexprev">{currentPage !== 1 && (<button onClick={this.previousPage}><span className="fa-backward"></span></button>)}</li>
                                <li className="controls activeCnt">{this.state.currentPage}</li>
                                {(this.state.currentPage2 < maxPage) && (<li className="controls" onClick={this.nextPage}>{this.state.currentPage2}</li>)}
                                {(this.state.currentPage3 < maxPage) && (<li className="controls" onClick={this.nextPage3}>{this.state.currentPage3}</li>)}
                                <li className="restControls">...</li>
                                <li className="controls">{this.state.maxPage}</li>
                                <li className="nexprev">{(this.state.currentPage < maxPage) && (<button onClick={this.nextPage}><span className="fa-forward"></span></button>)}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        )
    }
    ShowFilterTour() {
        let element = this.state.data;
        if (!element) return null;
        return <div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>درجه مکان اقامتی</span> </div>
                <div className="items-filter grade_results">
                    {this.renderstars(element)}
                    <div className="clr"></div>
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>سرویس</span> </div>
                <div className="items-filter">
                    {this.renderservice(element)}
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>وضعیت</span> </div>
                <div className="items-filter">
                    {this.renderAllavailability(element)}
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>خطوط هوایی</span> </div>
                <div className="items-filter airline_results">
                    {this.renderairlines(element)}
                    <div className="clr"></div>
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>توقف</span> </div>
                <div className="items-filter">
                    {this.renderstop(element)}
                </div>
            </div>
            <div className="filter-box">
                <div className="title-filter"><span><i className="fas "></i>کلاس پروازی</span> </div>
                <div className="items-filter">
                    {this.renderclassname(element)}
                </div>
            </div>
        </div>
    }
    renderairlines(element) {
        let indents = [];
        if (element.length !== undefined) {
            let sentencesBack = [...(new Set(element
                .map((d) => {
                    if (d['backtobackinfo']) {
                        return d['backtobackinfo']['mainflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['routeshow']['routesinfoo']
                    }
                }
                ).flat().map((info) => {
                    if (info) {
                        return info['routesinfoodetails']['otherdetails']['detailsairline']
                    }
                }
                )))]
            let sentencesOne = [...(new Set(element
                .map((d) => {
                    if (d['onewayflights']) {
                        return d['onewayflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['routeshow']['routesinfoo']
                    }
                }
                ).flat().map((info) => {
                    if (info) {
                        return info['routesinfoodetails']['otherdetails']['detailsairline']
                    }
                }
                )))]
            let sentences = sentencesBack.concat(sentencesOne.filter((item) => sentencesBack.indexOf(item) < 0))
            let imgDep = [...(new Set(element
                .map((d) => {
                    if (d['backtobackinfo']) {
                        return d['backtobackinfo']['mainflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['routeshow']['routesinfoo']
                    }
                }
                ).flat().map((info) => {
                    if (info) {
                        return info['routesinfoodetails']['otherdetails']['detailsairlineimage']
                    }
                }
                )))]
            let imgDes = [...(new Set(element
                .map((d) => {
                    if (d['onewayflights']) {
                        return d['onewayflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['routeshow']['routesinfoo']
                    }
                }
                ).flat().map((info) => {
                    if (info) {
                        return info['routesinfoodetails']['otherdetails']['detailsairlineimage']
                    }
                }
                )))]
            let sentencesimg = imgDep.concat(imgDes.filter((item) => imgDep.indexOf(item) < 0))
            for (let i = 0; i < sentences.length; i++) {
                if (sentences[i] !== undefined) {
                    let singleSentence = <div className="item2 airline_filter"><div className="right rightCheck" data-index="1"><input type="checkbox" value={sentences[i]} className="startairline" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label className="lable_content" for="filter"><img src={sentencesimg[i]} alt={sentences[i]} width="50" height="20" className="img_airline" /><span className="checkbox"><span className="name_airline">{sentences[i]}</span></span><span className="total_content">از <span className="minTotal">{new Intl.NumberFormat().format(this.min_totalByAirline(element, sentences[i]))}</span><span className="unit_content">{[...(new Set(element.map(x => x.unit)))]}</span></span></label></div><div className="clr"></div></div>
                    let output = singleSentence
                    indents.push(singleSentence)
                }



            }

            return (
                indents
            )

        }
    }
    renderairlineimg(element) {
        let sentencesBackimg = [...(new Set(element
            .map((d) => {
                if (d['backtobackinfo']) {
                    return d['backtobackinfo']['mainflights']
                }
            }).flat().map(elem => elem['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
        let sentencesOneimg = [...(new Set(element
            .map((d) => {
                if (d['onewayflights']) {
                    return d['onewayflights']
                }
            }).flat().map(elem => elem['routeshow']['routesinfoo']).flat().map(info => info['routesinfoodetails']['otherdetails']['detailsairlineimage'])))]
        let sentencesimg = sentencesBackimg.concat(sentencesOneimg.filter((item) => sentencesBackimg.indexOf(item) < 0))
        let singleSentenceimg = sentencesimg.map(s => <img src={s} alt="" width="100" height="40" />);
        let output = singleSentenceimg
        return (
            output
        )

    }
    min_totalByAirline = (data, name) => {
        const totalsBack = data.filter((x) => {
            if (x.backtobackinfo) {
                return x.backtobackinfo.mainflights
                    .flatMap(z => z.routeshow.routesinfoo)
                    .find(y => y.routesinfoodetails.otherdetails.detailsairline === name)
            }
        })
            .map(x => x.totalcostmin);
        const totalsOne = data.filter((x) => {
            if (x.onewayflights) {
                return x.onewayflights.flatMap(z => z.routeshow.routesinfoo).find(y => y.routesinfoodetails.otherdetails.detailsairline === name)
            }
        })
            .map(x => x.totalcostmin);
        return Math.min(...totalsBack, ...totalsOne);
    }
    renderclassname(element) {
        if (element.length !== undefined) {
            let sentencesBack = [...(new Set(element
                .map((d) => {
                    if (d['backtobackinfo']) {
                        return d['backtobackinfo']['mainflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['classname']
                    }
                }
                ).flat()))]
            let sentencesOne = [...(new Set(element
                .map((d) => {
                    if (d['onewayflights']) {
                        return d['onewayflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['classname']
                    }
                }
                ).flat()))]
            let sentences = sentencesBack.concat(sentencesOne.filter((item) => sentencesBack.indexOf(item) < 0))
            if (sentences != '') {
                let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="classNames" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
                let output = singleSentence
                return (
                    output
                )
            }

        }
    }
    renderstop(element) {
        if (element.length !== undefined) {
            let sentencesBack = [...(new Set(element
                .map((d) => {
                    if (d['backtobackinfo']) {
                        return d['backtobackinfo']['mainflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['ticketinfooo']['stoppinfoo']['showstopinfo']
                    }
                }
                ).flat()))]
            let sentencesOne = [...(new Set(element
                .map((d) => {
                    if (d['onewayflights']) {
                        return d['onewayflights']
                    }
                }).flat().map((elem) => {
                    if (elem) {
                        return elem['ticketinfooo']['stoppinfoo']['showstopinfo']
                    }
                }
                ).flat()))]
            let sentences = sentencesBack.concat(sentencesOne.filter((item) => sentencesBack.indexOf(item) < 0))
            if (sentences != '') {
                let singleSentence = sentences.map(s => <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="stops" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>);
                let output = singleSentence
                return (
                    output
                )
            }

        }
    }
    renderstars(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['hotelinfo']).flat().map(a => a['hotel']).flat()
                .map((elem) => {
                    if (elem['hotelinfo']) {
                        return elem['hotelinfo']['hotelsearch']['star']
                    }

                }).flat()))]
            let singleSentence = sentences.map((s) => {
                if (s !== undefined) {
                    return <React.Fragment><div className="item2 grade_filter"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="stars" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"><span className="checkbox"><span><img src={(`/images/${s}-rating.png`)} width="80" height="14" alt="rating" /></span></span><span className="total_content">از <span className="min_total">{new Intl.NumberFormat().format(this.min_totalByGrade(element, s))}</span><span className="unit_value"> {[...(new Set(element.map(x => x.unit)))]} </span></span></label></div><div className="clr"></div></div></React.Fragment>
                }
            });
            let output = singleSentence
            return (
                output
            )
        }
    }


    min_totalByGrade = (data, name) => {
        const totals = data.filter(x =>
            x.hotelinfo.flatMap(z => z.hotel).find(
                (y) => {
                    if (y.hotelinfo) {
                        return y.hotelinfo.hotelsearch.star === name
                    }
                })).map(x => x.totalcostmin);
        return Math.min(...totals);
    }
    renderservice(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['hotelinfo']).flat().map(a => a['hotel']).flat()
                .map((elem) => {
                    if (elem['hotelinfo']) {
                        return elem['hotelinfo']['hotelsearch']['services']
                    }

                }).flat()))]

            let singleSentence = sentences.map((s) => {
                if (s !== undefined) {
                    return <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="service" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>
                }

            });
            let output = singleSentence
            return (
                output
            )


        }
    }
    renderAllavailability(element) {
        if (element.length !== undefined) {
            let sentences = [...(new Set(element.map(d => d['hotelinfo']).flat().map(a => a['hotel']).flat()
                .map((d) => {
                    if (d['hotelinfo']) {
                        return d['families']
                    }
                }).flat()
                .map((info) => {
                    if (info) {
                        return info['availablerooms']
                    }
                })
                .flat()
                .map((info) => {
                    if (info) {
                        return info['info']['availability']
                    }
                })
            ))]

            let singleSentence = sentences.map((s) => {
                if (s !== undefined) {
                    return <React.Fragment><div className="item2"><div className="right rightCheck" data-index="1"><input type="checkbox" value={s} className="all_availability" onChange={((e) => this.handleChange(e))} defaultChecked={this.props.defaultChecked} /><label for="filter"><span className="checkbox"><span>{s}</span></span></label></div><div className="clr"></div></div></React.Fragment>
                }
            });
            let output = singleSentence
            return (
                output
            )


        }
    }
    renderhomepage = event => {
        return window.location = '/'
    }
    handleChange = (e) => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
        let isChecked = e.target.checked
        let valu = e.target.value
        let classname = e.target.getAttribute("class");
        switch (classname) {
            case 'service':
                if (isChecked) {
                    this.service.push(valu + ',')
                } else {
                    this.service.splice(this.service.indexOf(valu + ','), 1)
                }
                break;
            case 'stars':
                if (isChecked) {
                    this.stars.push(valu + ',')
                } else {
                    this.stars.splice(this.stars.indexOf(valu + ','), 1)
                }
                break;
            case 'all_availability':
                if (isChecked) {
                    this.availability.push(valu + ',')
                } else {
                    this.availability.splice(this.availability.indexOf(valu + ','), 1)
                }
                break;
            case 'startairline':
                if (isChecked) {
                    this.airlines.push(valu + ',')
                } else {
                    this.airlines.splice(this.airlines.indexOf(valu + ','), 1)
                }
                break;
            case 'stops':
                if (isChecked) {
                    this.stops.push(valu + ',')
                } else {
                    this.stops.splice(this.stops.indexOf(valu + ','), 1)
                }
                break;
            case 'classNames':
                if (isChecked) {
                    this.classNames.push(valu + ',')
                } else {
                    this.classNames.splice(this.classNames.indexOf(valu + ','), 1)
                }
                break;

        }
        $(document).trigger('update_result', [this.service.join(), this.stars.join(), this.availability.join(), this.airlines.join(), this.classNames.join(), this.stops.join()])
    }
    renderCount() {
        let maxPage = this.state.maxPage
        let len = this.renderLibrary().length
        let sum = len * maxPage
        sum = sum || 0
        if (sum == '0') {
            $("#page-numbers").hide()
        } else {
            $("#page-numbers").show()
        }

    }
    renderNeardate(element, i) {
        let neardate = element.neardate
        if (neardate == '1') {
            $(".ndate-box").show()
        }
    }
    renderTourname(element) {
        $(".TourNameSub").val(element)
    }
    renderFdate(element) {
        $(".FdateSub").val(element)
    }
    rendertdate(element) {
        $(".TdateSub").val(element)
    }
    renderprovider(element) {
        let provider = element.id.provider
        if (provider == undefined) {
            return ''
        } else {
            return <input type="hidden" value={JSON.stringify(provider)} name="mainprovider" />
        }
    }
    renderhotelgroupid(element) {
        if (element.hotelinfo[0].hotel.length == 0) {
            return <input type="hidden" value="" name="hotelgroupid" />
        } else {
            return <input type="hidden" value={element.hotelinfo[0].hotel[0].hotelgroupid} name="hotelgroupid" />
        }
    }
    renderTime(element) {
        if (element.time !== undefined) {
            return <span>{element.time.wenttime} - {element.time.backtime}</span>
        }
    }
    renderproviderId(element) {
        let provider = element.provider
        if (provider == undefined) {
            return <input type="hidden" value="0" name="provider" />
        } else {
            let providerId = element.provider.provider_id
            return <input type="hidden" value={providerId} name="provider" />
        }
    }

    renderbacktobackinfo(element, i) {
        if (element !== undefined) {
            return <div>
                <div className="tlttour">اطلاعات پرواز (رفت و برگشت)</div>
                {this.rendermainflights(element, i)}
                <div className="clr"></div>
            </div>

        }

    }
    rendermainflights(element, i) {
        let lenmainflights = element.mainflights.length
        let indents = []
        let index = 0
        for (let len = 0; len < lenmainflights; len++) {
            let numlen = len
            let numCounter = i
            let stinglen = numlen.toString()
            let stingCounter = numCounter.toString()
            index = stinglen + stingCounter
            indents.push(<div className="each_row-flight">
                <div className="ticket-arrive">
                    <div className="right-side2">
                        <div className="inner-parts">
                            <div className="ticket-logo ticketbackto"><img src={element.mainflights[len].ticketinfooo.showstartairline}
                                width="100" height="40" alt={element.mainflights[len].routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                <div className="flightClass"><span>شماره پرواز : {element.mainflights[len].routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                            </div>
                        </div>
                    </div>
                    <div className="middle-side middelround">
                        <div className="box1-ticket">
                            <div className="flight-class">
                                <div className="inner-info">
                                    <span className="btn-large">
                                        <div>کلاس پروازی {element.mainflights[len].classname}</div>
                                    </span>
                                </div>
                            </div>
                            <div className="info-beginDestination">
                                <div className="inner-info">
                                    <div className="time-go">
                                        <span className="timeTicket1">{element.mainflights[len].ticketinfooo.exitinfo.showexittime}</span>
                                    </div>
                                    <div className="first-line2">
                                        <span>( {element.mainflights[len].ticketinfooo.exitinfo.shortstartairport} )</span>
                                        <span>{element.mainflights[len].infoo.showstartcity}</span>
                                    </div>

                                </div>
                            </div>

                            <div className="rout">
                                <div className="inner-rout">
                                    <div className="shape-rout">


                                        <div className="line">
                                            <span className="total-time">{element.mainflights[len].ticketinfooo.stoppinfoo.showtiming}</span>
                                            {this.renderStopinfo(element.mainflights[len].ticketinfooo.stoppinfoo.showstopinfo)}
                                        </div>

                                    </div>

                                </div>
                            </div>

                            <div className="info-beginDestination2">
                                <div className="inner-info">
                                    <div className="time-go">
                                        <span className="timeTicket2">{element.mainflights[len].ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                    </div>
                                    <div className="first-line2">
                                        <span> ( {element.mainflights[len].ticketinfooo.arrivalinfo.shortendairport} )</span>
                                        <span>{element.mainflights[len].infoo.showendcity} </span>
                                    </div>
                                    <div className="second-line2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {this.renderAllDetails(index, lenmainflights)}



                {this.renderDetails(element.mainflights[len], index, lenmainflights)}
                <div className="clr"></div>
            </div>
            )

        }
        return (
            indents
        )
    }

    renderStopinfo(element) {
        let stop = element.showstopinfo
        if (stop == 0) {
            return <div className="stopORnotStop"><span>بدون توقف</span></div>
        } else {
            return <div className="stopORnotStop"><span>{element.showstopinfo} توقف</span></div>

        }
    }
    renderAllDetails(i, len) {
        let numlen = len
        let numCounter = i
        let stinglen = numlen.toString()
        let stingCounter = numCounter.toString()
        let index = stinglen + stingCounter
        return <div className="Details-box" onClick={((e) => this.showAllDetails(e, index))}>
            <span>جزئیات پرواز</span><i className={`icon icon-arrow-down-16 ${!this.state.visibleAllDetails[index] ? "downarrow" : "uparrow"}`} ></i>
        </div>

    }
    renderDetails(element, i, len) {
        let numlen = len
        let numCounter = i
        let stinglen = numlen.toString()
        let stingCounter = numCounter.toString()
        let index = stinglen + stingCounter
        return <div className={`detalis-flight-main ${!this.state.visibleAllDetails[index] ? "unvisibleD" : "visibleD"}`}>
            <div className={`details ${!this.state.activeTab_details[index] ? "" : "active-tab"}`} onClick={((e) => this.showDetails(e, index))}><a>جزییات پرواز</a></div>
            <div className={`details ${!this.state.activeTab_rule[index] ? "" : "active-tab"}`} onClick={((e) => this.showRule(e, index))}> <a>قوانین پرواز</a> </div>
            <div className={`details ${!this.state.activeTab_bar[index] ? "" : "active-tab"}`} onClick={((e) => this.showBar(e, index))}> <a>قوانین بار</a> </div>
            <div key={index} className={`rulls-box ${!this.state.visibleDetails[index] ? "unvisible" : "visible"}`}>
                <div className="close" onClick={() => this.closeDetails(index)}> <span className="fa-times"></span></div>
                <div id="details-flight">
                    <div className="table2 flightdetails">{this.renderDetailsFlight(element)}</div>
                </div>
            </div>

            <div key={index} className={`rulls-box ${!this.state.visibleBar[index] ? "unvisible" : "visible"}`}>
                <div className="close" onClick={() => this.closeBar(index)}> <span className="fa-times"></span></div>
                <div className="table">
                    <div dir="auto" className="eachBarInfo"><span>بار کابین: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.barinfo.bar2 }}></span></div>
                    <div dir="auto" className="eachBarInfo"><span>بار مجاز: </span><span className="bar" dangerouslySetInnerHTML={{ __html: element.barinfo.bar1 }}></span></div>
                    <div className="clr"></div>
                </div>
            </div>
            <div key={index} className={`rulls-box ${!this.state.visibleRule[index] ? "unvisible" : "visible"}`}>
                <div className="close" onClick={() => this.closeRule(index)}> <span className="fa-times"></span></div>
                <div className="table">
                    {this.renderdescription(element.routeshow.description)}
                </div>
            </div>
        </div>
    }
    renderdescription(element) {
        if (element = ' ') {
            return <div dir="auto" className="text-right max-height">-</div>
        } else {
            return <div dir="auto" className="text-justify max-height" dangerouslySetInnerHTML={{ __html: element }}></div>
        }

    }
    renderDetailsFlight(element) {
        let len = element.routeshow.routesinfoo.length
        let indents = []
        for (let i = 0; i < len; i++) {
            indents.push(<div className="details-item">
                <p className="details_title font_weight"> ({element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsstartcity} - {element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsendcity})</p>
                <div className="content row">
                    <div className="details-col row first-col">
                        <span>/<span className="EnNum"></span></span>
                        <span>/<span className="EnNum"></span></span>
                    </div>
                    <div className="details-col row second-col">

                        <div className="city-dep">
                            <span className="city_hour">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.detailsexittime}</span>
                            <i className="city_sep-dot background-color_2"></i>
                            <label className="city_name">
                                <span>{element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsstartcity}،</span>
                                <span>({element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsexittimeinfo.detailsexitairport})</span>
                            </label>
                        </div>
                        <div className="duration-time d-flex">
                            <span className="duration-time_dot d-flex">
                                <i className="background-color_2"></i><i
                                    className="background-color_2"></i><i
                                        className="background-color_2"></i><i
                                            className="background-color_2"></i><i
                                                className="background-color_2"></i>
                            </span>
                            <span className="duration-time_text">مدت پرواز: {element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailstiming}</span>
                        </div>
                        <div className="city-dest">
                            <span className="city_hour">{element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.detailsarrivaltime}</span>
                            <i className="city_sep-dot background-color_2"></i>
                            <label className="city_name">
                                <span>{element.routeshow.routesinfoo[i].routesinfoodetails.detailscityinfo.detailsendcity}،</span>
                                <span>({element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsarrivaltimeinfo.detailsarrivalairport})</span>
                            </label>
                        </div>
                    </div>
                    <div className="details-col row third-col">
                        <img src={element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairlineimage} alt={element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsairline} width="80" height="32"
                        />
                        <div className="class-item font_11 p-relative">{element.classname}</div>
                        <span className="code-item font_10 p-relative"> شماره پرواز: {element.routeshow.routesinfoo[i].routesinfoodetails.otherdetails.detailsroutecode}</span>
                    </div>
                </div>
            </div>);
        }
        return (
            indents
        )
    }
    renderonewayflights(element, i) {
        if (element.onewayflights !== undefined) {
            let lenonewayflights = element.onewayflights.length
            let indents = []
            if (lenonewayflights == 0) {
            } else {
                let index = 0
                for (let len = 0; len < lenonewayflights; len++) {
                    let numlen = len
                    let numCounter = i
                    let stinglen = numlen.toString()
                    let stingCounter = numCounter.toString()
                    index = stinglen + stingCounter
                    indents.push(<div>
                        <div className="tlttour">اطلاعات پرواز ( داخلی )</div>

                        <div className="each_row-flight">
                            <div className="ticket-arrive">
                                <div className="right-side2">
                                    <div className="inner-parts">
                                        <div className="ticket-logo ticketbackto"><img src={element.onewayflights[len].ticketinfooo.showstartairline}
                                            width="100" height="40" alt={element.onewayflights[len].routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsairline} />
                                            <div className="flightClass"><span>شماره پرواز : {element.onewayflights[len].routeshow.routesinfoo[0].routesinfoodetails.otherdetails.detailsroutecode}</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="middle-side middelround">
                                    <div className="box1-ticket">
                                        <div className="flight-class">
                                            <div className="inner-info">
                                                <span className="btn-large">
                                                    <div>کلاس پروازی {element.onewayflights[len].classname}</div>
                                                </span>
                                            </div>
                                        </div>
                                        <div className="info-beginDestination">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket1">{element.onewayflights[len].ticketinfooo.exitinfo.showexittime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span>( {element.onewayflights[len].ticketinfooo.exitinfo.shortstartairport} )</span>
                                                    <span>{element.onewayflights[len].infoo.showstartcity}</span>
                                                </div>

                                            </div>
                                        </div>

                                        <div className="rout">
                                            <div className="inner-rout">
                                                <div className="shape-rout">


                                                    <div className="line">
                                                        <span className="total-time">{element.onewayflights[len].ticketinfooo.stoppinfoo.showtiming}</span>
                                                        {this.renderStopinfo(element.onewayflights[len].ticketinfooo.stoppinfoo.showstopinfo)}
                                                    </div>

                                                </div>

                                            </div>
                                        </div>

                                        <div className="info-beginDestination2">
                                            <div className="inner-info">
                                                <div className="time-go">
                                                    <span className="timeTicket2">{element.onewayflights[len].ticketinfooo.arrivalinfo.showarrivaltime}</span>
                                                </div>
                                                <div className="first-line2">
                                                    <span> ( {element.onewayflights[len].ticketinfooo.arrivalinfo.shortendairport} )</span>
                                                    <span>{element.onewayflights[len].infoo.showendcity} </span>
                                                </div>
                                                <div className="second-line2"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {this.renderAllDetails(index, lenonewayflights)}


                            {this.renderDetails(element.onewayflights[len], index, lenonewayflights)}
                            <div className="clr"></div>

                        </div> </div>)
                }
                return (indents)
            }
        }

    }
    renderhotelinfo_wrapper(element) {
        if (element.basiscoreid == undefined) {
            return <div className="inner-box-hotel">
                <div className="tlttour">اطلاعات هتل</div>
                {this.renderhotelinfo(element, element.index)}
            </div>


        } else {
            return <div className="hotel-part type_10"><input type="hidden" value={element.basiscoreid} className="basiscoreid" /><div className="load_info_tour"></div>{this.renderhotelinfo(element, element.index)}</div>
        }
    }


    renderhotelinfo(element, index) {
        if (element.basiscoreid == undefined) {
            for (let i = 0; i < element.hotelinfo.length; i++) {
                let indents = []
                for (let j = 0; j < element.hotelinfo[i].hotel.length; j++) {
                    let night = j + 1
                    indents.push(<div className="section_hotel tour">
                        <div className="right_part float_right">
                            {this.renderImgHotel(element.hotelinfo[i].hotel[j], j, element, index)}

                            <div className="clr"></div>
                        </div>
                        {this.renderInfo(element.hotelinfo[i].hotel[j])}
                        <div id="box-rooms">
                            <div className="table">
                                <table className="rooms-tbl">
                                    <tbody>
                                        <tr className="first-row">
                                            <td className="travelers"><span>نوع اتاق</span></td>
                                            <td className="everyPart-cost"><span>نمای اتاق</span></td>
                                            <td className="everyPart-cost"><span>نوع سرویس</span></td>
                                            <td className="everyPart-cost"><span>وضعیت</span></td>
                                        </tr>
                                    </tbody>
                                    {this.renderInfoFamily(element.hotelinfo[i].hotel[j], j, element, index)}
                                </table>
                            </div>
                        </div>
                        <div className="clr"></div>
                    </div>)
                }
                return (
                    indents
                )
            }
        } else {

            for (let i = 0; i < element.hotelinfo.length; i++) {
                let indents = []
                if (element.hotelinfo[i].hotel.length !== 0) {
                    indents = []
                }
                for (let j = 0; j < element.hotelinfo[i].hotel.length; j++) {
                    let night = j + 1
                    indents.push(<div><div className="item_hotel font_13 row"><div className="section_tour_img float_right p-relative">{this.render_img_hotel(element.hotelinfo[i].hotel[j])}</div><div className="section_tour_night float_right"><span className="Qu-info-hotel ">شب</span><span> {night} </span></div><div className="section_tour_name float_right"><span className="Qu-info-hotel ">اقامت در هتل: </span><span>{this.render_name_hotel(element.hotelinfo[i].hotel[j])}</span></div><div className="section_tour_date float_right"><span className="Qu-info-hotel ">تاریخ :</span>{this.render_date_hotel(element, j)}</div>{this.render_room_hotel(element.hotelinfo[i].hotel[j], j + '-' + index)}
                        <div className="clr"></div></div><div key={j + '-' + index} className={` ${!this.state.Visible_rooms[j + '-' + index] ? "unvisible" : "visible"}`}>{this.render_show_rooms(element.hotelinfo[i].hotel[j], j, element, index)}<div className="clr"></div></div></div>)
                }
                return (
                    indents
                )
            }
        }

    }
    render_room_hotel(element, index) {
        if (element.hotelinfo == undefined) {
            return <div className="section_tour_room float_right not_active_room"><span>اتاق ها</span></div>
        } else {
            return <div className="section_tour_room float_right active_room"><span onClick={() => this.onclick_render_rooms(index)}>اتاق ها</span></div>
        }
    }


    render_show_rooms(element, j, ItemElement, index) {
        if (element.hotelinfo == undefined) {
            return ''
        } else {
            return <div className="item-info-module width_100">
                <table className="details-tbl font_12">
                    <tr>
                        <th>اتاق</th>
                        <th>وضعیت</th>
                        <th>نما - سرویس</th>
                    </tr>
                    {this.renderInfoFamily(element, j, ItemElement, index)}
                </table>
            </div>

        }
    }
    render_name_hotel(element) {
        if (element.hotelinfo == undefined) {
            return 'ندارد'
        } else {
            return element.hotelinfo.hotelsearch.realname
        }
    }
    render_date_hotel(element, index) {
        return <span className="date_hotel font_11"><span>{element.nights[index].fdate.sstring} <span>({element.nights[index].fdate.mstring})</span></span>  / <span>{element.nights[index].tdate.sstring} <span>({element.nights[index].tdate.mstring})</span></span> </span>

    }
    render_img_hotel(element) {
        if (element.hotelinfo !== undefined) {
            return <a href={this.renderHotelid(element.hotelinfo.hotelsearch)} target="_blank"><img className="p-relative" src={element.hotelinfo.hotelsearch.hotelimage} width="50" height="50" alt={element.hotelinfo.hotelsearch.realname} /></a>

        }
    }
    onclick_render_rooms = (i) => {
        this.setState(prevState => ({
            Visible_rooms: { ...prevState.Visible_rooms, [i]: !prevState.Visible_rooms[i] }
        }))
    }
    renderImgHotel(element) {
        return <div className="img">
            <div className="showImage"><img src={element.hotelinfo.hotelsearch.hotelimage} alt={this.renderAltImage(element.hotelinfo.hotelsearch)} className="imgnows" width="200" height="200" /></div>
        </div>
    }
    renderAltImage(element) {
        return element.realname
    }
    renderHotelid(element) {
        let hotelId = element.hotelid
        return '/shhotel.bc?id=' + hotelId
    }
    renderInfo(element) {
        return <div className="left_part float_left">
            <div>{element.hotelinfo.name}</div>
            <div><img src={(`/images/${element.hotelinfo.hotelsearch.star}-rating.png`)} alt="rating" width="80" height="16" /></div>

            <div className="hotel_dtail1">
                <p className="hotel_details_link"><span className="fa fa-calendar"></span>ورود به
        هتل: <span>{element.hotelinfo.validatedate.fdate.sstring} / {element.hotelinfo.validatedate.fdate.mstring}</span>
                </p>

                <p className="hotel_details_link"><span className="fa fa-calendar"></span>خروج از هتل:
        <span>{element.hotelinfo.validatedate.tdate.sstring} / {element.hotelinfo.validatedate.tdate.mstring}</span>
                </p>

                <p className="hotel_details_link"><span className="fa fa-building2"></span>مدت اقامت :
        {element.nights} شب</p>
                <p className="hotel_details_link"><span className="fa fa-map-marker"></span>{element.hotelinfo.hotelsearch.cityname} -
        {element.hotelinfo.hotelsearch.countryname}
                </p>
            </div>

        </div>
    }
    renderInfoFamily(element, j, ItemElement, index) {
        let indents = []
        let lenfamilies = element.families.length
        for (let x = 0; x < lenfamilies; x++) {
            let idjx = j + x
            indents.push(<tbody className="rooms_tbody">
                <tr className="other-rows middle-row">
                    <td colspan="4" className="room_title">{this.rendercountpassenger(element.families[x], x)}</td>
                </tr>
                {this.renderavailablerooms(element.families[x], element, idjx, x, ItemElement, index, j)}
            </tbody>)
        }
        return (
            indents
        )
    }
    rendercountpassenger(element, x) {
        let info = [##cms.json.header | cms.form.roomSearch##]
        if (x == 0) {
            let ad = info.rooms[0].adultcount
            let ch = info.rooms[0].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""

                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    age = age + sp[i] + " سال "
                    ages2 = ages2 + sp[i] + ','
                }
                return <span>اتاق اول ({ad} بزرگسال / {sp[0]} کودک / {age})</span>
            }
            else {
                return <span>اتاق اول ({ad} بزرگسال )</span>

            }
        }
        else if (x == 1) {
            let ad = info.rooms[1].adultcount
            let ch = info.rooms[1].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""

                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    age = age + sp[i] + " سال "
                    ages2 = ages2 + sp[i] + ','
                }
                return <span>اتاق دوم ({ad} بزرگسال / {sp[0]} کودک {age})</span>

            }
            else {
                return <span>اتاق دوم ({ad} بزرگسال )</span>

            }
        }
        else if (x == 2) {
            let ad = info.rooms[2].adultcount
            let ch = info.rooms[2].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""

                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    age = age + sp[i] + " سال "
                    ages2 = ages2 + sp[i] + ','
                }
                return <span>اتاق سوم ({ad} بزرگسال / {sp[0]} کودک {age})</span>
            }
            else {
                return <span>اتاق سوم ({ad} بزرگسال )</span>

            }
        }
        else if (x == 3) {
            let ad = info.rooms[3].adultcount
            let ch = info.rooms[3].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""

                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    age = age + sp[i] + " سال "
                    ages2 = ages2 + sp[i] + ','
                }
                return <span>اتاق چهارم ({ad} بزرگسال / {sp[0]} کودک {age})</span>
            }
            else {
                return <span>اتاق چهارم ({ad} بزرگسال )</span>

            }
        }
    }

    renderavailablerooms(element, item, idjx, x, ItemElement, index, j) {
        let lenavailablerooms = element.availablerooms.length
        let indents = []
        for (let i = 0; i < lenavailablerooms; i++) {
            let idx = i + x
            let idj = idjx + x
            indents.push(<tr className="other-rows">
                <td className="radioRoom"> {this.renderInputRadio(element.availablerooms[i], i, idx, idj, x, lenavailablerooms, ItemElement, index, j)}</td>
                <td>{this.renderview(item)}</td>
                <td>{this.renderServiceHotel(item)}</td>
                <td>{this.renderavailabilityHotel(element.availablerooms[i].info.availability)}</td>
            </tr>)
        }
        return (
            indents
        )
    }
    renderview(element) {
        return <span>{element.hotelinfo.information.viewname}</span>

    }
    renderServiceHotel(element) {
        return <span>{element.hotelinfo.hotelsearch.services}</span>
    }
    renderavailabilityHotel(element) {
        if (element == 'onrequest') {
            return <td><span className="fa-clock-o"></span><span>{element}</span></td>
        } else if (element == 'available') {
            return <td><span className="fa-check2"></span><span>{element}</span></td>
        }

    }
    renderInputRadio(element, i, idx, idj, x, lenavailablerooms, ItemElement, index, j) {
        if (i == 0) {
            return <div>
                <input type="hidden" name={`_root.rooms__${idx}.roomids__${idj}.roomid`} key={idj} defaultValue={this.state.roomids[idj] || element.info.roomid} />
                <input type="hidden" name={`_root.rooms__${idx}.roomids__${idj}.adultcount`} value={element.info.adults} />
                <input type="hidden" name={`_root.rooms__${idx}.roomids__${idj}.childwithbed`} value={element.info.withbed} />
                <input type="hidden" name={`_root.rooms__${idx}.roomids__${idj}.childwithoutbed`} value={element.info.withoutbed} />
                <input type="hidden" name={`_root.rooms__${idx}.roomids__${idj}.infant`} value={element.info.infants} />
                <input type="hidden" name={`_root.rooms__${idx}.adultcount`} value={this.rendervalueAdult(element, i, idx, idj, x)} />
                <input type="hidden" name={`_root.rooms__${idx}.childcountandage`} value={this.rendervalueChild(element, i, idx, idj, x)} />
                <input type="radio" value={element.info.roomid} onChange={((e) => this.handleCheck(e, i, idj, x, ItemElement, j, element.info.adults, element.info.withbed, element.info.withoutbed, element.info.infants))} name={`element${idj + '-' + j + '-' + index}`} defaultChecked={this.state.ischecked} className="KindRoom2" />
                <label for="KindRoom2"><span className="radio radio2">{element.info.room}</span></label>
            </div>
        } else {
            return <div>
                <input type="radio" value={element.info.roomid} onChange={((e) => this.handleCheck(e, i, idj, x, ItemElement, j, element.info.adults, element.info.withbed, element.info.withoutbed, element.info.infants))} name={`element${idj + '-' + j + '-' + index}`} className="KindRoom2" />
                <label for="KindRoom2"><span className="radio radio2">{element.info.room}</span></label>
            </div>
        }
    }

    handleCheck = (e, i, idj, x, ItemElement, j, ad, ch1, ch2, inf) => {

let value = e.target.value
let gid = ItemElement.id
let city_index = ItemElement.hotelinfo[0].hotel[j].cityindex
let room_index = ItemElement.hotelinfo[0].hotel[j].families[x].roomindex
let adcount = ad
let chcount1 = ch1 
let chcount2 = ch2
let passsum = parseInt(ch1 + ch2 + ad + inf)
// let chcount = parseInt(ch1 + ch2)
let infcount = inf
let last_adult = 0
let last_child1 = 0
let last_child2 = 0
let last_infant = 0

this.setState({
    chflag: 1,
    cityindex: city_index,
    roomindex: room_index,
    hgid: gid,
    roomcheck: x

});

if (!this.state.copy[gid]) {

    this.state.copy[gid] = {}
    this.state.copy[gid]["costtable"] = ItemElement.costtable

}

let familylen = ItemElement.costOptions[j].families[x].roomsOption[i].family.length
let extra_count = 0;
for(let Flen=0 ; Flen < familylen ; Flen++){
    if(ItemElement.costOptions[j].families[x].roomsOption[i].family[Flen].type == 4)
     extra_count++
 }
if (this.state.jsonbackup[gid]) {
    if (this.state.jsonbackup[gid][city_index + "-" + room_index]) {
        this.state.jsonbackup[gid][city_index + "-" + room_index]["roomname"] = ItemElement.costOptions[j].families[x].roomsOption[i].roomname
        if (adcount > 0) {
            last_adult = this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"]
            this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[extra_count].cost
        } else if (adcount == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = 0
        }
        if (chcount1 > 0) {
            last_child1 = this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"]
            for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 1){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost  
                }
            }
        } else if (chcount1 == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = 0
        }
        if (chcount2 > 0) {
            last_child2 = this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"]
            for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 3){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
            }
        } else if (chcount2 == 0) { 
            this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = 0
        } 
        if (infcount > 0) {
            last_infant = this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"]
            for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 0){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
            }
        } else if (infcount == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = 0
        }

        this.state.jsonbackup[gid][city_index + "-" + room_index]["total_diff"] = ItemElement.costOptions[j].families[x].roomsOption[i].total_diff_cost

    } else {
        this.state.jsonbackup[gid][city_index + "-" + room_index] = {}
        this.state.jsonbackup[gid][city_index + "-" + room_index]["roomname"] = ItemElement.costOptions[j].families[x].roomsOption[i].roomname
        if (adcount > 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[extra_count].cost
        } else if (adcount == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = 0
        }
        if (chcount1 > 0) {
            for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 1){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
            }
        } else if (chcount1 == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = 0
        }
        if (chcount2 > 0) {
            for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 3){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
            }
        } else if (chcount2 == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = 0
        }
       
        if (infcount > 0) {
           for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 0){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
            }
        } else if (infcount == 0) {
            this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = 0
        }

        this.state.jsonbackup[gid][city_index + "-" + room_index]["total_diff"] = ItemElement.costOptions[j].families[x].roomsOption[i].total_diff_cost

    }

    let copylen = this.state.copy[gid].costtable[room_index].family.length
    this.state.copy[gid].costtable[room_index].roomname = this.state.jsonbackup[gid][city_index + "-" + room_index]["roomname"]
    for (let k = 0; k < copylen; k++) {
        if (this.state.copy[gid].costtable[room_index].family[k].type == 4) {
            this.state.copy[gid].costtable[room_index].family[k].cost = parseInt(this.state.copy[gid].costtable[room_index].family[k].cost - last_adult + this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"])
            this.state.copy[gid].costtable[room_index].family[k].title = ItemElement.costOptions[j].families[x].roomsOption[i].family[k].title
        }
        if (this.state.copy[gid].costtable[room_index].family[k].type == 2) {
            this.state.copy[gid].costtable[room_index].family[k].cost = parseInt(this.state.copy[gid].costtable[room_index].family[k].cost - last_adult + this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"])
            this.state.copy[gid].costtable[room_index].family[k].title = ItemElement.costOptions[j].families[x].roomsOption[i].family[k].title
        }
        else if (this.state.copy[gid].costtable[room_index].family[k].type == 1 ) {
            this.state.copy[gid].costtable[room_index].family[k].cost = parseInt(this.state.copy[gid].costtable[room_index].family[k].cost - last_child1 + this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"]) || 0
        }
        else if (this.state.copy[gid].costtable[room_index].family[k].type == 3) {
            this.state.copy[gid].costtable[room_index].family[k].cost = parseInt(this.state.copy[gid].costtable[room_index].family[k].cost - last_child2 + this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"]) || 0
        }
        else if (this.state.copy[gid].costtable[room_index].family[k].type == 0) {
            this.state.copy[gid].costtable[room_index].family[k].cost = parseInt(this.state.copy[gid].costtable[room_index].family[k].cost - last_infant + this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"]) || 0
        }
    }
} else {
    this.state.jsonbackup[gid] = {}
    this.state.jsonbackup[gid][city_index + "-" + room_index] = {}
    this.state.jsonbackup[gid][city_index + "-" + room_index]["roomname"] = ItemElement.costOptions[j].families[x].roomsOption[i].roomname
    if (adcount > 0) {
        this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[extra_count].cost
    } else if (adcount == 0) {
        this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"] = 0
    }
    if (chcount1 > 0) {
        for (let ctype = adcount; ctype < passsum; ctype++) {
                if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 1){
                    this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
        }
    } else if (chcount1 == 0) {
         this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] = 0
    }
    if (chcount2 > 0) {
        for (let ctype = adcount; ctype < passsum; ctype++) {
            if(this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 3){
                this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
        }
    } else if (chcount2 == 0) {
        this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] = 0
    }
    if (infcount > 0) {
        for (let ctype = adcount; ctype < passsum; ctype++) {
            if(this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].type == 0){
                this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = ItemElement.costOptions[j].families[x].roomsOption[i].family[ctype].cost
                }
        }
    } else if (infcount == 0) {
        this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] = 0
    }

    this.state.jsonbackup[gid][city_index + "-" + room_index]["total_diff"] = ItemElement.costOptions[j].families[x].roomsOption[i].total_diff_cost

    let copylen = this.state.copy[gid].costtable[room_index].family.length
    this.state.copy[gid].costtable[room_index].roomname = this.state.jsonbackup[gid][city_index + "-" + room_index]["roomname"]
    for (let k = 0; k < copylen; k++) {
    if (this.state.copy[gid].costtable[room_index].family[k].type == 4) {
        this.state.copy[gid].costtable[room_index].family[k].cost += this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"]
        this.state.copy[gid].costtable[room_index].family[k].title = ItemElement.costOptions[j].families[x].roomsOption[i].family[k].title
    }
    else if (this.state.copy[gid].costtable[room_index].family[k].type == 2) {
        this.state.copy[gid].costtable[room_index].family[k].cost += this.state.jsonbackup[gid][city_index + "-" + room_index]["adult"]
        this.state.copy[gid].costtable[room_index].family[k].title = ItemElement.costOptions[j].families[x].roomsOption[i].family[k].title
    }
    else if (this.state.copy[gid].costtable[room_index].family[k].type == 1 ) {
        this.state.copy[gid].costtable[room_index].family[k].cost += this.state.jsonbackup[gid][city_index + "-" + room_index]["child1"] || 0
    }
    else if (this.state.copy[gid].costtable[room_index].family[k].type == 3) {
        this.state.copy[gid].costtable[room_index].family[k].cost += this.state.jsonbackup[gid][city_index + "-" + room_index]["child2"] || 0
    }
    else if (this.state.copy[gid].costtable[room_index].family[k].type == 0) {
        this.state.copy[gid].costtable[room_index].family[k].cost += this.state.jsonbackup[gid][city_index + "-" + room_index]["infant"] || 0
    }
}

}
this.setState({
    copy: this.state.copy
});


this.setState({
    jsonbackup: this.state.jsonbackup
});


return this.setState(prevState => ({
    roomids: { ...prevState.roomids, [idj]: value }
}))
}
    rendervalueAdult(element, i, idx, idj, x) {
        let info = [##cms.json.header | cms.form.roomSearch##]
        if (x == 0) {
            let ad = info.rooms[0].adultcount
            return ad

        }
        else if (x == 1) {
            let ad = info.rooms[1].adultcount
            return ad

        }
        else if (x == 2) {
            let ad = info.rooms[2].adultcount
            return ad

        }
        else if (x == 3) {
            let ad = info.rooms[3].adultcount
            return ad

        }
    }
    rendervalueChild(element, i, idx, idj, x) {
        let info = [##cms.json.header | cms.form.roomSearch##]
        if (x == 0) {
            let ch = info.rooms[x].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""
                let val = ""
                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    ages2 = ages2 + sp[i] + ','
                }
                val = val + '' + sp[0] + ',' + ages2
                val = val.slice(0, -1)
                return val
            }
            else {
                return sp[0]
            }

        }
        else if (x == 1) {
            let ch = info.rooms[x].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""
                let val = ""
                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    ages2 = ages2 + sp[i] + ','
                }
                val = val + '' + sp[0] + ',' + ages2
                val = val.slice(0, -1)
                return val
            }
            else {
                return sp[0]
            }

        }
        else if (x == 2) {
            let ch = info.rooms[x].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""
                let val = ""
                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    ages2 = ages2 + sp[i] + ','
                }
                val = val + '' + sp[0] + ',' + ages2
                val = val.slice(0, -1)
                return val
            }
            else {
                return sp[0]
            }

        }
        else if (x == 3) {
            let ch = info.rooms[x].childcountandage
            let sp = ch.split(",")
            if (sp[0] > 0) {
                let age = ""
                let val = ""
                let ages2 = ""
                for (let i = 1; i < sp.length; i++) {
                    ages2 = ages2 + sp[i] + ','
                }
                val = val + '' + sp[0] + ',' + ages2
                val = val.slice(0, -1)
                return val
            }
            else {
                return sp[0]
            }

        }
    }

    rendercosttable(element) {
        let indents = [];
        if (this.state.chflag == 0) {
            let lencost = element.costtable.length
            for (let i = 0; i < lencost; i++) {

                indents.push(<div className="costtable"><div className="roomname">{element.costtable[i].roomname}</div><div className="familycost">{this.renderFamilycost(element.costtable[i], element, i)}</div></div>)
            }
            return (
                indents
            )
        } else {

            let lencost = element.costtable.length
            for (let i = 0; i < lencost; i++) {
                indents.push(<div className="costtable"><div className="roomname">{this.renderroomname(element, i)}</div><div className="familycost">{this.renderFamilycost(this.state.copy[this.state.hgid].costtable[i], element, i)}</div></div>)
            }
            return (
                indents
            )

        }

    }
    renderFamilycost(element, item, lenc) {
        let lenFamilycost = element.family.length
        let indents = [];
        for (let i = 0; i < lenFamilycost; i++) {
            indents.push(<div className="eachfamilycost"><div className="eachInfo">{element.family[i].title}</div><div className="eachInfo"><span className="cost-ticket2">{new Intl.NumberFormat().format(this.rendertablecost2(element.family[i].cost, i, item, lenc))}</span><span className="monettypetbl">ریال</span></div><div className="clr"></div></div>)
        }
        return (
            indents
        )
    }
    renderroomname(item, lenc) {
        let json = this.state.jsonbackup
        let copy = this.state.copy
        let tour = item.id
        let name = item.costtable[lenc].roomname
        if (json[tour]) {
            if (item.id == this.state.hgid) {
                name = this.state.copy[this.state.hgid].costtable[lenc].roomname
            } else {
                name = this.state.copy[tour].costtable[lenc].roomname
            }
        } else {
            name = item.costtable[lenc].roomname
        }
        return name
    }
    rendertablecost2(element, i, item, lenc) {
        let total = element
        let json = this.state.jsonbackup
        let copy = this.state.copy
        let tour = item.id
        if (json[tour]) {
            if (item.id == this.state.hgid) {
                total = element
            } else {
                total = this.state.copy[tour].costtable[lenc].family[i].cost
            }
        } else {
            total = item.costtable[lenc].family[i].cost
        }
        return total
    }
    renderTotal(element) {
        let total = element.totalcostmin
        let total2 = 0
        let json = this.state.jsonbackup
        let tour = element.id
        if (!json[tour]) {
            total2 = 0
        }
        else {
            let room = 0
            for (room in json[tour]) {
                total2 += json[tour][room]["total_diff"]
            }
        }
        return new Intl.NumberFormat().format(parseInt(total2 + total))
    }
    renderCommission(element) {
        let i = element.commissioncost
        let x = element.unit
        if (i == 0) {
            return '';
        } else {
            let total = element.totalcostmin
            let commissionlen = parseInt(element.commissionDetails.length - 1)
            let com = element.commissionDetails[commissionlen].commission
            let total2 = 0
            let json = this.state.jsonbackup
            let tour = element.id
            if (!json[tour]) {
                total2 = 0
            }
            else {
                let room = 0
                for (room in json[tour]) {
                    total2 += json[tour][room]["total_diff"]
                }
            }
            let finalcommission = parseInt(total2 + total) * com
            return <div className="cost-ticket"><span>کمیسیون : </span><span className="cost1">{new Intl.NumberFormat().format(finalcommission)}</span><span className="moneytype">{x}</span></div>
        }
    }
    renderTotalcom(element) {
        let i = element.commissioncost
        let x = element.unit
        if (i == 0) {
            return '';
        } else {
            let total = element.totalcostmin
            let commissionlen = parseInt(element.commissionDetails.length - 1)
            let com = element.commissionDetails[commissionlen].commission
            let total2 = 0
            let json = this.state.jsonbackup
            let tour = element.id
            if (!json[tour]) {
                total2 = 0
            }
            else {
                let room = 0
                for (room in json[tour]) {
                    total2 += json[tour][room]["total_diff"]
                }
            }
            let commissioncost = parseInt(total2 + total) * com
            let finaltotalcom = parseInt((total2 + total) - commissioncost)
            return <div className="cost-ticket"><span>مبلغ با کسر کمیسیون : </span><span className="cost1">{new Intl.NumberFormat().format(finaltotalcom)}</span><span className="moneytype">{x}</span></div>
        }
    }

    renderInsurance(element) {
        if (element.insuranceinfo !== undefined) {
            if (element.insuranceinfo == 0) {
                return ''
            } else {
                return <div className="reserv_details_title visainsurance">
                    <div className="return_title"> اطلاعات بیمه </div>
                    <input type="hidden" value={JSON.stringify(element.insuranceinfo)} name="insuranceinfo" />
                    <div className="insuranceinfo"><span>نام بیمه : </span><span> {element.insuranceinfo.insurancename}</span></div>
                    <div className="clr"></div>
                </div>
            }
        }

    }
    rendervisa(element) {
        if (element.visa !== undefined) {
            let lenvisa = element.visa.length
            if (lenvisa == 0) {
                return ''
            } else {
                return <div className="reserv_details_title visainsurance">
                    <div className="return_title"> اطلاعات ویزا </div>
                    <div className="insuranceinfo"><span>نام ویزا : </span><span>{element.visa[0].name}</span></div>
                    <div className="clr"></div>
                </div>

            }
        }

    }
    renderserviceTour_link(element) {
        if (element.services !== undefined) {
            return <div className="tourdet" onClick={() => this.showvisibleTourInfo(element.index)}><span>جزییات تور</span></div>
        }
    }
    renderserviceTour(element) {
        if (element.services !== undefined) {
            return <div key={element.index} className={`service-Rtour ${!this.state.visibleTourInfo[element.index] ? "unvisible" : "visible"}`}>
                <div className="container-popup">
                    <div className="services-reserve">
                        <table>
                            <tbody>
                                <tr>
                                    <td className="Q-showHotel"><span>نوع تور</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div className="information-shRhotel">
                                            <ul>
                                                {this.renderserviceType(element.services)}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="services-reserve">
                        <table>
                            <tbody>
                                <tr>
                                    <td className="Q-showHotel"><span>مناسب برای</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div className="information-shRhotel">
                                            <ul>
                                                {this.renderserviceappropriate(element.services)}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="services-reserve">
                        <table>
                            <tbody>
                                <tr>
                                    <td className="Q-showHotel"><span>سطح سختی</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div className="information-shRhotel">
                                            <ul>
                                                {this.renderservicediff(element.services)}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="services-reserve">
                        <table>
                            <tbody>
                                <tr>
                                    <td className="Q-showHotel"><span>برنامه سفر</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div className="information-shRhotel">
                                            <ul>
                                                {this.renderservicejourney(element.services)}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="services-reserve">
                        <table>
                            <tbody>
                                <tr>
                                    <td className="Q-showHotel"><span>توضیحات</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div className="information-shRhotel">
                                            <ul>
                                                {this.renderservicedesc(element.services)}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="close" onClick={() => this.closevisibleTourInfo(element.index)}><span className="fa-times"></span></div>
                </div>
            </div>
        }



    }
    renderserviceType(element) {
        if (element.type == undefined || element.type == '') {
            return <div className="withoutData">-</div>
        } else {
            let lenserviceType = element.type.length
            let indents = []
            for (let i = 0; i < lenserviceType; i++) {
                indents.push(<li><span>{element.type[i].servicename}</span></li>)
            }
            return (
                indents
            )
        }
    }
    renderserviceappropriate(element) {
        if (element.appropriate == undefined || element.appropriate == '') {
            return <div className="withoutData">-</div>
        } else {
            let lenserviceappropriate = element.appropriate.length
            let indents = []
            for (let i = 0; i < lenserviceappropriate; i++) {
                indents.push(<li><span>{element.appropriate[i].servicename}</span></li>)
            }
            return (
                indents
            )
        }
    }
    renderservicediff(element) {
        if (element.diff == undefined || element.diff == '') {
            return <div className="withoutData">-</div>
        } else {
            let lenservicediff = element.diff.length
            let indents = []
            for (let i = 0; i < lenservicediff; i++) {
                if (element.diff[i].servicename == 'لطفا یکی از موارد را انتخاب نمایید') {
                    return <div className="withoutData">-</div>
                } else {
                    indents.push(<li><span>{element.diff[i].servicename}</span></li>)
                }

            }
            return (
                indents
            )
        }
    }
    renderservicedesc(element) {
        if (element.description == undefined || element.description == '') {
            return <div className="withoutData">-</div>
        } else {
            let lenservicedesc = element.description.length
            let indents = []
            for (let i = 0; i < lenservicedesc; i++) {
                let text = element.description[i].decs
                if (text == '') {
                    indents.push(<li><div className="withoutData">-</div></li>)
                } else {
                    indents.push(<li> <span>{element.description[i].decs} </span></li>)
                }

            }
            return (
                indents
            )
        }
    }
    renderservicejourney(element) {
        if (element.journey == undefined) {
            return ''
        } else {
            let lenservicejourney = element.journey.length
            let indents = []
            for (let i = 0; i < lenservicejourney; i++) {
                if (element.journey[i].decs == '' || element.journey[i].decs == undefined) {
                    indents.push(<li><div className="withoutData">-</div></li>)
                } else {
                    indents.push(<li> <span>{element.journey[i].journeytitle} </span><span>{element.journey[i].journeydesc}</span></li>)
                }
            }
            return (
                indents
            )
        }
    }

    showAllDetails = (e, i) => {
        this.setState(prevState => ({
            visibleAllDetails: { ...prevState.visibleAllDetails, [i]: !prevState.visibleAllDetails[i] },
            visibleDetails: { ...prevState.visibleDetails, [i]: !prevState.visibleDetails[i] },
            activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
        }))
    }
    showDetails = (e, i) => {
        this.setState(prevState => ({
            visibleDetails: { ...prevState.visibleDetails, [i]: !prevState.visibleDetails[i] },
            activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
        }))
        if (this.state.visibleBar[i] == true) {
            this.setState(prevState => ({
                visibleBar: { ...prevState.visibleBar, [i]: !prevState.visibleBar[i] },
                activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
            }))
        }

        if (this.state.visibleRule[i] == true) {
            this.setState(prevState => ({
                visibleRule: { ...prevState.visibleRule, [i]: !prevState.visibleRule[i] },
                activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
            }))
        }
    }

    showBar = (e, i) => {
        this.setState(prevState => ({
            visibleBar: { ...prevState.visibleBar, [i]: !prevState.visibleBar[i] },
            activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
        }))
        if (this.state.visibleDetails[i] == true) {
            this.setState(prevState => ({
                visibleDetails: { ...prevState.visibleDetails, [i]: !prevState.visibleDetails[i] },
                activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
            }))
        }

        if (this.state.visibleRule[i] == true) {
            this.setState(prevState => ({
                visibleRule: { ...prevState.visibleRule, [i]: !prevState.visibleRule[i] },
                activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
            }))
        }
    }
    showRule = (e, i) => {
        this.setState(prevState => ({
            visibleRule: { ...prevState.visibleRule, [i]: !prevState.visibleRule[i] },
            activeTab_rule: { ...prevState.activeTab_rule, [i]: !prevState.activeTab_rule[i] }
        }))
        if (this.state.visibleDetails[i] == true) {
            this.setState(prevState => ({
                visibleDetails: { ...prevState.visibleDetails, [i]: !prevState.visibleDetails[i] },
                activeTab_details: { ...prevState.activeTab_details, [i]: !prevState.activeTab_details[i] }
            }))
        }
        if (this.state.visibleBar[i] == true) {
            this.setState(prevState => ({
                visibleBar: { ...prevState.visibleBar, [i]: !prevState.visibleBar[i] },
                activeTab_bar: { ...prevState.activeTab_bar, [i]: !prevState.activeTab_bar[i] }
            }))
        }

    }
    showvisibleTourInfo = (i) => {
        this.setState(prevState => ({
            visibleTourInfo: { ...prevState.visibleTourInfo, [i]: !prevState.visibleTourInfo[i] }
        }))
    }
    closevisibleTourInfo = (i) => {
        this.setState(prevState => ({
            visibleTourInfo: { ...prevState.visibleTourInfo, [i]: !prevState.visibleTourInfo[i] }
        }))
    }

    showcosttable = (i) => {
        this.setState(prevState => ({
            visibleCostTable: { ...prevState.visibleCostTable, [i]: !prevState.visibleCostTable[i] }
        }))
    }
    closecosttable = (i) => {
        this.setState(prevState => ({
            visibleCostTable: { ...prevState.visibleCostTable, [i]: !prevState.visibleCostTable[i] }
        }))
    }
    closeDetails = (i) => {
        this.setState(prevState => ({
            visibleDetails: { ...prevState.visibleDetails, [i]: !prevState.visibleDetails[i] }
        }))
    }
    closeBar = (i) => {
        this.setState(prevState => ({
            visibleBar: { ...prevState.visibleBar, [i]: !prevState.visibleBar[i] }
        }))
    }
    closeRule = (i) => {
        this.setState(prevState => ({
            visibleRule: { ...prevState.visibleRule, [i]: !prevState.visibleRule[i] }
        }))
    }

    handleClick(event) {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        })
        this.setState({
            currentPage: Number(event.target.id)
        })
    }
}
ReactDOM.render(<App />, document.getElementById('Result'))
        }
</script>
<script type="text/javascript">
var progress = $(".loading-progress").progressTimer({
    timeLimit: 40,
    onFinish: function () {

    }
});
$.ajax({
    url: "/"
});

function onloadFunc() {
    var counter = 600;
    setInterval(function () {
        counter--;
        var m = parseInt(counter / 60);
        var s = counter % 60;
        if (counter >= 0) {
            span = document.getElementById("count");
            if(span !== null){
                if (s < 10) {
                   s = "0" + s;
                }
                if (m < 10) {
                   m = "0" + m;
                }
                if (m < 2) {
                document.getElementById("count").classList.add("blink_me")
            }
            span.innerHTML = "00:" + m + ":" + s;
            }
        }
        if (counter === 0) {
            $(".boxalert,#bg-popup-timeout").fadeIn();
            $(".boxalert").css("top", "200px")
            clearInterval(counter);
        }
    }, 1000);

};

//<!---------------------------------JS RESEARCH--------------------------------->
//<!-----------JS SUBMIT----------->
$(".frm").submit(function (event) {
    $(this).find("input[name=fdate],input[name=tdate]").each(function () {
        if ($(this).val() == '' && !$(this).is(':disabled')) {
            event.preventDefault();
            $(this).css('border', '1px solid red')
        }
    })
})

$('.hotel-input, .count-room, .count-adultRoom, .count-childRoom').click(function (e) {
    $(this).closest('.frm-other').find('.HotelPassengers').toggleClass("block");
    e.preventDefault();
    return false;
});
$('.CloseHotelPassengers').click(function (e) {
    $(this).closest('.frm-other').find('.HotelPassengers').removeClass("block");
    e.preventDefault();
    return false;
});
$(".search-flight").click(function () {
    s = $(this).closest("form").find(".childcountinput").val();
    if (s == "0,") {
        $(this).closest("form").find(".childcountinput").val(0)
    }
    $(this).closest("form").find(".contentRooms").each(function () {
        var childCount = $(this).find(".chcount").val();
        var childAge = "";
        $(this).find(".select-age").each(function () {
            childAge = childAge + ',' + $(this).val();
        });
        $(this).find(".childcountandage").val(childCount + childAge);
    });
});
//<!-----------JS PASSENGERS----------->
$(".content-HotelTour").each(function () {
    var json = [##cms.json.header | cms.form.roomSearch##]
    var room = json.rooms.length
    var ad = ""
    var ch = ""
    for (var i = 0; i < room; i++) {
        ad = ad + json.rooms[i].adultcount + ','
        ch = ch + json.rooms[i].childcountandage + '*'
    }
    ad = ad.slice(0, -1)
    ch = ch.slice(0, -1)
    $(".roomcount").val(room)
    $(this).find(".count-room").text('تعداد اتاق: ' + room)
    var m = room;
    var n = ad
    var x = ch
    var sp = n.split(",");
    var sp2 = x.split("*")

    var ad = 0;
    var sum = 0;
    for (var y = 0; y < sp.length; y++) {
        var adultcount = parseInt(sp[y])
        ad += adultcount;
    }
    sum = parseInt(ad)
    $(this).find(".count-adultRoom").text('بزرگسال : ' + sum)

    var ch = 0;
    var sum2 = 0;
    for (var z = 0; z < sp2.length; z++) {
        var q = sp2[z]
        var p = q.split(",")
        var childcount = parseInt(p[0])
        ch += childcount;

    }
    sum2 = parseInt(ch)
    $(this).find(".count-childRoom").text('کودک: ' + sum2)
    $(this).find(".countRoom").empty()
    for (i = 1; i <= m; i++) {

        $(this).find(".countRoom").addClass("tttest")
        var childage = ""
        var q = sp2[i - 1]
        var p = q.split(",")
        var s = p.length
        if (p[0] > 0) {
            var age = ""
            var chage = ""
            for (var j = 1; j < s; j++) {
                age = age + '<div class="age-selection"><label class="label">سن کودک ' + j +
                    '</label><select class="select-age"><option value="' + p[
                        j] + '">' + p[j] +
                    '</option><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
                chage = chage + p[j] + ','
            }
            chage = chage.slice(0, -1);
            childage = childage + p[0] + ',' + chage
            $(this).find(".countRoom").append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click defaultAdNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i + '.adultcount" maxlength="4000" value="' + sp[i - 1] +
                '"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom defaultChNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="' +
                p[0] + '"></div><div class="clr"></div><div class="childDropdowns">' + age +
                '</div><input type="hidden" name="_root.rooms__' + i +
                '.childcountandage" class="childcountandage" value="' + childage +
                '" /></div></div>')

        } else {
            $(this).find(".countRoom").append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click defaultAdNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i + '.adultcount" maxlength="4000" value="' + sp[i - 1] +
                '"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom defaultChNum"><li><a class="button secondary"><span class="hide">+</span></a></li><li><a class="button secondary"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="' +
                p[0] +
                '"></div><div class="clr"></div><div class="childDropdowns"></div><input type="hidden" name="_root.rooms__' +
                i + '.childcountandage" class="childcountandage" value="0" /></div></div>')
        }
    }

});

$(".button-click-room a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    if (oldVal < newVal) {
        var room = newVal;
        button.closest("form").find('.countRoom').empty()
        for (i = 1; i <= room; i++) {
            button.closest("form").find('.countRoom').append(
                '<div class="contentRooms"><div class="numberOfRooms">اتاق' + i +
                '</div><div class="itemlable2"><label> <span class="notshow">بزرگسال</span> </label><ul class="button-click"><li><a class="button secondary" onclick="increaseAdult(this)"><span class="hide">+</span></a></li><li><a class="button secondary"  onclick="decreaseAdult(this)"><span class="hide">-</span></a></li></ul><input type="text" class="cat_textbox adultcount" name="_root.rooms__' +
                i +
                '.adultcount" maxlength="4000" value="1"> <div class="clr"></div></div><div class="itemlable2"> <label> <span class="notshow">کودک</span> </label><ul class="button-click-childRoom"><li><a class="button secondary" onclick="increaseChild(this)"><span class="hide">+</span></a></li><li><a class="button secondary" onclick="decreaseChild(this)"><span class="hide">-</span></a></li><div class="clr"></div></ul><input type="text" class="cat_textbox chcount"  maxlength="4000" value="0"></div><div class="clr"></div><div class="childDropdowns"></div><input type="hidden" name="_root.rooms__' +
                i + '.childcountandage" class="childcountandage" /></div></div>')
        }
    } else if (oldVal > newVal) {
        destroyRoomDropdown(button.closest("form").find('.countRoom'), newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
    button.closest("form").find(".count-room").text('تعداد اتاق: ' + newVal)
    button.closest("form").find(".count-adultRoom").text('بزرگسال : ' + newVal)
    button.closest("form").find(".count-childRoom").text('کودک : 0')
});
var destroyRoomDropdown = function ($el, i) {
    if (i < 1) return;
    $el.find('div.contentRooms').get(i).remove();
};

function increaseAdult(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal >= 10) return;
    button.closest("ul").next().val(newVal);
    SumAdult(a)
}

function decreaseAdult(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    SumAdult(a)
}

function SumAdult(a) {
    var ad = 0;
    var sum = 0;
    $(a).closest("form").find(".countRoomHT").find(".contentRooms").each(function () {
        var adultcount = parseInt($(this).find(".adultcount").val())
        ad += adultcount;
    })
    sum = parseInt(ad)
    $(a).closest("form").find(".count-adultRoom").text('بزرگسال : ' + sum)

}

function increaseChild(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    button.closest("ul").next().val(newVal);
    if (oldVal < newVal) {
        var childCount = newVal;
        button.closest(".contentRooms").find('.childDropdowns').empty()
        for (i = 1; i <= childCount; i++) {
            button.closest(".contentRooms").find('.childDropdowns').append(
                '<div class="age-selection"><label class="label">سن کودک ' + i +
                '</label><select class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
            );
        }

    }
    total_value = total_value.substring(0, total_value.length - 2);
    SumChild(a)
}

function decreaseChild(a) {
    var button = $(a);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    button.closest("ul").next().val(newVal);
    if (oldVal > newVal) {
        var childCount = newVal;
        destroyChildDropdownRoom(button.closest(".contentRooms").find('.childDropdowns'), newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
    SumChild(a)
}

function SumChild(a) {
    var ch = 0;
    var sum = 0;
    $(a).closest("form").find(".countRoomHT").find(".contentRooms").each(function () {
        var chcount = parseInt($(this).find(".chcount").val())
        ch += chcount;
    })
    sum = parseInt(ch)
    $(a).closest("form").find(".count-childRoom").text('کودک : ' + sum)

}
$(".button-click a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    if (newVal >= 10) return;
    if (newVal < 1) return;
    button.closest("ul").next().val(newVal);
    $(".cat_textbox").each(function () {
        var cat = $(this).next('span').text();
    });
    $(".count-adultRoom").text('بزرگسال : ' + newVal)
});
$(".button-click-childRoom a").on("click", function () {
    var button = $(this);
    var oldVal = parseInt(button.closest("ul").next().val());
    var newVal = (button.text() == "+") ? oldVal + 1 : (oldVal > 0) ? oldVal - 1 : 0;
    var total_value = "";
    if (newVal >= 5) return;
    button.closest("ul").next().val(newVal);
    $(".count-childRoom").text('کودک : ' + newVal)
    if (oldVal < newVal) {
        var childCount = newVal;
        button.closest(".contentRooms").find('.childDropdowns').empty()
        for (i = 1; i <= childCount; i++) {
            button.closest(".contentRooms").find('.childDropdowns').append(
                '<div class="age-selection"><label class="label">سن کودک ' + i +
                '</label><select class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
            );
        }

    } else if (oldVal > newVal) {
        destroyChildDropdownRoom(button.closest(".contentRooms").find('.childDropdowns'),
            newVal);
    }
    total_value = total_value.substring(0, total_value.length - 2);
});
var destroyChildDropdownRoom = function ($el, i) {
    $el.find('div.age-selection').get(i).remove();
};


function roomCount(a) {
    var room = $(a).val();
    $(a).closest("form").find(".infoRooms").empty()
    for (i = 1; i <= room; i++) {
        $(a).closest("form").find(".infoRooms").append(
            '<div class="contentRooms counRoom2"><div class="numberOfRooms">اتاق' + i +
            '</div><div class="passengerInfo"><div class="label"><span>بزرگسال</span><span class="age-range">بالای 12 سال</span></div><div class="textbox"><select  name="_root.rooms__' +
            i +
            '.adultcount" class="adultcountHotel"><option value="1">1 بزرگسال</option><option value="2">2 بزرگسال</option><option value="3">3 بزرگسال</option><option value="4">4 بزرگسال</option><option value="5">5 بزرگسال</option><option value="6">6 بزرگسال</option><option value="7">7 بزرگسال</option><option value="8">8 بزرگسال</option><option value="9">9 بزرگسال</option></select></div></div><div class="passengerInfo"><div class="label"><span>کودک</span><span class="age-range">1 تا 12 سال</span></div><div class="textbox"><select name="child" onchange="childCount2(this)" class="childCount">       <option value="0">بدون کودک</option><option value="1">1 کودک</option><option value="2">2 کودک</option><option value="3">3 کودک</option><option value="4">4 کودک</option><option value="5">5 کودک</option><option value="6">6 کودک</option></select></div></div><div class="selectAge"></div><input type="hidden"  name="_root.rooms__' +
            i + '.childcountandage" class="childcountandage"/></div>')
    }
}

function childCount2(a) {
    var age = $(a).val();
    $(a).closest(".contentRooms").find(".selectAge").empty()
    for (var j = 1; j <= age; j++) {
        $(a).closest(".contentRooms").find(".selectAge").append(
            '<div class="createChildDropdown"><label  class="label">سن کودک ' + j +
            '</label><select  class="select-age"><option value="1">تا 1 سال</option><option value="2">1 تا 2</option><option value="3">2 تا 3</option><option value="4">3 تا 4</option><option value="5">4 تا 5</option><option value="6">5 تا 6</option><option value="7">6 تا7</option><option value="8">7 تا 8</option><option value="9">8 تا 9</option><option value="10">9 تا 10</option><option value="11">10 تا 11</option><option value="12">11 تا 12</option></select><div class="clr"></div></div>'
        );
    }
}

$(".frm").find("select").each(function () {
    var selected = $(this).find('option:selected').val()
    $(this).find('option:selected').remove()
    $(this).find('option:not(:selected)').each(function () {
        var Notselected = $(this).val();
        if (Notselected == selected) {
            $(this).attr('selected', true)
        }
    });
})
function city_search(a) {
    $(a).val('')
        $(a).closest(".city").find(".co-id").val('')
        if ($(a).attr('data-active') == 0) {
            $(a).closest(".city").find(".mini-loading").show();
            $.ajax({
                url: '/Client_City_Search.bc',
                type: 'get',
                data: {
                    type: $(a).attr('data-type'),
                    lid: "1"
                },
                success: function (result) {
                    $(a).attr('data-active', "1")
                    $(a).closest(".city").find(".mini-loading").hide();
                    $(a).closest(".city").find(".countryFlight").empty().html(result);
                    $(a).closest(".city").find(".countryFlight").slideDown()
                }
            });
        } else {
            $(a).closest(".city").find(".countryFlight").slideDown()
        }
}
$(document).on('click', function (event) {
    if (!$(event.target).closest('.tour-search-text,.tour-search-content').length) {
        $(".tour-search-content").slideUp();
    }
})
//<!-----------JS CALENDARE----------->
$(document).ready(function () {
    if ($(window).width() <= 750) {
       $(".frm").attr('action', '/M_Tour_Search.bc')
    }
    if ($(".departuredate").val() == $(".persiancurrent").val()) {
        $(".prevdate").hide()
        $('.nextdate').click(NextDate);
    } else {
        $('.prevdate').click(PrevDate);
        $('.nextdate').click(NextDate);
    }
});

function openNextCal(e) {
    let returnDate = $('#r-tour').find('.nextCalOpening').val();
    if (returnDate == '') {
        $('#r-tour').find('.nextCalOpening').trigger("onclick");
    }
};

</script>
</body>
</html>